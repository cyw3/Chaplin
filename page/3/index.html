<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Hexo</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Hexo"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Hexo"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="Hexo"><meta property="og:url" content="http://example.com/"><meta property="og:site_name" content="Hexo"><meta property="og:locale" content="en_US"><meta property="og:image" content="http://example.com/img/og_image.png"><meta property="article:author" content="John Doe"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://example.com/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com"},"headline":"Hexo","image":["http://example.com/img/og_image.png"],"author":{"@type":"Person","name":"John Doe"},"publisher":{"@type":"Organization","name":"Hexo","logo":{"@type":"ImageObject","url":"http://example.com/img/logo.svg"}},"description":""}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }
          Array
              .from(document.querySelectorAll('.tab-content'))
              .forEach($tab => {
                  $tab.classList.add('is-hidden');
              });
          Array
              .from(document.querySelectorAll('.tabs li'))
              .forEach($tab => {
                  $tab.classList.remove('is-active');
              });
          const $activeTab = document.querySelector(location.hash);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
          const $tabMenu = document.querySelector(`a[href="${location.hash}"]`);
          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.2.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="Hexo" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-07-24T05:27:05.706Z" title="7/24/2022, 1:27:05 PM">2022-07-24</time></span><span class="level-item">Updated&nbsp;<time dateTime="2022-07-24T05:26:23.443Z" title="7/24/2022, 1:26:23 PM">2022-07-24</time></span><span class="level-item"> YalesonChan </span><span class="level-item">32 minutes read (About 4850 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/07/24/2016-01-18-Introduction-to-Leap-Motion/">Introduction to Leap Motion</a></h1><div class="content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近是要完成一个关于Leap Motion的项目，所以就顺便到<a target="_blank" rel="noopener" href="https://developer.leapmotion.com/documentation/">官网</a>翻译了下文章。一下首先是翻译的可以直接上手的<a target="_blank" rel="noopener" href="https://developer.leapmotion.com/documentation/java/devguide/Project_Setup.html">Setting up a project</a>，以及<a target="_blank" rel="noopener" href="https://developer.leapmotion.com/documentation/java/devguide/Sample_Tutorial.html#id24">Hello World</a>。</p>
<h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><p>1.Setting up a project</p>
<p>2.Hello World</p>
<h2 id="1-Setting-up-a-project"><a href="#1-Setting-up-a-project" class="headerlink" title="1.Setting up a project"></a>1.Setting up a project</h2><p>Leap Motion java SDK 使用的封装了Leap Motion API 类定义的标准jar包，以及一系列的原生库(native libraries)，让你可以开发Leap的java程序，与Leap Motion进行数据交换。通常，创建一个java项目包含以下步骤：添加LeapJava.jar文件到你的项目的classpath文件中，设置JVM库路径参数以至于你的JVM能够找得到Leap Motion的原生库。</p>
<h3 id="Leap-Motion-Java-libraries"><a href="#Leap-Motion-Java-libraries" class="headerlink" title="Leap Motion Java libraries"></a>Leap Motion Java libraries</h3><p>Leap Motion的jar包是跨平台的，但是他的原生库必须要与系统平台以及用于执行程序的JVM的体系结构进行匹配。</p>
<p>为了能偶在Java程序中使用到Leap Motion的SDk，你需要添加LeapJava.jar文件到classpath文件中，然后设置java库的路径到Leap Motion原生库的位置。</p>
<p>需要使用到Leap Motion Java SDK的以下Java和原生库。</p>
<ul>
<li>32-bit Windows:<ul>
<li>LeapSDK&#x2F;lib&#x2F;LeapJava.jar–Leap Motion Java API的类定义。</li>
<li>LeapSDk&#x2F;lib&#x2F;x86&#x2F;LeapJava.dll–在Windows系统下的32-bit Leap Motion Java库。</li>
<li>LeapSDK&#x2F;lib&#x2F;x86&#x2F;Leap.dll–在Windows系统下的32-bit Leap Motion库。</li>
</ul>
</li>
<li>64-bit Windows:<ul>
<li>LeapSDK&#x2F;lib&#x2F;LeapJava.jar–Leap Motion Java API的类定义。</li>
<li>LeapSDK&#x2F;lib&#x2F;x64&#x2F;LeapJava.dll–在Windows系统下的64-bit Leap Motion Java库。</li>
<li>LeapSDK&#x2F;lib&#x2F;x64&#x2F;Leap.dll–在Windows系统下的64-bit Leap Motion库。</li>
</ul>
</li>
<li>32- or 64-bit Mac OS:<ul>
<li>LeapSDK&#x2F;lib&#x2F;LeapJava.jar–Leap Motion Java API的类定义。</li>
<li>LeapSDK&#x2F;lib&#x2F;libLeapJava.sylib–Mac系统下的Leap Motion Java库。</li>
<li>LeapSDK&#x2F;lib&#x2F;libLeap.sylib–Mac系统下的Leap Motion库。</li>
</ul>
</li>
</ul>
<h3 id="Compile-from-the-command-line"><a href="#Compile-from-the-command-line" class="headerlink" title="Compile from the command line"></a>Compile from the command line</h3><p>使用java编译器，javac编译，设置classpath选项以指定LeapJar文件。举个例子，要编译包含在Leap Motion SDk中的Sample.java，你可以使用一下命令行：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">javac -classpath &lt;LeapMotion&gt;<span class="regexp">/lib/</span>LeapJava.jar Sample.java</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>(<LeapSDK>是指你安装的Leap Motion SDK所在的文件夹)</p>
<h3 id="Run-from-the-command-line"><a href="#Run-from-the-command-line" class="headerlink" title="Run from the command line"></a>Run from the command line</h3><p>为了运行Leap驱动的程序，java在运行时需要找到Leap Motion原生本地库。LeapJava.jar必须已经设置在classpath文件里面了。你可以设置java的’java.library.path’参数以识别原生库。更关键的是，在Windows系统下，你必须制定32-bit 或者64-bit库以匹配你使用的JVM的体系架构。</p>
<p>在MAC上，你可以使用一下命令行运行’Sample’程序：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">java -classpath <span class="string">&quot;.:&lt;LeapSDK&gt;/lib/LeapJava.jar&quot;</span> -Sjava.library.path=&lt;LeapSDK&gt;<span class="regexp">/lib Sample</span></span><br><span class="line"><span class="regexp"></span></span><br></pre></td></tr></table></figure>


<p>在Windows下，你可以使用以下命令行在64-bit JVm下运行Sample程序：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">java -classpath <span class="string">&quot;.;&lt;LeapSDK&gt;/lib/LeapJava.jar&quot;</span> -Djava.library.path=&lt;LeapSDK&gt;<span class="regexp">/lib/x</span>64 Sample</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="Eclipse"><a href="#Eclipse" class="headerlink" title="Eclipse"></a>Eclipse</h3><p>在eclipse IDE里，你要添加LeapJava.jar文件到项目工程中，作为一个外部jar包，然后设置正确的原生Leap Motion库的路径为Jar包的一个属性。</p>
<ol>
<li><p>在Eclipse的文件菜单上选择<em>New &gt; Java Project</em>.</p>
</li>
<li><p>在<em>Create Java Project</em>页面上给项目工程指定一个名称，然后如必要的话设置其他属性(Leap Motion SDK支持Java 6和7)</p>
</li>
<li><p>点击<em>Next</em>键，进入Java Setting页面</p>
</li>
<li><p>选择<em>Livbrary</em>选项</p>
</li>
<li><p>点击*Add External Jars…*按钮</p>
</li>
<li><p>导航到LeapJava.jar包</p>
</li>
<li><p>点击<em>Open</em>键，添加LeapJava.jar到项目工程中</p>
</li>
<li><p>接着，在Library列表里面点击LeapJava.jar条目前面的小三角形，出现Library的属性<br><img src="https://developer-china-cdn.leapmotion.com/documentation/images/Setup_Eclipse_Jar_Properties.png" alt="java setting page"></p>
</li>
<li><p>选择<em>Native Library location</em>条目</p>
</li>
<li><p>点击<em>Edit</em>按钮</p>
</li>
<li><p>导航到半酣Leap Motion原生库的文件夹</p>
</li>
</ol>
<p>在Windows下，需要确保你要选择的文件夹下包含适合你的目标体系架构的正确的库。如果你的是32-bit JVM，要用SDk里面x86文件夹下的Leap Motion库。如果你的是64-bit JVM，要用SDk里面x64文件夹下的Leap Motion库。在Mac上，Leap Motion库支持任意体系架构。</p>
<ol start="12">
<li>点击<em>OK</em>设置路径</li>
</ol>
<p><em>注意：或者你也可以通过项目属性对话框添加Leap Motion库到一个已经存在的项目工程之中。</em></p>
<h3 id="IntelliJ"><a href="#IntelliJ" class="headerlink" title="IntelliJ"></a>IntelliJ</h3><p>在IntelliJ IDE上，你要添加LeapJava.jar文件到项目工程中作为一个库，需要分别使用JVM参数设置Leap Motion原生库的路径，’java.library.path’.JVM 参数可以通过使用IntelliJ Run&#x2F;Debug组态来设置。</p>
<p>以下步骤添加LeapJava.jar到项目工程中：</p>
<ol>
<li>按通常的方法创建了一个工程之后，选择<em>File &gt; Project Structure</em>菜单打开设置对话框</li>
<li>在project Setting下点击<em>Library</em></li>
<li>点击在库列表顶部的小’+’号按钮，打开<em>Select Library Files</em>对话框</li>
<li>从你的Leap Motion SDK添加’LeapJava.jar’</li>
</ol>
<p>通过创建一个<em>Run&#x2F;Debug configuration</em>来设置到原生Leap Motion库的路径：</p>
<ol>
<li>选择<em>Run &gt; Edit Configurations…</em> 菜单</li>
<li>点击在配置离别上面的小’+’号按钮</li>
<li>选择应用，创建一个新的应用配置</li>
<li>指定一个名称</li>
<li>设置VM选项域来设置’-Djava.library.path’参数指向Leap Motion原生库所在的文件夹</li>
<li>点击<em>OK</em></li>
</ol>
<p><img src="https://developer-china-cdn.leapmotion.com/documentation/images/Setup_IntelliJ_Properties.png" alt="IntelliJ"></p>
<p><em>在Windows下，确保选择跟你的JVM体系匹配的文件夹。如果你的是32-bit JVM，要用SDk里面x86文件夹下的Leap Motion库。如果你的是64-bit JVM，要用SDk里面x64文件夹下的Leap Motion库。在Mac上，Leap Motion库支持任意体系架构。</em></p>
<h3 id="NetBeans"><a href="#NetBeans" class="headerlink" title="NetBeans"></a>NetBeans</h3><p>在NetBeans IDE下，你要添加LeapJava.jar文件到项目工程中作为一个库，需要分别使用JVM参数设置Leap Motion原生库的路径，’java.library.path’.JVM 参数可以通过使用IntelliJ Run&#x2F;Debug组态来设置。</p>
<p>以下步骤添加LeapJava.jar到项目工程中：</p>
<ol>
<li>按通常的方法创建了一个工程之后，选择<em>File &gt; Project Properties</em>菜单打开设置对话框</li>
<li>点击<em>Library</em></li>
<li>点击<em>Add Jar&#x2F;Folder</em> 按钮</li>
<li>在你的Leap Motion SDk中找到’LeapJava.jar’</li>
<li>点击<em>OK</em>添加jar包到你的project中</li>
<li>接着，在你的项目属性列表中点击<em>Run</em></li>
<li>设置VM选项域来设置’-Djava.library.path’参数指向Leap Motion原生库所在的文件夹</li>
</ol>
<p><img src="https://developer-china-cdn.leapmotion.com/documentation/images/Setup_Netbeans_Properties.png" alt="NetBeans"></p>
<p><em>在Windows下，确保选择跟你的JVM体系匹配的文件夹。如果你的是32-bit JVM，要用SDk里面x86文件夹下的Leap Motion库。如果你的是64-bit JVM，要用SDk里面x64文件夹下的Leap Motion库。在Mac上，Leap Motion库支持任意体系架构。</em></p>
<h2 id="2-Hello-World"><a href="#2-Hello-World" class="headerlink" title="2. Hello World"></a>2. Hello World</h2><p>这篇文章演示了如何连接Leap Motion控制器，还有基本的访问跟踪数据操作。在阅读完这篇文章之后以及紧随文章编写属于你自己的基本程序，你应该拥有了扎实的基础，可以开始你的应用开发之旅了。</p>
<p>首先，是一小段的背景知识…</p>
<h3 id="How-the-Leap-Motion-Controller-Works"><a href="#How-the-Leap-Motion-Controller-Works" class="headerlink" title="How the Leap Motion Controller Works"></a>How the Leap Motion Controller Works</h3><p>Leap Motion控制器着重的包括硬件和软件组件。</p>
<p>Leap Motion硬件主要包括一对立体声红外摄像机和照明LED的。摄像传感器朝上(当该装置处于其标准定向的时候)。下面的这个插图从Leap Motion传感器的视角来展示了一名用户的手。</p>
<p><img src="https://developer-china-cdn.leapmotion.com/documentation/images/Leap_View.jpg" alt="hands"></p>
<p>Leap Motion软件接收来自传感器的数据，然后分析这个数据，尤其是手掌、手指、手臂，或者工具的数据(追踪其他类型的数据，可能会在将来添加对应的对象的，而这是当前能跟踪的实体)。软件保持着人手的内部模型，然后与传感器发送来的数据组成的模型进行比较，以决定最好的匹配样式。传感器数据将会一帧一帧的被分析，设备会传送每一帧的数据到你的Leap Motion驱动的应用里面。被你的应用接收到的’Frame’对象包含所有已知的位置，速度和跟踪实体的辨识。比如手掌，手指，还有工具。构造，比如说手势，和跨越多个帧的动作，都需要不断刷新每一帧。如果需要控制器提供的跟踪数据的概述的话，可以阅读<a target="_blank" rel="noopener" href="https://developer.leapmotion.com/documentation/java/devguide/Leap_Overview.html">API Overview</a>。</p>
<p>Leap Motion软件可以在客户端计算机上作为一种服务(Windows)或者是一个守护线程(Mac和Linux)。原生的Leap Motion驱动的应用可以使用Leap Motion提供的动态库(作为Leap Motion SDk的一部分提供)连接到这个服务。web应用可以连接到有服务托管的WebSocket服务器上面。WebSocket提供以JSON格式信息的跟踪数据–每一帧数据每一条信息。JavaScript库，LeapJS，提供了包含这个数据的API。想要更多信息的话，可以阅读<a target="_blank" rel="noopener" href="https://developer.leapmotion.com/documentation/java/devguide/Leap_Architecture.html">System Architecture</a>。</p>
<h3 id="Set-Up-the-Files"><a href="#Set-Up-the-Files" class="headerlink" title="Set Up the Files"></a>Set Up the Files</h3><p>这个教程也使用命令行编译器和连接器(如有必要)，为了让我们更加庄主与代码而不是环境。对于如何在主流IDE上使用Leap Motion SDK创建工程，可以先看看这篇文章<a target="_blank" rel="noopener" href="https://developer.leapmotion.com/documentation/java/devguide/Project_Setup.html">Setting up a Project</a>。</p>
<ol>
<li>如果你还没有准备好，那么可以从<a target="_blank" rel="noopener" href="https://developer.leapmotion.com/">Developer site</a>下载解压最新版本的Leap Motion SDk，然后安装最新的Leap Motion服务。</li>
<li>打开一个终端或者控制台窗口，导航到SDk ‘Sample’文件夹下。</li>
<li>‘Sample.java’包含了这篇教程的最终代码，但是出于能够更加深入理解本篇教程的目的下，你可以重命名已经存在的这个Sample文件，然后在这个文件夹下创建一个新的、空白的’Sample.java’文件。保留已经存在的Sample文件，以供参考。</li>
<li>在你的’Sample.java’文件中，添加导入Leap Motion库的代码：</li>
</ol>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">import com.leapmotion.leap.*;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>添加主题代码，定义一个java命令行程序：</li>
</ol>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Sample</span> &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="regexp">//</span> Keep this process running <span class="keyword">until</span> Enter is pressed</span><br><span class="line">        System.out.println(<span class="string">&quot;Press Enter to quit...&quot;</span>);</span><br><span class="line">        try &#123;</span><br><span class="line">            System.<span class="keyword">in</span>.read();</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这个代码简单的打印了一条信息，然后等键盘输入任意键后退出。</p>
<h3 id="Get-Connected"><a href="#Get-Connected" class="headerlink" title="Get Connected"></a>Get Connected</h3><p>下一步是在程序中添加一个控制器对象<a target="_blank" rel="noopener" href="https://developer.leapmotion.com/documentation/java/api/Leap.Controller.html">Controller</a>–这个对象将会帮助我们连接到Leap Motion 服务&#x2F;守护线程。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Sample</span> &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Controller controller = new Controller();</span><br><span class="line"></span><br><span class="line">        <span class="regexp">//</span> Keep this process running <span class="keyword">until</span> Enter is pressed</span><br><span class="line">        System.out.println(<span class="string">&quot;Press Enter to quit...&quot;</span>);</span><br><span class="line">        try &#123;</span><br><span class="line">            System.<span class="keyword">in</span>.read();</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>当你创建一个Controller对象的时候，他会自动的链接到Leap Motion设备，一旦连接建立，你可以通过使用Controlller.frame()方法得到所要的跟踪数据。</p>
<p>这个连接的过程是异步的，所以你不能在一行创建’Controller’，然后期待能偶在下一行语句得到数据。你必须等到连接完成之后才行。但是这需要多久呢？</p>
<h3 id="To-Listen-or-not-to-Listen"><a href="#To-Listen-or-not-to-Listen" class="headerlink" title="To Listen or not to Listen?"></a>To Listen or not to Listen?</h3><p>你可以在Controlller对象上添加监听器对象<a target="_blank" rel="noopener" href="https://developer.leapmotion.com/documentation/java/api/Leap.Listener.html">Listener</a>，这回提供一个基于事件的响应机制以响应’Controlller’的状态变化。这是本篇教程使用的方法–但是他也不总是最好的办法。</p>
<p><strong>监听器的问题：</strong>Listener对象使用了独立的线程来调用你实现的每一个事件的代码。所以，使用监听器机制可以展示出贯穿你的代码中的复杂性。你需要确保的是，在你的监听器子类中实现的代码能够以一种线程安全的方式访问到你的程序。比如，你可能无法访问到跟GUI控制器有关的变量，除了主线程以外。此外，还可能有与线程的创建和清理相关的额外开销。</p>
<p>**Avoiding Listeners:**你可以禁止使用监听器对象通过简单地轮询Controller对象的帧(或其他的状况)，如果对于你的程序是必要的话。很多程序都已经有了一个事件循环，或者动画循环来驱动用户的输入和动画。如果这样的话，你可以在每一轮的循环中获得数据，这将尽可能的加快你使用数据的速度。</p>
<p>API中监听器类定义了当Controller事件触发时会被调用的函数的签名。你可以通过创建’listener’的子类，和实现你感兴趣的事件的回调函数的方式，创建一个监听器。</p>
<p>那么，继续我们的教程，添加’SampleListener’类到你的程序之中。为了简单，我们添加’SampleListener’类到’Sample’类一样的文件下面吧。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SampleListener</span> extends Listener &#123;</span><br><span class="line"></span><br><span class="line">    public void onConnect(Controller controller) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Connected&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void onFrame(Controller controller) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Frame available&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>如果你已经看过了官方给的示例代码，你可能已经注意到了，回调函数的多次出现。你可能也想着吧他们都添加到自己的文件里面，如果你希望的话，但是为了保持代码简单，我们希望只专注于0nConnect()和onFrame()方法。</p>
<p>现在使用你刚写的类创建一个’SampleListener’对象。然后把它添加到你的控制器里。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Sample</span> &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        <span class="regexp">//</span> Create a sample listener <span class="keyword">and</span> controller</span><br><span class="line">        SampleListener listener = new SampleListener();</span><br><span class="line">        Controller controller = new Controller();</span><br><span class="line"></span><br><span class="line">        <span class="regexp">//</span> Have the sample listener receive events from the controller</span><br><span class="line">        controller.addListener(listener);</span><br><span class="line"></span><br><span class="line">        <span class="regexp">//</span> Keep this process running <span class="keyword">until</span> Enter is pressed</span><br><span class="line">        System.out.println(<span class="string">&quot;Press Enter to quit...&quot;</span>);</span><br><span class="line">        try &#123;</span><br><span class="line">            System.<span class="keyword">in</span>.read();</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /<span class="regexp">/ Remove the sample listener when done</span></span><br><span class="line"><span class="regexp">        controller.removeListener(listener);</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br></pre></td></tr></table></figure>

<p>现在，你恶意运行测试一下你的’Sample’程序了。可以跳到后面查看Running the Sample的内容。</p>
<p>如果代码什么的搜没有错误的话(还有就是你的Leap Motion硬件设备已经连接到计算机)，那么你会看到这样的字符串”Connect”打印在终端窗口上，紧接着的是一系列以很快的速度输出的”Frame available”。如果报错而且你搞不懂为什么的话，你可以在我们的<a target="_blank" rel="noopener" href="https://developer.leapmotion.com/">开发者论坛</a>上向我们寻求帮助。</p>
<p>无论你什么时候开发出错，都可以试着打开可视化诊断工具。这个程序将展示一个Leap Motion跟踪数据的可视化观察器。你可以比较你在程序中看到的和你在可视化观察器中看到的(这两者都是用的相同的API)，来查找问题。</p>
<h3 id="On-Connect"><a href="#On-Connect" class="headerlink" title="On Connect"></a>On Connect</h3><p>当你的控制器对象成功连接到Leap Motion服务&#x2F;守护线程之后，而且你的Leap Motion硬件已经插入计算机，控制器对象将会改变它的isConnect()方法的属性为’true’，然后调用你的<a target="_blank" rel="noopener" href="https://developer.leapmotion.com/documentation/java/api/Leap.Listener.html#javaclasscom_1_1leapmotion_1_1leap_1_1_listener_1a06446e436cca86cdd72c0d88c487d52d">Listener.onConnect</a>的回调。</p>
<p>控制器连接之后，你可以使用<a target="_blank" rel="noopener" href="https://developer.leapmotion.com/documentation/java/api/Leap.Controller.html#javaclasscom_1_1leapmotion_1_1leap_1_1_controller_1ac2ee4e779963f135abccc183ab2f35fb">Controller.enableGesture()</a>和<a target="_blank" rel="noopener" href="https://developer.leapmotion.com/documentation/java/api/Leap.Controller.html#javaclasscom_1_1leapmotion_1_1leap_1_1_controller_1a272a235782d654778a1873a28f49a794">Controller.setPolicy()</a>方法设置控制器的参数。比如：你可以通过以下’onConnect()’方法来设置滑动手势的使能化：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public void onConnect(Controller controller) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Connected&quot;</span>);</span><br><span class="line">    controller.enableGesture(Gesture.Type.<span class="variable constant_">TYPE_SWIPE</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="On-Frame"><a href="#On-Frame" class="headerlink" title="On Frame"></a>On Frame</h3><p>在Leap Motion系统中，所有跟踪数据送达都是通过<a target="_blank" rel="noopener" href="https://developer.leapmotion.com/documentation/java/api/Leap.Frame.html">Frame</a>对象来实现的。你可以从你的控制器(当他连接之后)通过调用Controller.frame()方法来获得’Frame’对象。当一个新的frame数据有效时，你的Listener子类的onFrame()回调方法将会被调用。当你不在使用监听器时，你可以比较<a target="_blank" rel="noopener" href="https://developer.leapmotion.com/documentation/java/api/Leap.Frame.html#javaclasscom_1_1leapmotion_1_1leap_1_1_frame_1a912887c5fe73e39a0463019d92107ab0">id()</a>的值和你处理的上一帧，判断是否是一个新的frame(帧)。注意，通过设置frame()函数的’history’参数，你可以获得更早之前的帧(里面至少有60以上的帧的数据被保存着)。所以，如有必要的话，你可以使轮询速率变得比Leap Motion数据帧的速率还慢，可以处理每一帧的数据。</p>
<p>为了获得数据帧frame，要添加frame()方法到你的onframe()回调函数里面：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public void onFrame(Controller controller) &#123;</span><br><span class="line">    Frame frame = controller.frame();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后，打印出Frame对象的一些属性：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public void onFrame(Controller controller) &#123;</span><br><span class="line">    Frame frame = controller.frame();</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;Frame id: &quot;</span> + frame.id()</span><br><span class="line">                   + <span class="string">&quot;, timestamp: &quot;</span> + frame.timestamp()</span><br><span class="line">                   + <span class="string">&quot;, hands: &quot;</span> + frame.hands().count()</span><br><span class="line">                   + <span class="string">&quot;, fingers: &quot;</span> + frame.fingers().count()</span><br><span class="line">                   + <span class="string">&quot;, tools: &quot;</span> + frame.tools().count()</span><br><span class="line">                   + <span class="string">&quot;, gestures &quot;</span> + frame.gestures().count());</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>那么，再次运行你的Sample，把一只或者两支手掌放在Leap Motion设备上面，你会在控制台窗口看到每一帧的基本属性。</p>
<p>本次教程在这就结束了，但是你可以看看官方提供的Sample文件中的其他代码。比如说，在一个Frame里面如何获得手掌Hand，手指Finger，手臂Arm，骨头Bone 还有手势Gesture对象。</p>
<h3 id="Running-the-Sample"><a href="#Running-the-Sample" class="headerlink" title="Running the Sample"></a>Running the Sample</h3><p>运行一个示例应用：</p>
<ol>
<li><p>编译示例应用：</p>
<ul>
<li><p>在Windows系统下，确保’Sample.java’和’LeapJava.jar’在当前文件夹下面，然后输入以下命令行在命令行提示符后面，并运行：</p>
 <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javac -classpath LeapJava.jar Sample.java</span><br></pre></td></tr></table></figure>
</li>
<li><p>在Mac系统上，确保’Sample.java’和’LeapJava.jar’在当前文件夹下面，然后在终端里面运行以下命令行：</p>
</li>
</ul>
 <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">javac -classpath ./LeapJava.jar Sample.java</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>运行示例应用：</p>
<ul>
<li><p>在Windows系统下，确保’Sample.class’,’LeapJava.jar’,’LeapJava.dll’,和’Leap.dll’在同一个文件夹下。如果你是用的是32-bit版本的JVM，需要使用SDk下的lib\x86文件夹下的.dll文件。如果你是用的是64-bit版本的JVM，需要使用SDk下的lib\x64文件夹下的.dll文件.在命令行提示符后输入并运行以下命令行：</p>
 <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -classpath <span class="string">&quot;LeapJava.jar;.&quot;</span> Sample</span><br></pre></td></tr></table></figure>
</li>
<li><p>在Mac系统下，确保’Sample.class’,’LeapJava.jar’,’LeapJava.dll’,和’Leap.dll’在同一个文件夹下。在终端中运行命令行：</p>
</li>
</ul>
 <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">java -classpath <span class="string">&quot;./LeapJava.jar:.&quot;</span> Sample</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<p>当应用程序初始化并连接之后到Leap之后，你会看到”Connect”信息被打印在标准输出中。你还会看到frame的信息，在每一次’onframe’事件被调用后。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-07-24T05:27:05.562Z" title="7/24/2022, 1:27:05 PM">2022-07-24</time></span><span class="level-item">Updated&nbsp;<time dateTime="2022-07-24T04:29:08.592Z" title="7/24/2022, 12:29:08 PM">2022-07-24</time></span><span class="level-item"> YalesonChan </span><span class="level-item">21 minutes read (About 3119 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/07/24/2016-01-17-Java-Garbage-Collection-Mechanism/">Java Garbage Collection Mechanism</a></h1><div class="content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>所谓“java”，其实不只是一门语言，而是一种设计的美丽，更是一种关于世界观、关于架构之美的映射。</p>
<p>java的底层架构，一个我所未知的世界，一个我想了解的世界。所以，我开始结识到java虚拟机(JVM)，以及java之中的垃圾收集机制。</p>
<h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><p>1.JVM</p>
<p>2.Java Garbage Collection Mechanism</p>
<p>3.Java GC</p>
<h2 id="1-JVM"><a href="#1-JVM" class="headerlink" title="1.JVM"></a>1.JVM</h2><p>既然我们时常说到”JVM(java虚拟机)”，那么所谓的java虚拟机到底是什么吗？我认为他应该是这样的：</p>
<p>java虚拟机，Java Virtual Machine，跟我们平常使用的Virtual PC或者VMware一样，是在操作系统上面运行的，一类模仿操作系统环境，虚构出来的计算机。Java虚拟机有自己完善的硬体架构，如处理器、堆栈、寄存器等，还具有相应的指令系统。不过，VMware等是属于系统虚拟机，而JVM是属于程序虚拟机。</p>
<p>既然我们都说java虚拟机十分重要，那么他为什么这么重要呢？</p>
<p>我们都曾弄过java的环境配置，都知道，要从Oracle官网下载jdk进行安装，知道jdk里面含有Jre，知道我们要设置计算机的环境路径。但是，对于新手来说，可能不知道，我们做这些工作，其实都是在做一件事情——配置java的虚拟机。我们所编写的java程序，经过编译之后，会生成可以在Java虚拟机上运行的字节码文件。因为每一个可以运行java程序的计算机，都拥有java虚拟机，拥有一样的运行环境。所以，在一种平台下编译生成的字节码文件，便可以在不同的平台下运行。</p>
<p>综上可知，JVM的优势是：屏蔽具体平台的信息，实现跨平台开发。</p>
<p>一般的高级语言如果要在不同的平台上运行，至少需要编译成不同的目标代码。而引入Java语言虚拟机后，Java语言在不同平台上运行时不需要重新编译。Java语言使用模式Java虚拟机屏蔽了与具体平台相关的信息，使得Java语言编译程序只需生成在Java虚拟机上运行的目标代码（字节码），就可以在多种平台上不加修改地运行。Java虚拟机在执行字节码时，把字节码解释成具体平台上的机器指令执行。</p>
<p>显然，没有JVM，java将不会有今天这般的辉煌。那么，JVM具体上是如何工作的呢？</p>
<p>JVM的工作：</p>
<p>1、先通过调用jdk之中的java.exe，来让操作系统装载jvm。</p>
<p>2、配置jvm的环境：</p>
<p>1）创建JVM装载环境和配置</p>
<p>2）装载JVM.dll</p>
<p>3）初始化JVM.dll并挂界到JNIENV（JNI调用接口）实例</p>
<p>4）调用JNIENV实例装载并处理class类</p>
<p>JVM在整个jdk中处于最底层的，负责操作系统的交互，用来屏蔽操作系统环境，提供一个完整的java运行环境。</p>
<p>首先是将JVM装入环境，JVM提供的方式是操作系统的动态链接文件。既然是装载JVM的文件，那么操作系统会在你的path下面找到你的程序的java.exe，再从里面通过各种调用寻找jvm.dll以及jvm.cfg，将其装载到操作系统，这样就可以在java中调用JVM的函数了。这些工作做完之后就开始运行java程序了。</p>
<p>Java程序有两种方式一种是jar包，一种是class.</p>
<p>运行jar,Java -jar XXX.jar运行的时候</p>
<p>1、Java.exe调用GetMainClassName函数，该函数先获得JNIEnv实例，然后调用Java类           Java.util.jar.JarFileJNIEnv中方法getManifest()并从返回的Manifest对象中取getAttributes(“Main-Class”)的值即jar包中文件：META-INF&#x2F;MANIFEST.MF指定的Main-Class的主类名作为运行的主类。</p>
<p>2、之后main函数会调用Java.c中LoadClass方法装载该主类（使用JNIEnv实例的FindClass）。main函数直接调用Java.c中LoadClass方法装载该类。</p>
<p>如果是执行class方法。main函数直接调用Java.c中LoadClass方法装载该类。</p>
<h2 id="2-Java-Garbage-Collection-Mechanism"><a href="#2-Java-Garbage-Collection-Mechanism" class="headerlink" title="2.Java Garbage Collection Mechanism"></a>2.Java Garbage Collection Mechanism</h2><p>既然，我们已经了解到了何为“JVM”，那么我们也要接着了解一下，JVM是如何进行平时的内存分配的？</p>
<p>过去的语言（如C语言）要求程序员显示的分配内存、释放内存。程序在需要时分配内存，不需要时释放内存。但是这种做法常常会引起“内存泄漏”，即是说，由于某种原因是分配的内存始终没有得到释放。如果该任务不断地重复，程序最终会耗尽内存并异常终止，至少无法正常的运行下去。相比之下，java不要求程序员显式的分配内存和释放内存，避免了很多的潜在问题。java在创建对象时自动分配内存，并当该对象的引用不存在是释放这块内存。</p>
<p>而这也就是，java垃圾回收机制，java相对于以前的语言的优势。</p>
<p>java的垃圾收集机制，gc（garbage collection），是指JVM用于释放哪些不在会用的对象所占用的内存。，虽说，java语言并没有要求JVM有gc，也没有规定gc要如何进行工作，但是，常用的JVM都有GC，而且，大多数gc都使用类似的算法管理内存，和执行收集操作。</p>
<p>但是一般的，在java语言之中，判断一块内存空间是否符合垃圾回收器标准的标准只有两个：</p>
<ul>
<li>给对象赋予了控制null，以后再没有调试过。</li>
<li>给对象赋予了新值，即重新分配了内存空间。</li>
</ul>
<p>注：一块内存空间符合了垃圾回收器的收集标准，并不意味着这块内存控件就一定会被垃圾回收器收集。</p>
<p>虽说，java是自动进行内存的分配与释放的。但是，我们也可以使用System.gc()方法做到强制执行。但是，并不保证每次调用System.gc()方法就一定能够启动垃圾回收，他只不过会向jvm发出这样的一个申请，但是当地会不会真正执行垃圾回收，一切都是未知数。</p>
<p>所以，我们可以在执行system.gc()前，先执行finalize()方法，对对象进行强制释放内存。虽说，在没有明确释放内存志愿的情况下，java也会隐形的调用finalize()方法,终止对象，以此来释放资源。 </p>
<h2 id="3-Java-GC"><a href="#3-Java-GC" class="headerlink" title="3.Java GC"></a>3.Java GC</h2><h3 id="1-首先来看一下JVM内存结构，它是由堆、栈等部分组成，结构图如下所示。"><a href="#1-首先来看一下JVM内存结构，它是由堆、栈等部分组成，结构图如下所示。" class="headerlink" title="1.首先来看一下JVM内存结构，它是由堆、栈等部分组成，结构图如下所示。"></a>1.首先来看一下JVM内存结构，它是由堆、栈等部分组成，结构图如下所示。</h3><p><img src="http://dl2.iteye.com/upload/attachment/0107/3332/dcc4a0d7-2709-3d5e-8bfe-11f9bee29899.jpeg" alt="JVM内存结构"></p>
<p>1.1 堆</p>
<p> 所有通过new创建的对象的内存都在堆中分配。显然，如果不对堆中的这些对象内存进行分类的话，是多而杂的。在不进行对象存活时间区分的情况下，每次垃圾回收都是对整个堆空间进行回收，花费时间相对会长，同时，因为每次回收都需要遍历所有存活对象，但实际上，对于生命周期长的对象而言，这种遍历是没有效果的，因为可能进行了很多次遍历，但是他们依旧存在。因此，分代垃圾回收采用分治的思想，进行代的划分，把不同生命周期的对象放在不同代上，不同代上采用最适合它的垃圾回收方式进行回收。</p>
<p> <img src="http://dl2.iteye.com/upload/attachment/0107/3336/1d0e5a0a-6967-3770-a6c3-80518ba5ffc9.jpeg" alt="回收方式"></p>
<ul>
<li>年轻代:</li>
</ul>
<p>所有新生成的对象首先都是放在年轻代的。年轻代的目标就是尽可能快速的收集掉那些生命周期短的对象。年轻代分三个区。一个Eden区，两个Survivor区(一般而言)。大部分对象在Eden区中生成。当Eden区满时，还存活的对象将被复制到Survivor区（两个中的一个），当这个Survivor区满时，此区的存活对象将被复制到另外一个Survivor区，当这个Survivor去也满了的时候，从第一个Survivor区复制过来的并且此时还存活的对象，将被复制“年老区(Tenured)”。需要注意，Survivor的两个区是对称的，没先后关系，所以同一个区中可能同时存在从Eden复制过来 对象，和从前一个Survivor复制过来的对象，而复制到年老区的只有从第一个Survivor去过来的对象。而且，Survivor区总有一个是空的。同时，根据程序需要，Survivor区是可以配置为多个的（多于两个），这样可以增加对象在年轻代中的存在时间，减少被放到年老代的可能。</p>
<ul>
<li>年老代:</li>
</ul>
<p>在年轻代中经历了N次垃圾回收后仍然存活的对象，就会被放到年老代中。因此，可以认为年老代中存放的都是一些生命周期较长的对象。</p>
<ul>
<li>持久代:</li>
</ul>
<p>用于存放静态文件，如今Java类、方法等。持久代对垃圾回收没有显著影响，但是有些应用可能动态生成或者调用一些class，例如Hibernate等，在这种时候需要设置一个比较大的持久代空间来存放这些运行过程中新增的类。持久代大小通过-XX:MaxPermSize&#x3D;<N>进行设置。</p>
<p>1.2 栈</p>
<p>每个线程执行每个方法的时候都会在栈中申请一个栈帧，每个栈帧包括局部变量区和操作数栈，用于存放此次方法调用过程中的临时变量、参数和中间结果。</p>
<h3 id="2-VM垃圾回收机制"><a href="#2-VM垃圾回收机制" class="headerlink" title="2.VM垃圾回收机制"></a>2.VM垃圾回收机制</h3><p>针对上述的分类，GC有两种类型：Scavenge GC和Full GC。</p>
<p>2.1 Scavenge GC</p>
<p>一般情况下，当新对象生成，并且在Eden申请空间失败时，就会触发Scavenge GC，对Eden区域进行GC，清除非存活对象，并且把尚且存活的对象移动到Survivor区。然后整理Survivor的两个区。这种方式的GC是对年轻代的Eden区进行，不会影响到年老代。因为大部分对象都是从Eden区开始的，同时Eden区不会分配的很大，所以Eden区的GC会频繁进行。因而，一般在这里需要使用速度快、效率高的算法，使Eden去能尽快空闲出来。</p>
<p>2.2 Full GC</p>
<p>对整个堆进行整理，包括Young、Tenured和Perm。因为需要对整个块进行回收，所以比Scavenge GC要慢，因此应该尽可能减少Full GC的次数。在对JVM调优的过程中，很大一部分工作就是对于FullGC的调节。有如下原因可能导致Full GC：</p>
<ul>
<li>年老代（Tenured）被写满</li>
<li>持久代（Perm）被写满</li>
<li>System.gc()被显示调用</li>
<li>上一次GC之后Heap的各域分配策略动态变化</li>
</ul>
<p>下次跟大家，分享一下，垃圾回收机制的几个算法问题吧。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-07-24T05:27:05.198Z" title="7/24/2022, 1:27:05 PM">2022-07-24</time></span><span class="level-item">Updated&nbsp;<time dateTime="2022-07-24T04:29:08.592Z" title="7/24/2022, 12:29:08 PM">2022-07-24</time></span><span class="level-item"> YalesonChan </span><span class="level-item">21 minutes read (About 3123 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/07/24/2016-01-16-Hadoop-Brief/">About Hadoop</a></h1><div class="content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>我们知道，互联网近十年的数据增长是呈现爆炸增长的。大型互联网公司每天要处理的数据基本上都是TB级，甚至是PB级的。而为了存储处理这样海量的数据，传统的数据存储策略（关系型数据库）便陷入了瓶颈。不管是数据入库还是查询，使用传统的存储策略都设计到上亿条数据的便利查找操作，显然这使相当考验存储设备的性能的，也是相当耗时的。但我们知道，当代互联网是追求实时性、高用户体验的，这样的等待时间显然是不会被 认可的。</p>
<p>另外，在追求计算机性能的解决方案时，也必然意味着这样的计算机事极其昂贵、无法普及的，就像现在的超算中心一样，只能 是属于少数人的，大规模组织的。不利于小公司的发展，同样也不适应当代互联网的发展趋势。</p>
<p>而且，相比于互联网海量数据的增长速度，这样的一台高性能的机器，是否过不久还适合处理这样不断增长数据，还是一个问题呢。</p>
<p>于是，为适应这样的状况，有人就开始设计出了分布式系统，于是，<a target="_blank" rel="noopener" href="https://hadoop.apache.org/">Hadoop</a>就出现了。</p>
<h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><p>1.Hadoop的介绍</p>
<p>2.Hadoop的两大组件</p>
<p>3.Hadoop的实现机制</p>
<h2 id="1-Hadoop的介绍"><a href="#1-Hadoop的介绍" class="headerlink" title="1.Hadoop的介绍"></a>1.Hadoop的介绍</h2><p>Hadoop是一个分布式计算开源 软件框架。能在有大量廉价的硬件设备组成的集群上运行应用程序，存储处理海量级别数据。</p>
<p>Hadoop的核心组件有两个，分别是分布式存储、分布式文件管理系统HDFS（Hadoop Distributed File System），还有就是分布式计算框架MapReduce。</p>
<p>其实，Hadoop并不是一个原创的软件。因为在Hadoop之前已经有了很多的分布式框架，比如最著名的是Google的GFS、BigTable、MapReduce，Amason的 AWS、微软的Azure和IBM的蓝云。但是这些软件都是闭源的、商业性的。而这时，Hadoop的创建者Doug Cutting就出现了，应Yahoo！的邀请，他开始在Yahoo！带领团队，开发Apache基金会的顶尖项目Hadoop。应该所Hadoop就是个山寨货，他就是Doug Cutting根据Google的三大论文的思想开发出来的，那个分布式计算框架MapReduce与Google的一模一样，连名字都不带改的。但是这并不妨碍Hadoop成为现如今最有影响力的软件。毕竟，这就是开源的力量。</p>
<h2 id="2-Hadoop的两大组件"><a href="#2-Hadoop的两大组件" class="headerlink" title="2.Hadoop的两大组件"></a>2.Hadoop的两大组件</h2><h3 id="2-1-HDFS"><a href="#2-1-HDFS" class="headerlink" title="2.1 HDFS"></a>2.1 HDFS</h3><ul>
<li><p>Namenode：名称节点，hdfs的管理程序。控制存储和IO交换。保存元数据。</p>
</li>
<li><p>Secondary NameNode ：辅助名称节点。与NomeNode通讯，复制并合并元数据（比如文件命名空间镜像、修改日志），合并为一个文件，并检查文件大小，将就得修改存入本地磁盘，防止文件过大。更新到NameNode之中。这个过程可以简称为“快照”。当NameNode崩溃是，可手动切换成NameNode，代替NameNode完成工作。</p>
</li>
<li><p>dataNode:是数据存储节点。</p>
</li>
</ul>
<p>至于HDFS上面的任务管理器，旧版本的有JobTracker、TaskTracker，而2.x版本之后，为了更便于资源管理，Hadoop便使用ResourceManager替代以上组件。但这里还是以旧版本为例吧。</p>
<ul>
<li>JobTracker：运工作监控器。行在主服务器Master节点里面，就近运行。操作切割分配监控task。</li>
</ul>
<p>以上便是Hadoop的基本存储架构。</p>
<p>HDFS典型的部署是在一个专门的机器 运行NameNode，集群中的其他机器各运行一个DataNode，当然，也可以在运行NameNode的机器上面运行DataNode，或者一个机器运行多个DataNode。一个集群只能有一个NameNode。</p>
<p>NameNode使用事务日志（EditLog）来记录HDFS元数据的变化，使用映射文件（FSImage）存储文件系统的命名空间，包含文件的映射、文件的属性信息等。事务日志和映射文件都存储在NameNode的本地文件系统之中。NameNode启动时，从磁盘中读取映射文件和事务日志，把事务日志的事务都应用到内存中的映射文件上，然后将新的元数据刷新到本地磁盘的新的映射文件上，这样可以截去旧的事务日志，这个过程称为检查点（CheckPoint）。HDFS还设有Secondary NameNode节点，他辅助NameNode处理映射文件和事务日志。NameNode启动的时候合并映射文件和事务日志，而Secondary NameNode周期性的从NameNode复制映射和事务日志到临时目录里面，合并成新的映射文件后再重新上传给NameNode，NameNode更新映射文件并处理事务日志，使得事务日志的大小始终控制在可配置的限度之下。</p>
<p><img src="http://www.zhitongbat.com/ueditor/php/upload/image/20151022/1445446325611344.jpg" alt="架构"></p>
<p><img src="http://www.zhitongbat.com/ueditor/php/upload/image/20151022/1445446347468505.jpg" alt="架构"></p>
<h3 id="2-2-MapReduce"><a href="#2-2-MapReduce" class="headerlink" title="2.2 MapReduce"></a>2.2 MapReduce</h3><p>M&#x2F;R就是Hadoop底下的并行计算模型。顾名思义，他就是有Map还有Reduce两个部分组成的 。Map是把一组数据一对一的映射成为另外的一组数据，Reduce是对一组数据进行归约，映射和归约分别有一个函数指定。具体的就交由大家在具体项目开发的时候在体会了，这样效果更佳哦。</p>
<h2 id="3-Hadoop的实现机制"><a href="#3-Hadoop的实现机制" class="headerlink" title="3.Hadoop的实现机制"></a>3.Hadoop的实现机制</h2><h3 id="1-机柜意识"><a href="#1-机柜意识" class="headerlink" title="1.机柜意识"></a>1.机柜意识</h3><p>通常，大型的HDFS集群跨多个安装点（机柜）排列。一个安装点中的不同节点之间的网络流量通常比跨安装点的网络流量更加的高校。一个NameNode尽量将一个块的多个副本放在多个安装点上以提高容错能力。但是，要平衡容错能力与网络流量的话，HDFS就允许管理员决定一个节点属于哪个安装点，于是，每一个节点就都可以知道它的机柜ID，也就是说，具有了机柜意识。</p>
<p>NameNode可以通过DataNode的机柜ID识别它们的位置。</p>
<h3 id="2-冗余备份"><a href="#2-冗余备份" class="headerlink" title="2.冗余备份"></a>2.冗余备份</h3><p>HDFS是一个大集群、跨机器、可靠存储的大型文件系统。每个文件都存储在一个个的数据块之中，默认数据块大小为64MB。同一个文件中除了最后一块以外的所有都是一样大的。文件的数据块通过复制备份来保证容错。当然，文件的数据块的大小和复制因子都是可以进行配置的。</p>
<p>HDFS的文件都是一次性写入的，并且都是严格限制任何时候都是一个写用户。DataNode使用本地文件系统来存储HDFS的数据，但是它对于HDFS的文件是一无所知的，只是使用一个个文件来存储HDFS的数据块。每当DataNode启动的时候，都会先进行一次对于本地文件系统的便利，得到一份关于HDFS数据块与本地额对应关系列表，并把这个列表报告发给NameNode。这表示块报告，块报告包含了DataNode上所有块的列表。</p>
<h3 id="3-副本存放"><a href="#3-副本存放" class="headerlink" title="3.副本存放"></a>3.副本存放</h3><p>HDFS集群一般运行在多个机架之上，不同的机架上机器的通信是通过交换机的。通常，机架内节点之间的带宽比跨机架节点之间的带宽大、更快，而这会影响HDFS的可靠性以及性能。而HDFS会通过机架感知（Rack-aware，NameNode可以确定每个机架的所属的ID）来改进平衡数据可靠性。</p>
<p>一般，当复制因子是3的时候，HDFS的数据块备份策略是，将两个副本放在同一个机架的不同节点上，最后一个副本放在另外的一个机架的节点上。这样就可以防止整个机架失效的时候数据丢失。</p>
<h3 id="4-HDFS心跳"><a href="#4-HDFS心跳" class="headerlink" title="4.HDFS心跳"></a>4.HDFS心跳</h3><p>因为在这样的大型集群里面，宕机是一种常态。所以，NameNode与DataNode之间的连通性，随时有可能会失效。因此，每个DataNode都会主动向NameNode发送定期心跳信息，如果NameNode没有接收到对应的DataNode的心跳信息，就表明连通性丧失。然后，NameNode会将不能响应心跳信息的DataNode标记为“死DataNode”，并不再向他们发送请求，而存储在该DataNode节点上的数据将不再对那个节点的HDFS客户端可用，该节点将被从系统中有效的移除。如果一个DataNode的死导致数据库的复制因子降到最小值以下，NameNode将会启动附加复制，将复制因子带回正常阶段。</p>
<h3 id="5-安全模式"><a href="#5-安全模式" class="headerlink" title="5.安全模式"></a>5.安全模式</h3><p>HDFS启动是时，NameNode会进入一个特殊的模式，安全模式，此时不会出现数据块的复制。NameNode会受到个DataNode的心跳信息以及数据块报告。数据块报告中包含一个DataNode所拥有的数据块列表，每个数据块里面都有指定书目的副本。当某个NameNode登记的数据复制品达到最小数目（&lt;&#x3D;最小数目）时，数据块会被认为是安全的，安全复制。在一定百分比（可配置）的数据块被NameNode检测确定是安全登记之后，在登记（加上附加的30秒），NameNode会推出安全模式。当检测到副本数不足的数据块时，该数据块会被复制到其他的节点之上，以达到最小副本数。</p>
<h3 id="6-数据完成性检测"><a href="#6-数据完成性检测" class="headerlink" title="6.数据完成性检测"></a>6.数据完成性检测</h3><p>从DataNode中获取的数据块可能会是损坏的。为此，HDSF客户端实现了对于HDFS文件内容的校验和检查（Checksum）。在HDFS文件被创建时，会计算每个数据块的检验和，并将检验和作为一个单独的隐藏文件保存在命名空间里面。当获取这个文件后，会检查各个DataNode取出的数据块和相应的校验和进行匹配。如若不匹配，则会选择其他副本的DataNode去数据块。</p>
<h3 id="7-空间回收"><a href="#7-空间回收" class="headerlink" title="7.空间回收"></a>7.空间回收</h3><p>当文件被删除是，文件会被移动到&#x2F;trash目录下，只要还在这个目录之下，文件就可以被快速回复。文件在这个目录里面的时间是可以设置的，超过这个时间，系统就会把它从系统的命名空间之中删除。而文件的删除便会引起相应数据块的释放。</p>
<h3 id="8-元数据磁盘失效"><a href="#8-元数据磁盘失效" class="headerlink" title="8.元数据磁盘失效"></a>8.元数据磁盘失效</h3><p>映射文件和事务日志是HDFS的核心数据结构。若果这些文件损坏，将会导致HDFS的不可用。当然，可以设置NameNode支持维护映射文件和事务日志的多个副本，任何映射文件或事务日志的修改都会同步到他的副本上。每次NameNode重启时，都会选择最新的一致性的映射文件和事务日志。</p>
<h3 id="9-快照"><a href="#9-快照" class="headerlink" title="9.快照"></a>9.快照</h3><p>快照支持存储某一个时间点的数据复制。利用这一特性可以将损坏的HDFS回滚到以前的某一个正常的时间点。</p>
<p>以上便是最近的一些心得，还请斧正。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-07-24T05:26:24.411Z" title="7/24/2022, 1:26:24 PM">2022-07-24</time></span><span class="level-item">Updated&nbsp;<time dateTime="2022-07-24T05:26:24.411Z" title="7/24/2022, 1:26:24 PM">2022-07-24</time></span><span class="level-item"> YalesonChan </span><span class="level-item">12 minutes read (About 1731 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/07/24/2016-01-13-Portfolio-yield-Chart/">投资组合的收益率走势图</a></h1><div class="content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>各位看官好，我是小陈，今天又来献丑了。作为金融小白，小陈我最近一直在恶补投资方面的知识。而前些天，正好涌哥叫我用况客API实现一个投资组合的收益率走势图，感觉自己一身代码神功又有用武之地了。</p>
<p>所谓投资组合是说，投资持有各种金融产品的组合，需要分段分批分散投入，目的是分散风险。当然，投资人都是希望自己投的股票能够不断的涨，把钱花在刀刃上，以最少的钱套取最大的利益，但是这是不现实的，毕竟股市，尤其是中国股市（大家都懂的），是变化莫测的。所以，如何尽可能的减少风险，利益最大化，成为了关键所在。而接下来我将说到的“收益率走势图”，将会是一个不错的工具，让我们趋利避害。</p>
<h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><p>1.投资组合以及收益率走势图的介绍</p>
<p>2.收益率走势图效果图展示</p>
<p>3.收益率走势图的代码实现以及优化</p>
<h2 id="1-投资组合以及收益率走势图的介绍"><a href="#1-投资组合以及收益率走势图的介绍" class="headerlink" title="1.投资组合以及收益率走势图的介绍"></a>1.投资组合以及收益率走势图的介绍</h2><p>美国经济学家马考维茨(Markowitz)曾这样说过：“若干种证券组成的投资组合，其收益是这些证券收益的加权平均数，但是其风险不是这些证券风险的加权平均风险，投资组合能降低非系统性风险。”</p>
<p>马考维茨最著名的作品便是《投资组合理论》，他还因此获得了诺贝尔经济学奖。当然，本文的重点不是说要探讨马考维茨的“投资组合理论”云云（其实我也不懂）。但是这也足够说明了，合理的投资组合，能够让投资者获取更大的利益。投资者持有多种金融产品，不同的产品可能具有不同的市场地位和价值优势，需要综合评价企业的价值能力，进行投资组合分析。至于收益率走势图，显然是我们进行投资组合分析时的一大工具了。</p>
<p>收益率是指投资的回报率，一般以年度百分比表达，根据当时市场价格、面值、息票利率以及距离到期日时间计算。对公司而言，收益率指净利润占使用的平均资本的百分比。而通过收益率走势图，我们可以实时地知道，我们所持股票的自买入以来的收益情况，以及可以大体预测股票的大致走向，如果辅以好的算法的话，甚至可以如同化身“预言家”，对未来股票走势了如指掌。</p>
<h2 id="2-收益率走势图效果图展示"><a href="#2-收益率走势图效果图展示" class="headerlink" title="2.收益率走势图效果图展示"></a>2.收益率走势图效果图展示</h2><p>哎呀，我也不说什么太虚的了。直接开干。以下便是我们代码实现的效果图了。怎么样？很棒吧！觉得羡慕吧！羡慕就继续往下看，走起。<a target="_blank" rel="noopener" href="https://i.qutke.com/apps/569f4501310a3c46406493bd">yieldChart</a></p>
<iframe style="width:100%;height:600px;border:0;padding:0;margin:0;" src="https://console.qutke.com/diagram/info/569e7b5b310a3c4640649396?config={ %22color%22:%22%23ffffff%22}"></iframe>


<h2 id="3-收益率走势图的代码实现以及优化"><a href="#3-收益率走势图的代码实现以及优化" class="headerlink" title="3.收益率走势图的代码实现以及优化"></a>3.收益率走势图的代码实现以及优化</h2><p>1.系统环境</p>
<p>跟上一篇文一样，我们需要准备好开发所需要的环境。就像学习一样，得要有个好的学习氛围嘛。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">win7系统</span><br><span class="line">RStudio编辑器</span><br><span class="line">qutke包</span><br></pre></td></tr></table></figure>

<p>需要提前下载况客R语言Api，即qutke，<a target="_blank" rel="noopener" href="https://github.com/qutke/qutke">GitHub链接</a><br>可以安装注册git，通过git命令来下载相应的R包。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone <span class="symbol">https:</span>/<span class="regexp">/github.com/qutke</span><span class="regexp">/qutke.git </span></span><br></pre></td></tr></table></figure>

<p>也可以通过RStudio命令来下载：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">library(devtools)</span><br><span class="line">install_github(<span class="string">&#x27;qutke/qutke&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>2.初始化，弹药准备</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装相应的需要使用的R包</span></span><br><span class="line">library(<span class="string">&#x27;lubridate&#x27;</span>)</span><br><span class="line">library(qutke)</span><br><span class="line">key&lt;-<span class="string">&#x27;ff5ed58edf645c6581e8148db1130dc310fbab5fdccc4b2a9ea0be30f4128ace&#x27;</span></span><br><span class="line">init(key)</span><br></pre></td></tr></table></figure>


<p>3.参数选定</p>
<p>在制作走势图之前，我们得知道，是什么样的组合，什么时候买入的。这里，我参考了雪球里的一个热门组合“丁丁丁涨不停ZH078564”，分别是科大讯飞“002230.SZ”，以及登云股份“002715.SZ”。日期就选在“2015-10-01”吧。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">qtid &lt;- c(<span class="string">&#x27;002230.SZ&#x27;</span>,<span class="string">&#x27;002715.SZ&#x27;</span>)</span><br><span class="line">date &lt;- <span class="string">&#x27;2015-10-01&#x27;</span></span><br></pre></td></tr></table></figure>


<p>4.获取股票基本信息</p>
<p>依次获取这两支股票的从买入日期至今的每天的收盘价。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#股票基本信息</span></span><br><span class="line">md &lt;- getMD(data=<span class="string">&#x27;keyMap&#x27;</span>,qtid=qtid,key=key)</span><br><span class="line"><span class="comment">#股票日间行情(前复权)</span></span><br><span class="line">dailyQuote &lt;- getDailyQuote(data=<span class="string">&#x27;mktFwdDaily&#x27;</span>,qtid=qtid,startdate=date,enddate=Sys.Date(),key=key)</span><br><span class="line"><span class="comment">#当日收盘价(前复权)</span></span><br><span class="line">stock1 &lt;-dailyQuote[which(dailyQuote<span class="variable">$qtid</span>==qtid[<span class="number">1</span>]),]</span><br><span class="line">stock2 &lt;-dailyQuote[which(dailyQuote<span class="variable">$qtid</span>==qtid[<span class="number">2</span>]),]</span><br><span class="line"><span class="comment">#x轴，作为时间轴。取买入日期至今。</span></span><br><span class="line">tradingDay &lt;- getDate(data=<span class="string">&#x27;tradingDay&#x27;</span>,startdate=stock1<span class="variable">$date</span>[<span class="number">1</span>],enddate=Sys.Date(),key=key)</span><br></pre></td></tr></table></figure>

<p>5.数据处理，以备后面生成dataframe表格。此时，fwdAdjClose是每只股票在每一个交易日的收盘价。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#归一化</span></span><br><span class="line">i &lt;- <span class="number">1</span></span><br><span class="line">length &lt;- length(tradingDay)</span><br><span class="line">fwdAdjClose1 &lt;- c()</span><br><span class="line">fwdAdjClose2 &lt;- c()</span><br><span class="line"><span class="keyword">while</span>(i&lt;=length)&#123;</span><br><span class="line">  fwdAdjClose1 &lt;- c(fwdAdjClose1,stock1[i,]<span class="variable">$fwdAdjClose</span>)</span><br><span class="line">  <span class="keyword">if</span>(is.null(fwdAdjClose1[i])|<span class="params"></span>|is.na(fwdAdjClose1[i])) </span><br><span class="line">    fwdAdjClose1[i] &lt;- fwdAdjClose1[i-<span class="number">1</span>]</span><br><span class="line">  fwdAdjClose2 &lt;- c(fwdAdjClose2,stock2[i,]<span class="variable">$fwdAdjClose</span>)</span><br><span class="line">  <span class="keyword">if</span>(is.null(fwdAdjClose2[i])|<span class="params"></span>|is.na(fwdAdjClose2[i])) </span><br><span class="line">    fwdAdjClose2[i] &lt;- fwdAdjClose2[i-<span class="number">1</span>]</span><br><span class="line">  i=i+<span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>6.收益率计算</p>
<p>收益率计算公式是：</p>
<p>某只股票收益率 &#x3D; （当天的股价-买入价）&#x2F; 买入价 *100</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#计算</span></span><br><span class="line">fwdAdjClose1 &lt;- (fwdAdjClose1-fwdAdjClose1[<span class="number">1</span>])/fwdAdjClose1[<span class="number">1</span>]*<span class="number">100</span></span><br><span class="line">fwdAdjClose2 &lt;- (fwdAdjClose2-fwdAdjClose2[<span class="number">1</span>])/fwdAdjClose2[<span class="number">1</span>]*<span class="number">100</span></span><br></pre></td></tr></table></figure>


<p>7.生成dataframe表格，并将数据发送到况客投研中心，以便后期处理</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#形成dataframe</span></span><br><span class="line">yieldChart &lt;- data.frame(<span class="string">&#x27;date&#x27;</span>=tradingDay,<span class="string">&#x27;2&#x27;</span>=fwdAdjClose1,<span class="string">&#x27;3&#x27;</span>=fwdAdjClose2)</span><br><span class="line">names(yieldChart)&lt;-c(<span class="string">&#x27;日期&#x27;</span>,md[<span class="number">1</span>,]<span class="variable">$ChiAbbr</span>,md[<span class="number">2</span>,]<span class="variable">$ChiAbbr</span>)</span><br><span class="line">postData(yieldChart,name=<span class="string">&#x27;yieldChart&#x27;</span>,key=key)</span><br></pre></td></tr></table></figure>

<p>8.代码优化</p>
<p>当然，我们不能就这满足了。我们需要在对代码略微修改，使之只需要我们输入交易日期、股票组合，就可以自动生成需要的收益率走势图。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">getYieldChart&lt;-function(date,qtid=c(),key)&#123;</span><br><span class="line">  <span class="keyword">if</span>(length(qtid)&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">    stop(<span class="string">&quot;Qtid is more than one.&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">#股票基本信息</span></span><br><span class="line">  md &lt;- getMD(data=<span class="string">&#x27;keyMap&#x27;</span>,qtid=qtid,key=key)</span><br><span class="line">  <span class="comment">#股票日间行情(前复权)</span></span><br><span class="line">  dailyQuote &lt;- getDailyQuote(data=<span class="string">&#x27;mktFwdDaily&#x27;</span>,qtid=qtid,startdate=date,enddate=Sys.Date(),key=key)</span><br><span class="line">  <span class="comment">#当日收盘价(前复权)</span></span><br><span class="line">  stock &lt;- list()</span><br><span class="line">  qtidlength &lt;- length(qtid)</span><br><span class="line">  i &lt;- <span class="number">1</span></span><br><span class="line">  <span class="keyword">while</span>(i&lt;=qtidlength)&#123;</span><br><span class="line">    ChiAbbr &lt;- md[i,]<span class="variable">$ChiAbbr</span></span><br><span class="line">    qtidSt &lt;- md[i,]<span class="variable">$qtid</span></span><br><span class="line">    stock[[ChiAbbr]] &lt;- dailyQuote[which(dailyQuote<span class="variable">$qtid</span>==qtidSt),]</span><br><span class="line">    i &lt;- i+<span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">#x轴，作为时间轴。取买入日期至今。</span></span><br><span class="line">  tradingDay &lt;- getDate(data=<span class="string">&#x27;tradingDay&#x27;</span>,startdate=stock[[<span class="number">1</span>]]<span class="variable">$date</span>[<span class="number">1</span>],enddate=Sys.Date(),key=key)</span><br><span class="line">  fwdAdjClose &lt;- list()</span><br><span class="line">  fwdAdjClose[[<span class="string">&#x27;date&#x27;</span>]] &lt;- tradingDay</span><br><span class="line">  <span class="comment">#归一化</span></span><br><span class="line">  i &lt;- <span class="number">1</span></span><br><span class="line">  length &lt;- length(tradingDay)</span><br><span class="line">  <span class="keyword">while</span>(i&lt;=qtidlength)&#123;</span><br><span class="line">    ChiAbbr &lt;- md[i,]<span class="variable">$ChiAbbr</span></span><br><span class="line">    j &lt;- <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span>(j&lt;=length)&#123;</span><br><span class="line">      fwdAdjClose[[ChiAbbr]] &lt;- c(fwdAdjClose[[ChiAbbr]],stock[[ChiAbbr]][j,]<span class="variable">$fwdAdjClose</span>)</span><br><span class="line">      <span class="keyword">if</span>(is.null(fwdAdjClose[[ChiAbbr]][j])|<span class="params"></span>|is.na(fwdAdjClose[[ChiAbbr]][j])) </span><br><span class="line">        fwdAdjClose[[ChiAbbr]][j] &lt;- fwdAdjClose[[ChiAbbr]][j-<span class="number">1</span>]</span><br><span class="line">      j &lt;- j+<span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">#计算</span></span><br><span class="line">    fwdAdjClose[[ChiAbbr]] &lt;- (fwdAdjClose[[ChiAbbr]]-fwdAdjClose[[ChiAbbr]][<span class="number">1</span>])/fwdAdjClose[[ChiAbbr]][<span class="number">1</span>]*<span class="number">100</span></span><br><span class="line">    i=i+<span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">#形成dataframe</span></span><br><span class="line">  yieldChart &lt;-data.frame(fwdAdjClose)</span><br><span class="line">  postData(yieldChart,name=<span class="string">&#x27;yieldChart&#x27;</span>,key=key)</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>


<p>这样，就算完成了。（满意脸）</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-07-24T05:26:23.443Z" title="7/24/2022, 1:26:23 PM">2022-07-24</time></span><span class="level-item">Updated&nbsp;<time dateTime="2022-07-24T05:26:23.443Z" title="7/24/2022, 1:26:23 PM">2022-07-24</time></span><span class="level-item"> YalesonChan </span><span class="level-item">18 minutes read (About 2728 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/07/24/2016-01-15-Genetic-Algorithms-in-R/">遗传算法的R语言实现</a></h1><div class="content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>遗传算法的操作使用适者生存的原则，在潜在的种群中逐次产生一个近似最优解的方案，在每一代中，根据个体在问题域中的适应度值和从自然遗传学中借鉴来的再造方法进行个体选择，产生一个新的近似解。这个过程会导致种群中个体的进化，得到的新个体比原来个体更能适应环境，就像自然界中的改造一样。</p>
<h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ol>
<li><p>遗传算法原理</p>
</li>
<li><p>R语言实现</p>
</li>
</ol>
<h2 id="1-遗传算法原理"><a href="#1-遗传算法原理" class="headerlink" title="1.遗传算法原理"></a>1.遗传算法原理</h2><p>在遗传算法里，优化问题的解是被称为个体，它表示为一个变量序列，叫做染色体或者基因串。<br>编码：染色体一般被表达为简单的字符串或数字串，也有其他表示法，这一过程称为编码。<br>基本的过程是：</p>
<p>1)首先要创建种群，算法随机生成一定数量的个体，有时候也可以人工干预这个过程进行，<br>以提高初始种群的质量。在每一代中，每一个个体都被评价，并通过计算适应度函数得到一个适应度数值。种群中的个体被按照适应度排序，适应度高的在前面。（适应度函数）</p>
<p>2)产生下一代个体的种群，通过选择过程和繁殖过程完成。</p>
<p>选择过程，是根据新个体的适应度进行的，但同时并不意味着完全的以适应度高低作为导向，因为单纯选择适应度高的个体将可能导致算法快速收敛到局部最优解而非全局最优解，我们称之为早熟。作为折中，遗传算法依据原则：适应度越高，被选择的机会越高，而适应度低的，被选择的机会就低。初始的数据可以通过这样的选择过程组成一个相对优化的群体。</p>
<p>繁殖过程，表示被选择的个体进入交配过程，包括交配(crossover)和突变(mutation，交配对应算法中的交叉操作。一般的遗传算法都有一个交配概率，范围一般是0.6~1，这个交配概率反映两个被选中的个体进行交配的概率。例如，交配概率为0.8，则80%的“夫妻”个体会生育后代。每两个个体通过交配产生两个新个体，代替原来的“老”个体，而不交配的个体则保持不变。交配过程，父母的染色体相互交換，从而产生两个新的染色体，第一个个体前半段是父亲的染色体，后半段是母亲的，第二个个体则正好相反。不过这里指的半段並不是真正的一半，这个位置叫做交配点，也是随机产生的，可以是染色体的任意位置。</p>
<p>突变过程，表示通过突变产生新的下一代个体。一般遗传算法都有一个固定的突变常数，又称为变异概率，通常是0.1或者更小，这代表变异发生的概率。根据这个概率，新个体的染色体随机的突变，通常就是改变染色体的一个字节（0变到1，或者1变到0）。</p>
<p>遗传算法实现将不断的重复这个过程：每个个体被评价，计算出适应度，两个个体交配，然后突变，产生下一代，直到终止条件满足为止。一般终止条件有以下几种：</p>
<p>进化次数限制</p>
<ul>
<li>计算耗费的资源限制，如计算时间、计算占用的CPU，内存等</li>
<li>个体已经满足最优值的条件，即最优值已经找到</li>
<li>当适应度已经达到饱和，继续进化不会产生适应度更好的个体</li>
<li>人为干预</li>
</ul>
<p>过程：</p>
<ol>
<li><p>创建初始种群</p>
</li>
<li><p>循环：产生下一代</p>
</li>
<li><p>评价种群中的个体适应度</p>
</li>
<li><p>定义选择的适应度函数</p>
</li>
<li><p>改变该种群（交配和变异）</p>
</li>
<li><p>返回第二步</p>
</li>
<li><p>满足终止条件结束</p>
</li>
</ol>
<h2 id="2-R语言实现"><a href="#2-R语言实现" class="headerlink" title="2.R语言实现"></a>2.R语言实现</h2><p>一般在进行遗传算法的时候，需要考虑的参数有：</p>
<ul>
<li>种群规模(Population)，即种群中染色体个体的数目。</li>
<li>染色体的基因个数(Size)，即变量的数目。</li>
<li>交配概率(Crossover)，用于控制交叉计算的使用频率。交叉操作可以加快收敛，使解达到最有希望的最优解区域，因此一般取较大的交叉概率，但交叉概率太高也可能导致过早收敛。</li>
<li>变异概率(Mutation)，用于控制变异计算的使用频率，决定了遗传算法的局部搜索能力。</li>
<li>中止条件(Termination)，结束的标志。</li>
</ul>
<p>以下是常见的R遗传算法包：</p>
<ul>
<li>mcga包，多变量的遗传算法，用于求解多维函数的最小值。</li>
<li>genalg包，多变量的遗传算法，用于求解多维函数的最小值。</li>
<li>rgenoud包，复杂的遗传算法，将遗传算法和衍生的拟牛顿算法结合起来，可以求解复杂函数的最优化化问题。</li>
<li>gafit包，利用遗传算法求解一维函数的最小值。不支持R 3.1.1的版本。</li>
<li>GALGO包，利用遗传算法求解多维函数的最优化解。不支持R 3.1.1的版本。</li>
</ul>
<p>那么我们今天就只针对mcga包，还有genalg包进行讲解一下吧。</p>
<p>1)mcga</p>
<p>实值优化问题。使用的变量值表示基因序列，而不是字节码，因此不需要编解码的处理。<br>mcga实现了遗传算法的交配和突变的操作，并且可以进行大范围和高精度的搜索空间的计算，算法的主要缺点是使用了256位的一元字母表。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">install.packages(<span class="string">&quot;mcga&quot;</span>)</span><br><span class="line">library(mcga)</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看mcga的定义</span></span><br><span class="line">mcga</span><br></pre></td></tr></table></figure>

<p>这是mcga的方法定义。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">function (popsize, chsize, crossprob = <span class="number">1</span>, mutateprob = <span class="number">0.01</span>, </span><br><span class="line">         elitism = <span class="number">1</span>, minval, maxval, maxiter = <span class="number">10</span>, evalFunc) </span><br></pre></td></tr></table></figure>

<p>参数说明：</p>
<ul>
<li>popsize，个体数量，即染色体数目</li>
<li>chsize，基因数量，限参数的数量</li>
<li>crossprob，交配概率，默认为1.0</li>
<li>mutateprob，突变概率，默认为0.01</li>
<li>maxiter，繁殖次数，即循环次数，默认为10</li>
<li>evalFunc，适应度函数，用于给个体进行评价</li>
<li>elitism，精英数量，直接复制到下一代的染色体数目，默认为1</li>
<li>minval，随机生成初始种群的下边界值</li>
<li>maxval，随机生成初始种群的上边界值</li>
</ul>
<p>例子：fx&#x3D;(x1-5)^2 + (x2-55)^2 +(x3-555)^2 +(x4-5555)^2 +(x5-55555)^2</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义适应度函数 </span></span><br><span class="line">f &lt;- function(x)&#123;</span><br><span class="line">  <span class="comment">#总括号</span></span><br><span class="line">  <span class="keyword">return</span> ((x[<span class="number">1</span>]-<span class="number">5</span>)^<span class="number">2</span>+(x[<span class="number">2</span>]-<span class="number">55</span>)^<span class="number">2</span>+(x[<span class="number">3</span>]-<span class="number">555</span>)^<span class="number">2</span>+(x[<span class="number">4</span>]-<span class="number">5555</span>)^<span class="number">2</span>+(x[<span class="number">5</span>]-<span class="number">55555</span>)^<span class="number">2</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行遗传算法</span></span><br><span class="line">m &lt;- mcga(   popsize=<span class="number">200</span>, </span><br><span class="line">             chsize=<span class="number">5</span>, </span><br><span class="line">             minval=<span class="number">0.0</span>, </span><br><span class="line">             maxval=<span class="number">999999</span>, </span><br><span class="line">             maxiter=<span class="number">2500</span>, </span><br><span class="line">             crossprob=<span class="number">1.0</span>, </span><br><span class="line">             mutateprob=<span class="number">0.01</span>, </span><br><span class="line">             evalFunc=f)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 最优化的个体结果</span></span><br><span class="line">print(m<span class="variable">$population</span>[<span class="number">1</span>,])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行时间</span></span><br><span class="line">m<span class="variable">$costs</span>[<span class="number">1</span>]    </span><br></pre></td></tr></table></figure>

<p>同样，当题目改为fx&#x3D;(x1-5)^2 + (x2-55)^2 +(x3-555)^2 +(x4-5555)^2 +(x5-55555)^2时候：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#这是适应度函数</span></span><br><span class="line">f&lt;-function(x)&#123;</span><br><span class="line">  <span class="keyword">return</span> ((x[<span class="number">1</span>]-<span class="number">7</span>)^<span class="number">2</span> + (x[<span class="number">2</span>]-<span class="number">77</span>)^<span class="number">2</span> +(x[<span class="number">3</span>]-<span class="number">777</span>)^<span class="number">2</span> +(x[<span class="number">4</span>]-<span class="number">7777</span>)^<span class="number">2</span> +(x[<span class="number">5</span>]-<span class="number">77777</span>)^<span class="number">2</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">m&lt;-mcga(popsize=<span class="number">200</span>, </span><br><span class="line">  chsize=<span class="number">5</span>, </span><br><span class="line">  minval=<span class="number">0.0</span>, </span><br><span class="line">  maxval=<span class="number">999999999.9</span>, </span><br><span class="line">  maxiter=<span class="number">2500</span>, </span><br><span class="line">  crossprob=<span class="number">1.0</span>, </span><br><span class="line">  mutateprob=<span class="number">0.01</span>, </span><br><span class="line">  evalFunc=f)</span><br><span class="line">cat(<span class="string">&quot;Best chromosome:\n&quot;</span>)</span><br><span class="line">print(m<span class="variable">$population</span>[<span class="number">1</span>,])</span><br><span class="line">cat(<span class="string">&quot;Cost: &quot;</span>,m<span class="variable">$costs</span>[<span class="number">1</span>],<span class="string">&quot;\n&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>2)genalg包</p>
<p>实现了遗传算法，还提供了遗传算法的数据可视化，给用户更直观的角度理解算法。<br>默认图显示的最小和平均评价值，表示遗传算法的计算进度。<br>直方图显出了基因选择的频率，即基因在当前个体中被选择的次数。<br>参数图表示评价函数和变量值，非常方便地看到评价函数和变量值的相关关系。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">install.packages(<span class="string">&quot;genalg&quot;</span>)</span><br><span class="line">library(genalg)</span><br></pre></td></tr></table></figure>

<p>这是genalg函数定义：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">rbga(stringMin=c(), stringMax=c(),</span><br><span class="line">     suggestions=<span class="variable constant_">NULL</span>,</span><br><span class="line">     popSize=<span class="number">200</span>, iters=<span class="number">100</span>,</span><br><span class="line">     mutationChance=<span class="variable constant_">NA</span>,</span><br><span class="line">     elitism=<span class="variable constant_">NA</span>,</span><br><span class="line">     monitorFunc=<span class="variable constant_">NULL</span>, evalFunc=<span class="variable constant_">NULL</span>,</span><br><span class="line">     showSettings=<span class="variable constant_">FALSE</span>, verbose=<span class="variable constant_">FALSE</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>stringMin，设置每个基因的最小值</li>
<li>stringMax，设置每个基因的最大值</li>
<li>suggestions，建议染色体的可选列表</li>
<li>popSize，个体数量，即染色体数目，默认为200</li>
<li>iters，迭代次数，默认为100</li>
<li>mutationChance，突变机会，默认为1&#x2F;(size+1)，它影响收敛速度和搜索空间的探测，低机率导致更快收敛，高机率增加了搜索空间的跨度。</li>
<li>elitism，精英数量，默认为20%，直接复制到下一代的染色体数目</li>
<li>monitorFunc，监控函数，每产生一代后运行</li>
<li>evalFunc，适应度函数，用于给个体进行评价</li>
<li>showSettings，打印设置，默认为false</li>
<li>verbose，打印算法运行日志，默认为false</li>
</ul>
<p>例如：设fx&#x3D;abs(x1-sqrt(exp(1)))+abs(x2-log(pi))，计算fx的最小值，其中x1,x2为2个不同的变量。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义适应度函数</span></span><br><span class="line">f&lt;-function(x)&#123;</span><br><span class="line">  <span class="keyword">return</span>(abs(x[<span class="number">1</span>]-sqrt(exp(<span class="number">1</span>)))+abs(x[<span class="number">2</span>]-log(pi)))</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义监控函数</span></span><br><span class="line">monitor &lt;- function(obj)&#123;</span><br><span class="line">  xlim = c(obj<span class="variable">$stringMin</span>[<span class="number">1</span>], obj<span class="variable">$stringMax</span>[<span class="number">1</span>]);</span><br><span class="line">  ylim = c(obj<span class="variable">$stringMin</span>[<span class="number">2</span>], obj<span class="variable">$stringMax</span>[<span class="number">2</span>]);</span><br><span class="line">  plot(obj<span class="variable">$population</span>, xlim=xlim, ylim=ylim, </span><br><span class="line">       xlab=<span class="string">&quot;pi&quot;</span>, ylab=<span class="string">&quot;sqrt(50)&quot;</span>);</span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行遗传算法 在命令行中运行</span></span><br><span class="line">m2 = rbga(c(<span class="number">1</span>,<span class="number">1</span>),</span><br><span class="line">           c(<span class="number">3</span>,<span class="number">3</span>),</span><br><span class="line">           popSize=<span class="number">100</span>,</span><br><span class="line">           iters=<span class="number">1000</span>,</span><br><span class="line">           evalFunc=f,</span><br><span class="line">           mutationChance=<span class="number">0.01</span>,</span><br><span class="line">           verbose=<span class="variable constant_">TRUE</span>,</span><br><span class="line">           monitorFunc=monitor</span><br><span class="line">           )</span><br><span class="line"></span><br><span class="line"><span class="comment">#计算结果</span></span><br><span class="line">m2<span class="variable">$population</span>[<span class="number">1</span>,]</span><br></pre></td></tr></table></figure>

<p>默认图输出，用于描述遗传过程的进展，X轴为迭代次数，Y轴评价值，评价值越接近于0越好。<br>在1000迭代1000次后，基本找到了精确的结果。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plot(m2)</span><br></pre></td></tr></table></figure>

<p>直方图输出，用于描述对染色体的基因选择频率，即一个基因在染色体中的当前人口被选择的次数。<br>当x1在1.65区域时，被选择超过80次；当x2在1.146区域时，被选择超过了80次。通过直方图，我们可以理解为更优秀的基因被留给了后代。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plot(m2,type=<span class="string">&#x27;hist&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>参数图输出，用于描述评价函数和变量的值的相关关系。对于x1，评价值越小，变量值越准确，但相关关系不明显。对于x2，看不出相关关系。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plot(m2,type=<span class="string">&#x27;vars&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>以下是genalg包官方给出的例子：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># optimize two values to match pi and sqrt(50)</span></span><br><span class="line">evaluate &lt;- function(string=c()) &#123;</span><br><span class="line">  returnVal = <span class="variable constant_">NA</span>;</span><br><span class="line">  <span class="keyword">if</span> (length(string) == <span class="number">2</span>) &#123;</span><br><span class="line">    returnVal = abs(string[<span class="number">1</span>]-pi) + abs(string[<span class="number">2</span>]-sqrt(<span class="number">50</span>));</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    stop(<span class="string">&quot;Expecting a chromosome of length 2!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  returnVal</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">monitor &lt;- function(obj) &#123;</span><br><span class="line">  <span class="comment"># plot the population</span></span><br><span class="line">  xlim = c(obj<span class="variable">$stringMin</span>[<span class="number">1</span>], obj<span class="variable">$stringMax</span>[<span class="number">1</span>]);</span><br><span class="line">  ylim = c(obj<span class="variable">$stringMin</span>[<span class="number">2</span>], obj<span class="variable">$stringMax</span>[<span class="number">2</span>]);</span><br><span class="line">  plot(obj<span class="variable">$population</span>, xlim=xlim, ylim=ylim, </span><br><span class="line">       xlab=<span class="string">&quot;pi&quot;</span>, ylab=<span class="string">&quot;sqrt(50)&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">rbga.results = rbga(c(<span class="number">1</span>, <span class="number">1</span>), c(<span class="number">5</span>, <span class="number">10</span>), monitorFunc=monitor, </span><br><span class="line">                    evalFunc=evaluate, verbose=<span class="variable constant_">TRUE</span>, mutationChance=<span class="number">0.01</span>)</span><br><span class="line"></span><br><span class="line">plot(rbga.results)</span><br><span class="line">plot(rbga.results, type=<span class="string">&quot;hist&quot;</span>)</span><br><span class="line">plot(rbga.results, type=<span class="string">&quot;vars&quot;</span>)</span><br></pre></td></tr></table></figure>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-07-24T05:26:23.443Z" title="7/24/2022, 1:26:23 PM">2022-07-24</time></span><span class="level-item">Updated&nbsp;<time dateTime="2022-07-24T05:26:23.443Z" title="7/24/2022, 1:26:23 PM">2022-07-24</time></span><span class="level-item"> YalesonChan </span><span class="level-item">18 minutes read (About 2709 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/07/24/2016-01-14-MACD/">MACD策略</a></h1><div class="content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>各位看官好，我是小陈。前两篇文章，我们一起写了个数据表格和走势图，恩，是不是很容易啊，有没有信心满满现在！那么，接下来，我们来个有点难度的。咱们一起写一下MACD股票策略吧。</p>
<p>移动平均线(MA)是股市中最常用的一种技术分析方法，用来在大行情的波动段找到有效的交易信号。移动平均线不仅简单，而且有效，对股市操作具有神奇的指导作用，能有效地打败大部分的主观策略，是炒股、炒期货的必备基本工具。</p>
<p>接下来，我们仔细研究一下MACD策略的简单而又神奇之处吧。</p>
<h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><p>1.MACD的介绍<br>2.均线模型展示<br>3.R语言实现MACD策略</p>
<h2 id="1、MACD的介绍"><a href="#1、MACD的介绍" class="headerlink" title="1、MACD的介绍"></a>1、MACD的介绍</h2><p>在介绍MACD之前，我们来介绍一下MA，也就是移动平均线。<br>移动平均线(MA,Moving average）是以道·琼斯的”平均成本概念”为理论基础，采用统计学中”移动平均”的原理，将一段时期内的股票价格平均值连成曲线，用来显示股价的历史波动情况，进而反映股价指数未来发展趋势的技术分析方法。它是道氏理论的形象化表述。<br>移动平均线的计算方法就是求连续若干天的收盘价的算术平均。天数就是MA的参数。</p>
<p>计算公式： MA &#x3D; (C1+C2+C3+C4+C5+….+Cn)&#x2F;n ,C为收盘价，n为移动平均周期数。例如，5日移动平均价格计算方法为：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">MA5</span> = （前四天收盘价+前三天收盘价+前天收盘价+昨天收盘价+今天收盘价）/<span class="number">5</span> </span><br></pre></td></tr></table></figure>

<p>移动平均线依时间长短可分为三种，即短期移动平均线，中期移动平均线，长期移动平均线。短期移动平均线一般以5日或10日为计算期间，中期移动平均线大多以30日、60日为计算期间；长期移动平均线大多以100天和200天为计算期间。有根据处理数据的方式的不同，移动平均线又分为简单移动平均线(SMA)、加权移动平均线(WMA)，以及指数平滑移动平均线(EMA)。</p>
<p>而今天我们说的，MACD(Moving Average Convergence &#x2F; Divergence)也是基于移动平均线发展而来。</p>
<p>MACD称为指数平滑移动平均线，是从双指数移动平均线发展而来的，由快的指数移动平均线（EMA）减去慢的指数移动平均线，MACD的意义和双移动平均线基本相同，但阅读起来更方便。当MACD从负数转向正数，是买的信号。当MACD从正数转向负数，是卖的信号。当MACD以大角度变化，表示快的移动平均线和慢的移动平均线的差距非常迅速的拉开，代表了一个市场大趋势的转变。</p>
<h2 id="2、均线模型展示"><a href="#2、均线模型展示" class="headerlink" title="2、均线模型展示"></a>2、均线模型展示</h2><p>这里，为了让大家能够跟更好的理解，我特地制作一下走势图。<br><a target="_blank" rel="noopener" href="https://i.qutke.com/apps/56a4fc1c310a3c464064943f"><img src="https://s3.cn-north-1.amazonaws.com.cn/static.qutke.com/report/56a4c67e9c61215c5fd0a6bb-Rplot03.png" alt="yieldchart"></a></p>
<p>这是以IBM2010年1月到2012年1月的股价走势。其中黑线代表的是K线（该公司每天的股价），蓝线代表的是ma5（该公司每5天收盘价的均值连成的曲线），以及绿线ma20（该公司每20天收盘价的均值连成的曲线）。可以看到，ma20被无数个红点以及紫点覆盖掉了。红点是表示此时ma5&gt;ma20，紫点是ma5&lt;ma20.</p>
<p>从图中，我们可以直观的看到，红线总是在上升，而紫线则总是在下降。自然而然地，大家就会想到，我们应该在红线的第一个点买入，在紫线的第一个点卖出，这样，我们就可以挣得更多钱了。</p>
<p>当然也不是说，使用了MACD策略，我们就一定赚钱，坐着收钱了。毕竟股市可不是这样简单的东西。但是MACD策略却可以让我们更加清晰的看到市场的本质，提高了胜率。不过，即便是有输有赢，我们也要找到胜率最高的那一只股票是不。以下这幅图便是我们今天的任务了。使用我们今天学到的MACD策略，并对这么一组股票进行模拟交易，然后按照收益率高低进行排序。第一行是沪深300指数，以作比较。</p>
<iframe style="width:100%;height:600px;border:0;padding:0;margin:0;" src="https://console.qutke.com/diagram/info/56a5ccbb310a3c4640649458?config={ %22color%22:%22%23ffffff%22}"></iframe>

<h2 id="3、R语言实现MACD策略"><a href="#3、R语言实现MACD策略" class="headerlink" title="3、R语言实现MACD策略"></a>3、R语言实现MACD策略</h2><p>1）初始化</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">library(quantmod)</span><br><span class="line">library(plyr)</span><br><span class="line">library(<span class="variable constant_">TTR</span>)</span><br><span class="line">library(scales)</span><br><span class="line">library(ggplot2)</span><br><span class="line">library(qutke)</span><br><span class="line">key &lt;- <span class="string">&#x27;faca4c8ff4dc1502d87944ea9cfd74f19918f0aef37fde6746b61d4d339bfcf3&#x27;</span></span><br><span class="line">init(key)</span><br></pre></td></tr></table></figure>

<p>2）选定参数</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sDate&lt;-as.Date(<span class="string">&quot;2015-1-1&quot;</span>) <span class="comment">#开始日期</span></span><br><span class="line">eDate&lt;-Sys.Date() <span class="comment">#结束日期</span></span><br><span class="line">tradingDay &lt;- getDate(data=<span class="string">&#x27;tradingDay&#x27;</span>,startdate=sDate,enddate=eDate,key=key)</span><br><span class="line">length &lt;- length(tradingDay)</span><br><span class="line">sDate &lt;- tradingDay[<span class="number">1</span>]</span><br><span class="line">eDate &lt;- tradingDay[length]</span><br></pre></td></tr></table></figure>

<p>可以通过getIndudtry方法获取况客的股票代码。不过因为有点多，所以我这里只选其中的20多支股票的股票代码。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># industry &lt;- getIndustry(data=&#x27;industryType&#x27;,date=eDate,key=key)</span></span><br><span class="line"><span class="comment"># qtid &lt;- industry$qtid</span></span><br><span class="line">qtid &lt;- c(<span class="string">&#x27;002230.SZ&#x27;</span>,<span class="string">&#x27;002715.SZ&#x27;</span>,<span class="string">&quot;603789.SH&quot;</span>, <span class="string">&quot;603799.SH&quot;</span>, <span class="string">&quot;603806.SH&quot;</span>, <span class="string">&quot;603808.SH&quot;</span>, <span class="string">&quot;603818.SH&quot;</span>,<span class="string">&quot;603828.SH&quot;</span>, <span class="string">&quot;603869.SH&quot;</span>, <span class="string">&quot;603883.SH&quot;</span>,</span><br><span class="line">          <span class="string">&quot;603885.SH&quot;</span>, <span class="string">&quot;603889.SH&quot;</span>, <span class="string">&quot;603898.SH&quot;</span>, <span class="string">&quot;603899.SH&quot;</span>, <span class="string">&quot;603901.SH&quot;</span>, <span class="string">&quot;603918.SH&quot;</span>, <span class="string">&quot;603939.SH&quot;</span>, <span class="string">&quot;603968.SH&quot;</span>,</span><br><span class="line">          <span class="string">&quot;603969.SH&quot;</span>, <span class="string">&quot;603988.SH&quot;</span> ,<span class="string">&quot;603989.SH&quot;</span>, <span class="string">&quot;603993.SH&quot;</span>, <span class="string">&quot;603997.SH&quot;</span>, <span class="string">&quot;603998.SH&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>3）获取每支股票的数据，包括每个交易日的收盘价、ma5、ma20.</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dailyQuote &lt;- getDailyQuote(data=<span class="string">&#x27;mktFwdDaily&#x27;</span>,qtid=qtid,startdate=sDate,enddate=eDate,key=key)</span><br><span class="line">ldata &lt;- dailyQuote[,grep(<span class="string">&quot;qtid|date|close|ma5|ma20&quot;</span>, names(dailyQuote)) ]</span><br><span class="line"><span class="comment">#为true时候，补全ldata中是na的数值，以最近日期的数据 进行赋值 </span></span><br><span class="line">ldata&lt;-na.locf(ldata, fromLast=<span class="variable constant_">TRUE</span>)</span><br></pre></td></tr></table></figure>

<p>因为这次涉及到的数据处理比较多，听起来也比较虚，所以，我们在写代码的时候，可以多查看一下所得到的变量的数据结构是什么样子的。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&gt; head(dailyQuote)</span><br><span class="line">       qtid       date close    volume      value    fwdAdj fwdAdjOpen fwdAdjHi fwdAdjLo fwdAdjClose       ret    logRet</span><br><span class="line"><span class="number">1</span> <span class="number">000001</span>.<span class="variable constant_">SZ</span> <span class="number">2015</span>-<span class="number">01</span>-<span class="number">05</span> <span class="number">16.02</span> <span class="number">286043643</span> <span class="number">4565387846</span> <span class="number">0.7574074</span>   <span class="number">12.11094</span> <span class="number">12.33059</span> <span class="number">11.81556</span>    <span class="number">12.13367</span>  <span class="number">0.011364</span>  <span class="number">0.011300</span></span><br><span class="line"><span class="number">2</span> <span class="number">000001</span>.<span class="variable constant_">SZ</span> <span class="number">2015</span>-<span class="number">01</span>-<span class="number">06</span> <span class="number">15.78</span> <span class="number">216642140</span> <span class="number">3453446168</span> <span class="number">0.7574074</span>   <span class="number">12.00491</span> <span class="number">12.41391</span> <span class="number">11.77769</span>    <span class="number">11.95189</span> -<span class="number">0.014981</span> -<span class="number">0.015095</span></span><br><span class="line"><span class="number">3</span> <span class="number">000001</span>.<span class="variable constant_">SZ</span> <span class="number">2015</span>-<span class="number">01</span>-<span class="number">07</span> <span class="number">15.48</span> <span class="number">170012067</span> <span class="number">2634796409</span> <span class="number">0.7574074</span>   <span class="number">11.78526</span> <span class="number">11.98976</span> <span class="number">11.58833</span>    <span class="number">11.72467</span> -<span class="number">0.019011</span> -<span class="number">0.019194</span></span><br><span class="line"><span class="number">4</span> <span class="number">000001</span>.<span class="variable constant_">SZ</span> <span class="number">2015</span>-<span class="number">01</span>-08 <span class="number">14.96</span> <span class="number">140771421</span> <span class="number">2128003432</span> <span class="number">0.7574074</span>   <span class="number">11.73981</span> <span class="number">11.79283</span> <span class="number">11.28537</span>    <span class="number">11.33081</span> -<span class="number">0.033592</span> -<span class="number">0.034169</span></span><br><span class="line"><span class="number">5</span> <span class="number">000001</span>.<span class="variable constant_">SZ</span> <span class="number">2015</span>-<span class="number">01</span>-09 <span class="number">15.08</span> <span class="number">250850023</span> <span class="number">3835378100</span> <span class="number">0.7574074</span>   <span class="number">11.28537</span> <span class="number">12.02006</span> <span class="number">11.14146</span>    <span class="number">11.42170</span>  <span class="number">0.008021</span>  <span class="number">0.007989</span></span><br><span class="line"><span class="number">6</span> <span class="number">000001</span>.<span class="variable constant_">SZ</span> <span class="number">2015</span>-<span class="number">01</span>-<span class="number">12</span> <span class="number">14.77</span> <span class="number">155329086</span> <span class="number">2293104602</span> <span class="number">0.7574074</span>   <span class="number">11.26265</span> <span class="number">11.39898</span> <span class="number">10.98241</span>    <span class="number">11.18691</span> -<span class="number">0.020557</span> -<span class="number">0.020771</span></span><br><span class="line">     vwap      vol30   ma5  ma10  ma20 ma60</span><br><span class="line"><span class="number">1</span> <span class="number">15.9605</span> <span class="number">8427448605</span> <span class="number">11.72</span> <span class="number">11.45</span> <span class="number">11.17</span> <span class="number">9.23</span></span><br><span class="line"><span class="number">2</span> <span class="number">15.9408</span> <span class="number">8529417547</span> <span class="number">11.82</span> <span class="number">11.51</span> <span class="number">11.22</span> <span class="number">9.30</span></span><br><span class="line"><span class="number">3</span> <span class="number">15.4977</span> <span class="number">8476692763</span> <span class="number">11.91</span> <span class="number">11.52</span> <span class="number">11.23</span> <span class="number">9.37</span></span><br><span class="line"><span class="number">4</span> <span class="number">15.1167</span> <span class="number">8460683917</span> <span class="number">11.83</span> <span class="number">11.54</span> <span class="number">11.27</span> <span class="number">9.43</span></span><br><span class="line"><span class="number">5</span> <span class="number">15.2895</span> <span class="number">8493042075</span> <span class="number">11.71</span> <span class="number">11.62</span> <span class="number">11.31</span> <span class="number">9.49</span></span><br><span class="line"><span class="number">6</span> <span class="number">14.7629</span> <span class="number">8437985489</span> <span class="number">11.52</span> <span class="number">11.62</span> <span class="number">11.34</span> <span class="number">9.55</span></span><br><span class="line"></span><br><span class="line">&gt; head(ldata)</span><br><span class="line">       qtid       date  close    ma5  ma20</span><br><span class="line"><span class="number">1</span> <span class="number">002230</span>.<span class="variable constant_">SZ</span> <span class="number">2015</span>-<span class="number">01</span>-<span class="number">05</span>  <span class="number">27.40</span>  <span class="number">17.11</span> <span class="number">18.17</span></span><br><span class="line"><span class="number">2</span> <span class="number">002230</span>.<span class="variable constant_">SZ</span> <span class="number">2015</span>-<span class="number">01</span>-<span class="number">06</span>  <span class="number">27.72</span>  <span class="number">16.99</span> <span class="number">18.12</span></span><br><span class="line"><span class="number">3</span> <span class="number">002230</span>.<span class="variable constant_">SZ</span> <span class="number">2015</span>-<span class="number">01</span>-<span class="number">07</span>  <span class="number">27.20</span>  <span class="number">16.95</span> <span class="number">18.08</span></span><br><span class="line"><span class="number">4</span> <span class="number">002230</span>.<span class="variable constant_">SZ</span> <span class="number">2015</span>-<span class="number">01</span>-08  <span class="number">27.20</span>  <span class="number">17.07</span> <span class="number">18.04</span></span><br><span class="line"><span class="number">5</span> <span class="number">002230</span>.<span class="variable constant_">SZ</span> <span class="number">2015</span>-<span class="number">01</span>-09  <span class="number">27.10</span>  <span class="number">17.13</span> <span class="number">17.97</span></span><br><span class="line"><span class="number">6</span> <span class="number">002230</span>.<span class="variable constant_">SZ</span> <span class="number">2015</span>-<span class="number">01</span>-<span class="number">12</span>  <span class="number">27.91</span>  <span class="number">17.19</span> <span class="number">17.93</span></span><br></pre></td></tr></table></figure>

<p>4）以UP、Down标定。</p>
<p>对每只股票，以其每个交易日的ma20与ma5进行比较，当ma5&gt;ma20时候，取UP，当ma5&lt;ma20时候，取Down。然后，对数据以qtid为准进行分离并依照日期排序。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 散点数据</span></span><br><span class="line">genPoint&lt;-function(arg=c(),ldata)&#123;</span><br><span class="line">  <span class="keyword">if</span>(length(arg)&gt;<span class="number">2</span>)&#123;</span><br><span class="line">    stop(<span class="string">&#x27;The length of args is two.&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(length(arg)&lt;<span class="number">2</span>)&#123;</span><br><span class="line">    arg &lt;- c(arg,<span class="number">2</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">#[,c(1,arg[1])]</span></span><br><span class="line">  pdata &lt;- ldata[which(ldata[,arg[<span class="number">2</span>]]&gt;ldata[,arg[<span class="number">1</span>]]),]</span><br><span class="line">  pdata &lt;- cbind(pdata,<span class="string">&#x27;op&#x27;</span>=c(<span class="string">&#x27;Down&#x27;</span>)) <span class="comment">#添加op列</span></span><br><span class="line">  xdata &lt;- ldata[which(ldata[,arg[<span class="number">2</span>]]&lt;=ldata[,arg[<span class="number">1</span>]]),]</span><br><span class="line">  xdata &lt;- cbind(xdata,<span class="string">&#x27;op&#x27;</span>=<span class="string">&#x27;UP&#x27;</span>)</span><br><span class="line">  <span class="keyword">return</span>(rbind(pdata,xdata))</span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">#以qtid分离数据，并返回一个list</span></span><br><span class="line">separateQtid&lt;-function(pdata,qtid)&#123;</span><br><span class="line">  <span class="keyword">if</span>(length(qtid)&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">    stop(<span class="string">&#x27;The length of qtid is at least one.&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  xdata &lt;- list()</span><br><span class="line">  <span class="keyword">for</span>(id <span class="keyword">in</span> qtid)&#123;</span><br><span class="line">    xdata[[id]] &lt;- pdata[which(pdata<span class="variable">$qtid</span>==id),]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span>(xdata)</span><br><span class="line">&#125;</span><br><span class="line">pdata&lt;-genPoint(c(<span class="number">5</span>,<span class="number">4</span>),ldata)</span><br><span class="line">pdata &lt;- separateQtid(pdata,qtid)</span><br><span class="line"><span class="comment">#以date数据进行排序</span></span><br><span class="line"><span class="keyword">for</span>(id <span class="keyword">in</span> qtid)&#123;</span><br><span class="line">  pdata[[id]] &lt;- pdata[[id]][order(pdata[[id]]<span class="variable">$date</span>,decreasing=F),]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>这个时候pdata是一个list类型的结构，所以我只列出其中一个元素的前几行数据以展示。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; head(pdata[[<span class="number">1</span>]])</span><br><span class="line">       qtid       date close   ma5  ma20   op</span><br><span class="line"><span class="number">1</span> <span class="number">002230</span>.<span class="variable constant_">SZ</span> <span class="number">2014</span>-<span class="number">01</span>-<span class="number">02</span> <span class="number">48.07</span> <span class="number">17.36</span> <span class="number">17.28</span> Down</span><br><span class="line"><span class="number">2</span> <span class="number">002230</span>.<span class="variable constant_">SZ</span> <span class="number">2014</span>-<span class="number">01</span>-<span class="number">03</span> <span class="number">47.05</span> <span class="number">17.41</span> <span class="number">17.29</span> Down</span><br><span class="line"><span class="number">3</span> <span class="number">002230</span>.<span class="variable constant_">SZ</span> <span class="number">2014</span>-<span class="number">01</span>-<span class="number">06</span> <span class="number">45.12</span> <span class="number">17.27</span> <span class="number">17.29</span>   <span class="variable constant_">UP</span></span><br><span class="line"><span class="number">4</span> <span class="number">002230</span>.<span class="variable constant_">SZ</span> <span class="number">2014</span>-<span class="number">01</span>-<span class="number">07</span> <span class="number">45.08</span> <span class="number">17.12</span> <span class="number">17.27</span>   <span class="variable constant_">UP</span></span><br><span class="line"><span class="number">5</span> <span class="number">002230</span>.<span class="variable constant_">SZ</span> <span class="number">2014</span>-<span class="number">01</span>-08 <span class="number">45.44</span> <span class="number">16.95</span> <span class="number">17.24</span>   <span class="variable constant_">UP</span></span><br><span class="line"><span class="number">6</span> <span class="number">002230</span>.<span class="variable constant_">SZ</span> <span class="number">2014</span>-<span class="number">01</span>-09 <span class="number">45.42</span> <span class="number">16.75</span> <span class="number">17.18</span>   <span class="variable constant_">UP</span></span><br></pre></td></tr></table></figure>

<p>5）选择交易点。</p>
<p>也就是上面的走势图所说的，在红线的第一点买入，在紫线的第一点卖出。<br>模型设计思路：</p>
<ol>
<li>以5日均线和20日均线的交叉，进行交易信号的判断。</li>
<li>当5日均线上穿20日均线则买入(红色)，下穿20日均线卖出(蓝色)。</li>
</ol>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Signal&lt;-function(ldata=c(),pdata,qtid)&#123;</span><br><span class="line">  <span class="keyword">if</span>(length(qtid)&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">    stop(<span class="string">&#x27;The length of qtid is at least one.&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  op1 &lt;- list()</span><br><span class="line">  <span class="keyword">for</span>(id <span class="keyword">in</span> qtid)&#123;</span><br><span class="line">    pdata[[id]] &lt;- pdata[[id]][order(pdata[[id]]<span class="variable">$date</span>,decreasing=F),]</span><br><span class="line">    op &lt;- pdata[[id]][<span class="number">1</span>,]</span><br><span class="line">    tmp &lt;- op<span class="variable">$op</span></span><br><span class="line">    i &lt;- <span class="number">2</span></span><br><span class="line">    nrow &lt;- nrow(pdata[[id]])</span><br><span class="line">    <span class="keyword">while</span>(i&lt;=nrow)&#123;</span><br><span class="line">      <span class="keyword">if</span>(tmp!=pdata[[id]][i,]<span class="variable">$op</span>)&#123;</span><br><span class="line">        op &lt;- rbind(op,pdata[[id]][i,])</span><br><span class="line">      &#125;</span><br><span class="line">      tmp &lt;- pdata[[id]][i,]<span class="variable">$op</span></span><br><span class="line">      i=i+<span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    op1[[id]] &lt;- op</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span>(op1)</span><br><span class="line">&#125;</span><br><span class="line">tdata&lt;-Signal(ldata,pdata,qtid)</span><br></pre></td></tr></table></figure>

<p>同pdata一样，这也是只展示了tdata的部分。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; head(tdata[[<span class="number">1</span>]])</span><br><span class="line">        qtid       date close   ma5  ma20   op</span><br><span class="line"><span class="number">1</span>  <span class="number">002230</span>.<span class="variable constant_">SZ</span> <span class="number">2014</span>-<span class="number">01</span>-<span class="number">02</span> <span class="number">48.07</span> <span class="number">17.36</span> <span class="number">17.28</span> Down</span><br><span class="line"><span class="number">3</span>  <span class="number">002230</span>.<span class="variable constant_">SZ</span> <span class="number">2014</span>-<span class="number">01</span>-<span class="number">06</span> <span class="number">45.12</span> <span class="number">17.27</span> <span class="number">17.29</span>   <span class="variable constant_">UP</span></span><br><span class="line"><span class="number">10</span> <span class="number">002230</span>.<span class="variable constant_">SZ</span> <span class="number">2014</span>-<span class="number">01</span>-<span class="number">15</span> <span class="number">48.80</span> <span class="number">17.14</span> <span class="number">17.10</span> Down</span><br><span class="line"><span class="number">36</span> <span class="number">002230</span>.<span class="variable constant_">SZ</span> <span class="number">2014</span>-<span class="number">02</span>-<span class="number">27</span> <span class="number">49.85</span> <span class="number">19.18</span> <span class="number">19.48</span>   <span class="variable constant_">UP</span></span><br><span class="line"><span class="number">64</span> <span class="number">002230</span>.<span class="variable constant_">SZ</span> <span class="number">2014</span>-<span class="number">04</span>-09 <span class="number">46.82</span> <span class="number">16.94</span> <span class="number">16.86</span> Down</span><br><span class="line"><span class="number">72</span> <span class="number">002230</span>.<span class="variable constant_">SZ</span> <span class="number">2014</span>-<span class="number">04</span>-<span class="number">21</span> <span class="number">25.71</span> <span class="number">16.88</span> <span class="number">16.91</span>   <span class="variable constant_">UP</span></span><br></pre></td></tr></table></figure>

<p>6）模拟交易</p>
<p>预先设定参数是：本金为100000元，每次都全部买入卖出，即持仓比例为1，手续费为0.</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#利用交易信号数据，进行模拟交易</span></span><br><span class="line"><span class="comment">#参数：交易信号tdata ,本金capital,持仓比例position,手续费比例fee</span></span><br><span class="line">trade&lt;-function(tdata,capital=<span class="number">100000</span>,position=<span class="number">1</span>,fee=<span class="number">0</span>)&#123;</span><br><span class="line">  value &lt;- as.numeric(tdata<span class="variable">$close</span>) </span><br><span class="line">  asset &lt;- capital</span><br><span class="line">  <span class="keyword">if</span>(tdata[<span class="number">1</span>,]<span class="variable">$op</span>==<span class="string">&#x27;Down&#x27;</span>)&#123;</span><br><span class="line">    amount &lt;- (asset*position)<span class="string">%/%value[1]</span></span><br><span class="line"><span class="string">    cash &lt;- (asset*position)%%value[1]</span></span><br><span class="line"><span class="string">    #奇数为0，偶数为asset减去上一次的。</span></span><br><span class="line"><span class="string">    diff &lt;- 0.00</span></span><br><span class="line"><span class="string">  &#125;else if(tdata[1,]$op==&#x27;UP&#x27;)&#123;</span></span><br><span class="line"><span class="string">    amount &lt;- 0</span></span><br><span class="line"><span class="string">    cash &lt;- asset</span></span><br><span class="line"><span class="string">    diff &lt;- 0.00</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  i&lt;-2</span></span><br><span class="line"><span class="string">  nrow &lt;- nrow(tdata)</span></span><br><span class="line"><span class="string">  while(i&lt;=nrow)&#123;</span></span><br><span class="line"><span class="string">    #Down 买入</span></span><br><span class="line"><span class="string">    if(tdata[i,]$op==&#x27;Down&#x27;)&#123;</span></span><br><span class="line"><span class="string">      asset &lt;- c(asset,tail(asset,1))</span></span><br><span class="line"><span class="string">      amount &lt;- c(amount,(tail(asset,1)*position)%/</span>%value[i])</span><br><span class="line">      cash &lt;- c(cash,(tail(asset,<span class="number">1</span>)*position)<span class="string">%%value[i]+(tail(asset,1)*(1-position)))</span></span><br><span class="line"><span class="string">      diff &lt;- c(diff,0.00)</span></span><br><span class="line"><span class="string">    &#125;else if(tdata[i,]$op==&#x27;UP&#x27;)&#123;</span></span><br><span class="line"><span class="string">      #UP 卖出</span></span><br><span class="line"><span class="string">      cash &lt;- c(cash,(tail(amount,1)*value[i])+tail(cash,1))</span></span><br><span class="line"><span class="string">      amount &lt;- c(amount,0)</span></span><br><span class="line"><span class="string">      asset &lt;- c(asset,tail(amount,1)*value[i]+tail(cash,1))</span></span><br><span class="line"><span class="string">      diff &lt;- c(diff,tail(asset,1)-tail(asset,2)[1])</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    i=i+1</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  result &lt;- list()</span></span><br><span class="line"><span class="string">  result[[&#x27;ticks&#x27;]] &lt;- cbind(tdata,cash,amount,asset,diff)</span></span><br><span class="line"><span class="string">  indexRise &lt;- c()</span></span><br><span class="line"><span class="string">  indexFall &lt;- c()</span></span><br><span class="line"><span class="string">  i &lt;- 2</span></span><br><span class="line"><span class="string">  while(i&lt;=nrow)&#123;</span></span><br><span class="line"><span class="string">    if(result[[&#x27;ticks&#x27;]][i,]$diff &gt; 0)&#123;</span></span><br><span class="line"><span class="string">      indexRise &lt;- c(indexRise,i-1,i)</span></span><br><span class="line"><span class="string">    &#125;else if(result[[&#x27;ticks&#x27;]][i,]$diff &lt; 0)&#123;</span></span><br><span class="line"><span class="string">      indexFall &lt;- c(indexFall,i-1,i)</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    i &lt;- i+1</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  result[[&#x27;rise&#x27;]] &lt;- result$ticks[indexRise,]</span></span><br><span class="line"><span class="string">  result[[&#x27;fall&#x27;]] &lt;- result$ticks[indexFall,]</span></span><br><span class="line"><span class="string">  return(result)</span></span><br><span class="line"><span class="string">&#125; </span></span><br><span class="line"><span class="string">#设定交易参数，以$10W为本金，满仓买入或卖出，手续为0，传入交易信号。</span></span><br><span class="line"><span class="string"># 查看每笔交易，将会变成一个list，保存每一个qtid的交易记录result</span></span><br><span class="line"><span class="string">#每一个qtid的交易记录</span></span><br><span class="line"><span class="string">tradeList &lt;- list()</span></span><br><span class="line"><span class="string">for(id in qtid)&#123;</span></span><br><span class="line"><span class="string">  tradeList[[id]] &lt;- trade(tdata[[id]],100000)</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<p>7）计算收益率，并记录在一个列表里面，生成dataframe，信息包含日期，代码，名称，收益率，涨跌幅，近1周涨跌，近1月涨跌，年初至今涨跌。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">income &lt;- c()</span><br><span class="line">quoteChangeDaily &lt;- c()</span><br><span class="line">quoteChangeWeek &lt;- c()</span><br><span class="line">quoteChangeMonth &lt;- c() </span><br><span class="line">quoteChangeFYear &lt;- c()</span><br><span class="line"><span class="keyword">for</span>(id <span class="keyword">in</span> qtid)&#123;</span><br><span class="line">  <span class="comment">#C(),收益率。收益率 = （当天的股价-买入价）/ 买入价 *100%</span></span><br><span class="line">  income &lt;- c(income,(tail(tradeList[[id]]$ticks<span class="variable">$asset</span>,<span class="number">1</span>)-tradeList[[id]]$ticks<span class="variable">$asset</span>[<span class="number">1</span>])/tradeList[[id]]$ticks<span class="variable">$asset</span>[<span class="number">1</span>]*<span class="number">100</span>)</span><br><span class="line">  mktYest &lt;- getDailyQuote(data=<span class="string">&#x27;mktFwdDaily&#x27;</span>,qtid = id,startdate=pdata[[id]]<span class="variable">$date</span>[nrow(pdata[[id]])-<span class="number">1</span>],enddate=pdata[[id]]<span class="variable">$date</span>[nrow(pdata[[id]])-<span class="number">1</span>],key=key)</span><br><span class="line">  mktWeek &lt;- getDailyQuote(data=<span class="string">&#x27;mktFwdDaily&#x27;</span>,qtid = id,startdate=pdata[[id]]<span class="variable">$date</span>[nrow(pdata[[id]])-<span class="number">5</span>],enddate=pdata[[id]]<span class="variable">$date</span>[nrow(pdata[[id]])-<span class="number">5</span>],key=key)</span><br><span class="line">  mktMonth &lt;- getDailyQuote(data=<span class="string">&#x27;mktFwdDaily&#x27;</span>,qtid = id,startdate=pdata[[id]]<span class="variable">$date</span>[nrow(pdata[[id]])-<span class="number">20</span>],enddate=pdata[[id]]<span class="variable">$date</span>[nrow(pdata[[id]])-<span class="number">20</span>],key=key)</span><br><span class="line">  mktFYear &lt;- getDailyQuote(data=<span class="string">&#x27;mktFwdDaily&#x27;</span>,qtid = id,startdate=pdata[[id]]<span class="variable">$date</span>[<span class="number">1</span>],enddate=pdata[[id]]<span class="variable">$date</span>[<span class="number">1</span>],key=key)</span><br><span class="line">  <span class="comment">#涨跌幅 .涨跌幅的计算公式是：(当前最新成交价（或收盘价）-开盘参考价)÷开盘参考价×100%  [which(mktYest$qtid==id),]</span></span><br><span class="line">  quoteChangeDaily &lt;- c(quoteChangeDaily,(as.numeric(tail(pdata[[id]], <span class="number">1</span>)<span class="variable">$close</span>)-mktYest<span class="variable">$close</span>)/mktYest<span class="variable">$close</span>*<span class="number">100</span>)</span><br><span class="line">  <span class="comment">#近1周涨跌</span></span><br><span class="line">  quoteChangeWeek &lt;- c(quoteChangeWeek,(as.numeric(tail(pdata[[id]], <span class="number">1</span>)<span class="variable">$close</span>)-mktWeek<span class="variable">$close</span>)/mktWeek<span class="variable">$close</span>*<span class="number">100</span>)</span><br><span class="line">  <span class="comment">#近1月涨跌</span></span><br><span class="line">  quoteChangeMonth &lt;- c(quoteChangeMonth,(as.numeric(tail(pdata[[id]], <span class="number">1</span>)<span class="variable">$close</span>)-mktMonth<span class="variable">$close</span>)/mktMonth<span class="variable">$close</span>*<span class="number">100</span>)</span><br><span class="line">  <span class="comment">#年初至今涨跌</span></span><br><span class="line">  quoteChangeFYear &lt;- c(quoteChangeFYear,(as.numeric(tail(pdata[[id]], <span class="number">1</span>)<span class="variable">$close</span>)-mktFYear<span class="variable">$close</span>)/mktFYear<span class="variable">$close</span>*<span class="number">100</span>)</span><br><span class="line">&#125;</span><br><span class="line">ChiAbbr &lt;- getMD(data=<span class="string">&#x27;keyMap&#x27;</span>,qtid=qtid,key=key)<span class="variable">$ChiAbbr</span></span><br><span class="line">maDF &lt;- data.frame(<span class="string">&#x27;1&#x27;</span>=tail(dailyQuote,<span class="number">1</span>)<span class="variable">$date</span>,<span class="string">&#x27;2&#x27;</span>=qtid,<span class="string">&#x27;3&#x27;</span>=ChiAbbr,</span><br><span class="line">                   <span class="string">&#x27;4&#x27;</span>=income,<span class="string">&#x27;5&#x27;</span>=quoteChangeDaily,<span class="string">&#x27;6&#x27;</span>=quoteChangeWeek,<span class="string">&#x27;7&#x27;</span>=quoteChangeMonth,</span><br><span class="line">                   <span class="string">&#x27;8&#x27;</span>=quoteChangeFYear)</span><br><span class="line"><span class="comment">#排序</span></span><br><span class="line">maDF &lt;- maDF[order(maDF<span class="variable">$X4</span>,decreasing=T),]</span><br></pre></td></tr></table></figure>

<p>8）求取沪深300指数</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">hs300&lt;-getDailyQuote(data=<span class="string">&#x27;mktDataIndex&#x27;</span>,qtid=c(<span class="string">&#x27;000300.SH&#x27;</span>),startdate=sDate,enddate=eDate,key=key) </span><br><span class="line"></span><br><span class="line">id &lt;- c(<span class="string">&#x27;000300.SH&#x27;</span>)</span><br><span class="line"></span><br><span class="line">hs300mktWeek &lt;- hs300[nrow(hs300)-<span class="number">5</span>,]</span><br><span class="line"></span><br><span class="line">hs300mktMonth &lt;- hs300[nrow(hs300)-<span class="number">20</span>,]</span><br><span class="line"></span><br><span class="line">hs300mktFYear &lt;- hs300[<span class="number">1</span>,]</span><br><span class="line"></span><br><span class="line">quoteChangeDaily &lt;- (tail(hs300,<span class="number">1</span>)<span class="variable">$close</span>-tail(hs300,<span class="number">1</span>)<span class="variable">$prevClose</span>)/tail(hs300,<span class="number">1</span>)<span class="variable">$prevClose</span>*<span class="number">100</span></span><br><span class="line"></span><br><span class="line">quoteChangeWeek &lt;- (tail(hs300,<span class="number">1</span>)<span class="variable">$close</span>-hs300mktWeek<span class="variable">$close</span>)/hs300mktWeek<span class="variable">$close</span>*<span class="number">100</span></span><br><span class="line"></span><br><span class="line">quoteChangeMonth &lt;- (tail(hs300,<span class="number">1</span>)<span class="variable">$close</span>-hs300mktMonth<span class="variable">$close</span>)/hs300mktMonth<span class="variable">$close</span>*<span class="number">100</span></span><br><span class="line"></span><br><span class="line">quoteChangeFYear &lt;- (tail(hs300,<span class="number">1</span>)<span class="variable">$close</span>-hs300mktFYear<span class="variable">$close</span>)/hs300mktFYear<span class="variable">$close</span>*<span class="number">100</span></span><br><span class="line"></span><br><span class="line">hs300Income &lt;- c()</span><br><span class="line"></span><br><span class="line">hs300Income &lt;- (tail(hs300,<span class="number">1</span>)<span class="variable">$close</span>-hs300mktFYear<span class="variable">$close</span>)/hs300mktFYear<span class="variable">$close</span>*<span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#生成dataframe</span></span><br><span class="line">hs300Dt &lt;- data.frame(<span class="string">&#x27;1&#x27;</span>=tail(dailyQuote,<span class="number">1</span>)<span class="variable">$date</span>,<span class="string">&#x27;2&#x27;</span>=<span class="string">&#x27;000300.SH&#x27;</span>,<span class="string">&#x27;3&#x27;</span>=<span class="string">&#x27;沪深300&#x27;</span>,<span class="string">&#x27;4&#x27;</span>=hs300Income,<span class="string">&#x27;5&#x27;</span>=quoteChangeDaily,<span class="string">&#x27;6&#x27;</span>=quoteChangeWeek,<span class="string">&#x27;7&#x27;</span>=quoteChangeMonth,<span class="string">&#x27;8&#x27;</span>=quoteChangeFYear)</span><br></pre></td></tr></table></figure>

<p>沪深300指数的数据是这样的：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; hs300Dt </span><br><span class="line">          <span class="variable constant_">X1</span>        <span class="variable constant_">X2</span>      <span class="variable constant_">X3</span>        <span class="variable constant_">X4</span>       <span class="variable constant_">X5</span>         <span class="variable constant_">X6</span>        <span class="variable constant_">X7</span>        <span class="variable constant_">X8</span></span><br><span class="line"><span class="number">1</span> <span class="number">2016</span>-<span class="number">01</span>-<span class="number">22</span> <span class="number">000300</span>.<span class="variable constant_">SH</span> 沪深<span class="number">300</span> -<span class="number">14.50151</span> <span class="number">1.042311</span> -<span class="number">0.1688989</span> -<span class="number">18.69586</span> -<span class="number">14.50151</span></span><br></pre></td></tr></table></figure>

<p>9）合并数据，并发送到况客投研平台，进行后期的修改。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">maDF &lt;- rbind(hs300Dt,maDF)</span><br><span class="line">names(maDF)&lt;-c(<span class="string">&#x27;日期&#x27;</span>,<span class="string">&#x27;代码&#x27;</span>,<span class="string">&#x27;名称&#x27;</span>,<span class="string">&#x27;收益率(%)&#x27;</span>,<span class="string">&#x27;涨跌幅(%)&#x27;</span>,<span class="string">&#x27;周涨跌幅(%)&#x27;</span>,<span class="string">&#x27;月涨跌幅(%)&#x27;</span>,<span class="string">&#x27;年初至今涨跌幅（%）&#x27;</span>)</span><br><span class="line">postData(maDF,name=<span class="string">&#x27;maDataF&#x27;</span>,key=key)</span><br></pre></td></tr></table></figure>


<p>这样，便算是完成了。大家如果有什么不明白的话，可以随时艾特我哦。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-07-24T05:25:43.299Z" title="7/24/2022, 1:25:43 PM">2022-07-24</time></span><span class="level-item">Updated&nbsp;<time dateTime="2022-07-24T05:25:43.299Z" title="7/24/2022, 1:25:43 PM">2022-07-24</time></span><span class="level-item"> YalesonChan </span><span class="level-item">10 minutes read (About 1571 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/07/24/2016-01-13-Classification-Form/">申万行业分类日间表格</a></h1><div class="content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>申银万国证券股份有限公司（简称：申银万国），是国内最早的一家股份制证券公司，也是目前国内规模最大、经营业务最齐全、营业网点分布最广泛的综合类证券公司之一。为能够实时掌握申银万国各行业的股市数据，包括当天收盘价、成交量、涨跌幅等，以应对变化多端的市场，采取正确的举措，收获最大的利益，所以一个能够实时生成申万行业分类日间表格是十分需要的。接下来，我们便使用况客Api实现这个的表格。</p>
<h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><p>1、申万行业分类日间表格的介绍</p>
<p>2、使用况客API实现的具体思路</p>
<h2 id="1-申万行业分类日间表格的介绍"><a href="#1-申万行业分类日间表格的介绍" class="headerlink" title="1.申万行业分类日间表格的介绍"></a>1.申万行业分类日间表格的介绍</h2><p>在开始动手之前，我们先看看我们要制作的成品是什么样子的吧。如下图：</p>
<iframe style="width:100%;height:600px;border:0;padding:0;margin:0;" src="https://console.qutke.com/diagram/info/569767d1310a3c464064932f?config={ %22color%22:%22%23ffffff%22}"></iframe>

<p>上图，是搜索的申万行业一级行业中各个个股当天的基本数据，包括了当天收盘价、成交量、涨跌幅、周涨跌幅、月涨跌幅、年涨跌幅等等。（注：此处搜索的申万行业一级行业是“商业贸易”，即SW1 &lt;- ‘商业贸易’）当然，你也可以根据需要选定表格的内容。</p>
<p>从表格，我们可以了解到我们关注的个股的情况，看他目前是张还是跌，涨跌幅多大，通过比较周涨跌幅、月涨跌幅、年涨跌幅来判断该个股是否值得投资，以更好的做出正确的判断、举措。</p>
<h2 id="2-使用况客API实现表格的具体思路"><a href="#2-使用况客API实现表格的具体思路" class="headerlink" title="2.使用况客API实现表格的具体思路"></a>2.使用况客API实现表格的具体思路</h2><p>1、系统环境</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">win7</span><br><span class="line">RStudio</span><br><span class="line">qutke</span><br></pre></td></tr></table></figure>

<p>需要提前下载况客R语言Api，即qutke，GitHub链接是：<a target="_blank" rel="noopener" href="https://github.com/qutke/qutke">https://github.com/qutke/qutke</a><br>可以安装注册git，通过git命令来下载相应的R包。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone <span class="symbol">https:</span>/<span class="regexp">/github.com/qutke</span><span class="regexp">/qutke.git </span></span><br></pre></td></tr></table></figure>

<p>也可以通过RStudio命令来下载：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">library(devtools)</span><br><span class="line">install_github(<span class="string">&#x27;qutke/qutke&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>2、咱们需要初始化，为正式编写代码做个准备吧，就像木匠一样，先把原材料以及工具准备好，才干活是不。其中，我们需要安装需要使用的R包，这里我们要用得到的有与date日期相关的lubridate包，以及我们刚下载的qutke。接着，通过数据库key，我们进行初始化，并与数据库连接上。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装相应的需要使用的R包</span></span><br><span class="line">library(<span class="string">&#x27;lubridate&#x27;</span>)</span><br><span class="line">library(qutke)</span><br><span class="line">key&lt;-<span class="string">&#x27;ff5ed58edf645c6581e8148db1130dc310fbab5fdccc4b2a9ea0be30f4128ace&#x27;</span></span><br><span class="line">init(key)</span><br></pre></td></tr></table></figure>

<p>3、定义变量，取得需要的参数</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">date &lt;- Sys.Date()</span><br><span class="line"><span class="comment">#获取交易日期，虽然在init(key)函数里面就已经取得了tradingDay，并且保存在e$TRADINGDAY变量中。</span></span><br><span class="line"><span class="comment">#不过这里为了介绍getDate()函数。于是就写明了吧。</span></span><br><span class="line">lastYearDate &lt;- as.Date(paste(year(date)-<span class="number">1</span>,month(date),day(date),sep=<span class="string">&#x27;-&#x27;</span>))</span><br><span class="line">tradingDay &lt;- getDate(data=<span class="string">&#x27;tradingDay&#x27;</span>,startdate=lastYearDate,enddate=date,key=key)</span><br><span class="line">length &lt;- length(tradingDay)</span><br><span class="line">date &lt;- tradingDay[length]</span><br><span class="line"><span class="comment">#进行筛选,判断其SW1,此时只对‘商业贸易’这一行业进行筛选</span></span><br><span class="line">sw1 &lt;- <span class="string">&#x27;商业贸易&#x27;</span></span><br><span class="line"><span class="comment">#通过getIndustry()函数，取得SW1，即‘商业贸易’这一行业相对应的个股</span></span><br><span class="line">industry &lt;- getIndustry(data=<span class="string">&#x27;industryType&#x27;</span>,date=date,<span class="variable constant_">SW1</span>=sw1,key=key)</span><br><span class="line"><span class="comment">#符合条件的个股的股票代码</span></span><br><span class="line">qtid &lt;- industry<span class="variable">$qtid</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#获得今年的第一个交易日日期</span></span><br><span class="line">FirstDay &lt;- as.Date(paste(year(date)-<span class="number">1</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;1&#x27;</span>,sep=<span class="string">&#x27;-&#x27;</span>))</span><br><span class="line">FirstDay &lt;- (getDate(data=<span class="string">&#x27;tradingDay&#x27;</span>,startdate=FirstDay,enddate=date,key=key))[<span class="number">1</span>]</span><br></pre></td></tr></table></figure>

<p>4、依照股票代码qtid来筛选获取数据库中这些个股的数据，并进行计算。此处，我们可以直接获得当天的收盘价、成交量，但是涨跌幅是需要进行计算的。<br>涨跌幅的计算公式是：(当前最新成交价（或收盘价）-开盘参考价)÷开盘参考价×100%<br>一般情况： 开盘参考价&#x3D;前一交易日收盘价<br>除权息日： 开盘参考价&#x3D;除权后的参考价<br>我们参考以上涨跌幅的计算公式，可以计算当天的涨跌幅，至于周涨跌幅，则是要把开盘参考价改为5个交易日前的收盘价即可，至于月涨跌幅、年涨跌幅、年初至今涨跌幅，亦是一个道理。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#选用不复权</span></span><br><span class="line"><span class="comment">#通过getDailyQuote()方法获取股票日间行情。</span></span><br><span class="line">mktDaily &lt;- getDailyQuote(data=<span class="string">&#x27;mktDaily&#x27;</span>,qtid = qtid,startdate=date,enddate=date,key=key)</span><br><span class="line">qtid &lt;- mktDaily<span class="variable">$qtid</span></span><br><span class="line"><span class="comment">#个股证券名称</span></span><br><span class="line">SecuAbbr &lt;- (getIndustry(data=<span class="string">&#x27;industryType&#x27;</span>,qtid = qtid,date=date,<span class="variable constant_">SW1</span>=sw1,key=key))<span class="variable">$SecuAbbr</span></span><br><span class="line"><span class="comment">#当日收盘价</span></span><br><span class="line">close&lt;- mktDaily<span class="variable">$close</span></span><br><span class="line"><span class="comment">#当日交易量</span></span><br><span class="line">volume &lt;- mktDaily<span class="variable">$volume</span></span><br><span class="line"><span class="comment">#上一交易日的收盘价</span></span><br><span class="line">prevClose &lt;- mktDaily<span class="variable">$prevClose</span></span><br><span class="line"><span class="comment">#当日涨跌幅</span></span><br><span class="line">quoteChangeDaily &lt;- (close-prevClose)/prevClose</span><br><span class="line"><span class="comment">#获取近期的数据，分别为近一周、近一月、近一年、年初</span></span><br><span class="line">mktWeek &lt;- getDailyQuote(data=<span class="string">&#x27;mktDaily&#x27;</span>,qtid = qtid,startdate=tradingDay[length-<span class="number">5</span>],enddate=tradingDay[length-<span class="number">5</span>],key=key)</span><br><span class="line">mktMonth &lt;- getDailyQuote(data=<span class="string">&#x27;mktDaily&#x27;</span>,qtid = qtid,startdate=tradingDay[length-<span class="number">20</span>],enddate=tradingDay[length-<span class="number">20</span>],key=key)</span><br><span class="line">mktYear &lt;- getDailyQuote(data=<span class="string">&#x27;mktDaily&#x27;</span>,qtid = qtid,startdate=tradingDay[<span class="number">1</span>],enddate=tradingDay[<span class="number">1</span>],key=key)</span><br><span class="line">mktFYear &lt;- getDailyQuote(data=<span class="string">&#x27;mktDaily&#x27;</span>,qtid = qtid,startdate=FirstDay,enddate=FirstDay,key=key)</span><br><span class="line"><span class="comment">#通过公式计算涨跌幅</span></span><br><span class="line"><span class="comment">#近一周的涨跌幅</span></span><br><span class="line">quoteChangeWeek &lt;- (close-mktWeek<span class="variable">$close</span>)/mktWeek<span class="variable">$close</span></span><br><span class="line"><span class="comment">#近一月的涨跌幅</span></span><br><span class="line">quoteChangeMonth &lt;- (close-mktMonth<span class="variable">$close</span>)/mktMonth<span class="variable">$close</span></span><br><span class="line"><span class="comment">#近一年的涨跌幅</span></span><br><span class="line">quoteChangeYear &lt;- (close-mktYear<span class="variable">$close</span>)/mktYear<span class="variable">$close</span></span><br><span class="line"><span class="comment">#年初至今的涨跌幅</span></span><br><span class="line">quoteChangeFYear &lt;- (close-mktFYear<span class="variable">$close</span>)/mktFYear$close</span><br></pre></td></tr></table></figure>

<p>5、生成表格data.frame</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">stock1 &lt;- data.frame(<span class="string">&#x27;1&#x27;</span>=qtid,<span class="string">&#x27;2&#x27;</span>=SecuAbbr,<span class="string">&#x27;3&#x27;</span>=paste(year(date),month(date),day(date),sep=<span class="string">&#x27;-&#x27;</span>),<span class="string">&#x27;4&#x27;</span>=close,</span><br><span class="line">                     <span class="string">&#x27;5&#x27;</span>=quoteChangeDaily,<span class="string">&#x27;6&#x27;</span>=volume,<span class="string">&#x27;7&#x27;</span>=quoteChangeWeek,</span><br><span class="line">                     <span class="string">&#x27;8&#x27;</span>=quoteChangeMonth,<span class="string">&#x27;9&#x27;</span>=quoteChangeYear,</span><br><span class="line">                     <span class="string">&#x27;10&#x27;</span>=quoteChangeFYear,<span class="string">&#x27;11&#x27;</span>=sw1)</span><br><span class="line"><span class="comment">#修改data.frame的列名</span></span><br><span class="line">names(stock1)&lt;-c(<span class="string">&#x27;代码&#x27;</span>,<span class="string">&#x27;名称&#x27;</span>,<span class="string">&#x27;日期&#x27;</span>,<span class="string">&#x27;收盘价&#x27;</span>,<span class="string">&#x27;涨跌幅(%)&#x27;</span>,<span class="string">&#x27;成交量(万元)&#x27;</span>,<span class="string">&#x27;周涨跌幅(%)&#x27;</span>,<span class="string">&#x27;月涨跌幅(%)&#x27;</span>,<span class="string">&#x27;年涨跌幅(%)&#x27;</span>,<span class="string">&#x27;年初至今涨跌幅（%）&#x27;</span>,<span class="string">&#x27;SW1&#x27;</span>)</span><br><span class="line"><span class="comment">#发送到况客的数据服务器中，服务器将保存你生成的dataframe，并可以在况客投研平台看到可视化界面</span></span><br><span class="line">postData(stock1,name=<span class="string">&#x27;stock1&#x27;</span>,key=key)</span><br></pre></td></tr></table></figure>

<p>6、登录况客投研平台，在 创建图表 选项中对生成的图表进行修改，并增加涨跌提示、搜索、排序等功能，然后可以将表格嵌入网站、博客之中，进行展示。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-07-24T05:24:52.255Z" title="7/24/2022, 1:24:52 PM">2022-07-24</time></span><span class="level-item">Updated&nbsp;<time dateTime="2022-07-24T05:24:52.255Z" title="7/24/2022, 1:24:52 PM">2022-07-24</time></span><span class="level-item"> YalesonChan </span><span class="level-item">a few seconds read (About 36 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/07/24/2016-01-12-Welcome-to-yalesonchan-blog/">Welcome to YalesonChan&#039;s blog</a></h1><div class="content"><p>This is the blog I first posted.<br>I will make the blog more open and share something interesting sometime.<br>I hope I can record my life by this way.<br>And<br>Happy New Year.God bless you.</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-07-24T05:24:40.007Z" title="7/24/2022, 1:24:40 PM">2022-07-24</time></span><span class="level-item">Updated&nbsp;<time dateTime="2022-07-24T04:29:08.592Z" title="7/24/2022, 12:29:08 PM">2022-07-24</time></span><span class="level-item"> YalesonChan </span><span class="level-item">6 minutes read (About 862 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/07/24/2016-01-13-Resume/">YalesonChan&#039;s Resume</a></h1><div class="content"><h1 id="陳越威"><a href="#陳越威" class="headerlink" title="陳越威"></a>陳越威</h1><hr>
<h2 id="联系方式"><a href="#联系方式" class="headerlink" title="联系方式"></a>联系方式</h2><ul>
<li>手机：18175139250</li>
<li>Email：<a href="mailto:&#x79;&#x75;&#x65;&#115;&#x68;&#105;&#x79;&#x69;&#x6a;&#x69;&#101;&#x40;&#103;&#109;&#x61;&#x69;&#108;&#x2e;&#x63;&#111;&#109;">&#x79;&#x75;&#x65;&#115;&#x68;&#105;&#x79;&#x69;&#x6a;&#x69;&#101;&#x40;&#103;&#109;&#x61;&#x69;&#108;&#x2e;&#x63;&#111;&#109;</a></li>
<li>微信号：cyw20130609</li>
</ul>
<hr>
<h2 id="个人信息"><a href="#个人信息" class="headerlink" title="个人信息"></a>个人信息</h2><ul>
<li><p>陳越威&#x2F;男&#x2F;1994</p>
</li>
<li><p>本科&#x2F;中南大学信息学院</p>
</li>
<li><p>技术博客：<a target="_blank" rel="noopener" href="http://cyw3.github.io/YalesonChan">http://cyw3.github.io/YalesonChan</a></p>
</li>
<li><p>Github: <a target="_blank" rel="noopener" href="http://github.com/cyw3">http://github.com/cyw3</a></p>
</li>
<li><p>期望职位：数据分析实习生</p>
</li>
</ul>
<hr>
<h2 id="项目经历"><a href="#项目经历" class="headerlink" title="项目经历"></a>项目经历</h2><h3 id="湘雅生物大数据项目"><a href="#湘雅生物大数据项目" class="headerlink" title="湘雅生物大数据项目"></a>湘雅生物大数据项目</h3><p>使用中南大学湘雅医学院内部数据集，分析处理各有机物质的性质特征。我在此项目负责了java蛋白质分子解析平台的工作，在数据分析这一块成长快。</p>
<h3 id="“找事er”App创业项目"><a href="#“找事er”App创业项目" class="headerlink" title="“找事er”App创业项目"></a>“找事er”App创业项目</h3><p>我在此项目负责了Android App开发工作，在Android与ThinkPHP后台的数据收发这一块做得出色。这个项目中，我最自豪的技术细节是，我能够连续7天每日每夜的进行开发工作，为的只是想要让我们的产品尽快的落地。</p>
<h3 id="OriStone语言开发项目"><a href="#OriStone语言开发项目" class="headerlink" title="OriStone语言开发项目"></a>OriStone语言开发项目</h3><p>这是我自己想要做的项目。然后确定开始做这个项目之后，我每天泡在图书馆里面，利用图书馆的资源，在图书馆里面完成了OriStone编程语言的开发。一个属于自己的语言。在这个项目中，我遇到的最大的困难是，如何构建VM。本来是想要把OriSone架构在LLVM框架之上，以此降低开发难度。但是，为了学习其中的原理，我就自己写了个VM。</p>
<h3 id="RoboCup移动智能机器人大赛"><a href="#RoboCup移动智能机器人大赛" class="headerlink" title="RoboCup移动智能机器人大赛"></a>RoboCup移动智能机器人大赛</h3><p>这个系统是仿真地震过后，城市里面医疗、警察、火警，尽最大可能拯救市民，救火，以得到最大分数的比赛。主要是编写各智能体的运作算法。我负责的是其中医疗智能体的控制算法。对其使用了KNN算法进行分区，A* 算法进行路径搜寻等等。在2015年7月份带领团队在RoboCup世界杯取得世界第六的好成绩，又于10月份取得全国第三名的成绩。</p>
<h3 id="CCV项目"><a href="#CCV项目" class="headerlink" title="CCV项目"></a>CCV项目</h3><p>基于OpenCV框架，完成的银行卡号识别项目。这是我单独完成的项目。其中的难处在于数字的提取策略。后来我使用的基于灰度变化的数字提取方法：数字与数字的间隔往往是背景颜色或者是背景像素点个数和的一个波峰，即前景像素点个数和的一个波谷，我们利用这样的特点来分割图片。</p>
<hr>
<h2 id="开源项目和作品"><a href="#开源项目和作品" class="headerlink" title="开源项目和作品"></a>开源项目和作品</h2><h3 id="开源项目"><a href="#开源项目" class="headerlink" title="开源项目"></a>开源项目</h3><ul>
<li><a target="_blank" rel="noopener" href="http://github.com/cyw3/OriStone">OriStone语言</a> : 自创的一种类python编程语言。</li>
<li><a target="_blank" rel="noopener" href="http://github.com/cyw3/CCV">CCV</a> : OpenCV实例。</li>
</ul>
<h3 id="技术文章"><a href="#技术文章" class="headerlink" title="技术文章"></a>技术文章</h3><ul>
<li><a target="_blank" rel="noopener" href="https://i.qutke.com/apps/569f4501310a3c46406493bd">投资组合的收益率走势图</a></li>
<li><a target="_blank" rel="noopener" href="https://i.qutke.com/apps/56a4fc1c310a3c464064943f">MACD策略</a></li>
</ul>
<h2 id="技能清单"><a href="#技能清单" class="headerlink" title="技能清单"></a>技能清单</h2><p>以下均为我熟练使用的技能</p>
<ul>
<li>语言：java&#x2F;R&#x2F;Python</li>
<li>Web框架：ThinkPHP&#x2F;Spring&#x2F;Struct&#x2F;Hebernate</li>
<li>数据库相关：MySQL&#x2F;Hbase</li>
<li>版本管理、文档和自动化部署工具：Svn&#x2F;Git</li>
<li>常用OS：Linux&#x2F;Windows</li>
<li>算法：机器学习&#x2F;算法导论</li>
<li>云计算：hadoop&#x2F;Spark</li>
</ul>
<hr>
<h2 id="致谢"><a href="#致谢" class="headerlink" title="致谢"></a>致谢</h2><p>感谢您花时间阅读我的简历，期待能有机会和您共事。</p>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/page/2/">Previous</a></div><div class="pagination-next is-invisible is-hidden-mobile"><a href="/page/4/">Next</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><a class="pagination-link" href="/page/2/">2</a></li><li><a class="pagination-link is-current" href="/page/3/">3</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.png" alt="Your name"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Your name</p><p class="is-size-6 is-block">Your title</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Your location</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">29</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">0</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/ppoffice" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/ppoffice"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://hexo.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Hexo</span></span><span class="level-right"><span class="level-item tag">hexo.io</span></span></a></li><li><a class="level is-mobile" href="https://bulma.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bulma</span></span><span class="level-right"><span class="level-item tag">bulma.io</span></span></a></li></ul></div></div></div><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-07-24T05:34:45.046Z">2022-07-24</time></p><p class="title"><a href="/2022/07/24/2016-01-20-OpenCV-with-CodeBlocks/">OpenCV with CodeBlocks</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-07-24T05:34:43.614Z">2022-07-24</time></p><p class="title"><a href="/2022/07/24/2016-01-19-Rescue-Simulation-League-Team-Description-S.O.S-(Iran)/">RoboCup Rescue 2015 – Rescue Simulation League Team Description S.O.S (Iran)</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-07-24T05:34:43.614Z">2022-07-24</time></p><p class="title"><a href="/2022/07/24/2016-01-22-Gaussian-Blur/">Gaussian Blur</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-07-24T05:34:43.614Z">2022-07-24</time></p><p class="title"><a href="/2022/07/24/2016-04-04-Android-Activity/">Activity on Android</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-07-24T05:34:43.614Z">2022-07-24</time></p><p class="title"><a href="/2022/07/24/2016-04-04-Android-Service/">Service on Android</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2022/07/"><span class="level-start"><span class="level-item">July 2022</span></span><span class="level-end"><span class="level-item tag">29</span></span></a></li></ul></div></div></div><!--!--><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe for updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget"><div class="card-content"><div class="notification is-danger">You need to set <code>client_id</code> and <code>slot_id</code> to show this AD unit. Please set it in <code>_config.yml</code>.</div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="Hexo" height="28"></a><p class="is-size-7"><span>&copy; 2022 John Doe</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>