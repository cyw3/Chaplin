<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>cyw3</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="cyw3"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="cyw3"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="cyw3"><meta property="og:url" content="http://example.com/"><meta property="og:site_name" content="cyw3"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://example.com/img/og_image.png"><meta property="article:author" content="cyw3"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://example.com/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com"},"headline":"cyw3","image":["http://example.com/img/og_image.png"],"author":{"@type":"Person","name":"cyw3"},"publisher":{"@type":"Organization","name":"cyw3","logo":{"@type":"ImageObject","url":{"text":"Cyw3"}}},"description":""}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }
          Array
              .from(document.querySelectorAll('.tab-content'))
              .forEach($tab => {
                  $tab.classList.add('is-hidden');
              });
          Array
              .from(document.querySelectorAll('.tabs li'))
              .forEach($tab => {
                  $tab.classList.remove('is-active');
              });
          const $activeTab = document.querySelector(location.hash);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
          const $tabMenu = document.querySelector(`a[href="${location.hash}"]`);
          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.2.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">Cyw3</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item is-active" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/cyw3/cyw3.github.io"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-07-30T03:20:12.000Z" title="7/30/2022, 11:20:12 AM">2022-07-30</time>发表</span><span class="level-item"><time dateTime="2022-07-30T09:01:36.488Z" title="7/30/2022, 5:01:36 PM">2022-07-30</time>更新</span><span class="level-item"> yalechen </span><span class="level-item">35 分钟读完 (大约5294个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/07/30/2022-7-30-Binaryen-Readme/">2022-7-30-Binaryen-Readme</a></h1><div class="content"><h1 id="Binaryen"><a href="#Binaryen" class="headerlink" title="Binaryen"></a><a target="_blank" rel="noopener" href="https://github.com/WebAssembly/binaryen">Binaryen</a></h1><p>Binaryen 是一个用于 WebAssembly 的编译器和工具链基础设施库，用 C++ 编写。 它旨在使 <a target="_blank" rel="noopener" href="https://github.com/WebAssembly/binaryen/wiki/Compiling-to-WebAssembly-with-Binaryen">编译成 WebAssembly</a> <strong>简单、快速和高效</strong>:</p>
<ul>
<li><p><strong>简单</strong>: Binaryen 提供了个简单的 <a target="_blank" rel="noopener" href="https://github.com/WebAssembly/binaryen/wiki/Compiling-to-WebAssembly-with-Binaryen#c-api-1">C API</a>，也可以<br><a target="_blank" rel="noopener" href="https://github.com/WebAssembly/binaryen/wiki/binaryen.js-API">使用 JavaScript 调用</a>. 它接受来自 <a target="_blank" rel="noopener" href="https://github.com/WebAssembly/binaryen/wiki/Compiling-to-WebAssembly-with-Binaryen#what-do-i-need-to-have-in-order-to-use-binaryen-to-compile-to-webassembly">类 WebAssembly<br>格式</a> 的输入，也接受一个通用的 <a target="_blank" rel="noopener" href="https://github.com/WebAssembly/binaryen/wiki/Compiling-to-WebAssembly-with-Binaryen#cfg-api">control flow graph</a>.</p>
</li>
<li><p><strong>快速</strong>: Binaryen 的内部 IR 使用紧凑的数据结构，专为完全并行的代码生成和优化而设计，使用所有可用的 CPU 内核。 Binaryen 的 IR 也非常容易和快速地编译成 WebAssembly，因为它本质上是 WebAssembly 的一个子集。</p>
</li>
<li><p><strong>高效</strong>:<br>Binaryen 的优化器有许多可以改进代码大小和速度的关卡pass（参见后面的概述）。 这些优化旨在使 Binaryen 足够强大，可以单独用作<a target="_blank" rel="noopener" href="https://kripken.github.io/talks/binaryen.html#/9">编译器后端</a>。 一个特定的关注领域是特定于 WebAssembly 的优化（通用编译器可能不会这样做），您可以将其视为 wasm <a target="_blank" rel="noopener" href="https://kripken.github.io/talks/binaryen.html#/2">minification</a>，类似于 JavaScript、CSS 等的缩小版，所有这些都是具体的语言。</p>
</li>
</ul>
<p>Compilers using Binaryen include:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/AssemblyScript/assemblyscript"><code>AssemblyScript</code></a> 它将 TypeScript 的变体编译为 WebAssembly</li>
<li><a target="_blank" rel="noopener" href="https://github.com/WebAssembly/binaryen/blob/main/src/wasm2js.h"><code>wasm2js</code></a> 支持将 WebAssembly 编译成 JS</li>
<li><a target="_blank" rel="noopener" href="https://github.com/tweag/asterius"><code>Asterius</code></a> which compiles Haskell to WebAssembly</li>
<li><a target="_blank" rel="noopener" href="https://github.com/grain-lang/grain"><code>Grain</code></a> which compiles Grain to WebAssembly</li>
</ul>
<p>Binaryen also provides a set of <strong>toolchain utilities</strong> that can</p>
<ul>
<li><strong>Parse</strong> and <strong>emit</strong> WebAssembly. In particular this lets you load<br>WebAssembly, optimize it using Binaryen, and re-emit it, thus implementing a<br>wasm-to-wasm optimizer in a single command.</li>
<li><strong>Interpret</strong> WebAssembly as well as run the WebAssembly spec tests.</li>
<li>Integrate with <strong><a target="_blank" rel="noopener" href="http://emscripten.org/">Emscripten</a></strong> in order to provide a<br>complete compiler toolchain from C and C++ to WebAssembly.</li>
<li><strong>Polyfill</strong> WebAssembly by running it in the interpreter compiled to<br>JavaScript, if the browser does not yet have native support (useful for<br>testing).</li>
</ul>
<p>Consult the <a href="Contributing.md">contributing instructions</a> if you’re interested in<br>participating.</p>
<h2 id="Binaryen-IR"><a href="#Binaryen-IR" class="headerlink" title="Binaryen IR"></a>Binaryen IR</h2><p>Binaryen’s internal IR is designed to be</p>
<ul>
<li><strong>Flexible and fast</strong> for optimization.</li>
<li><strong>As close as possible to WebAssembly</strong> so it is simple and fast to convert<br>it to and from WebAssembly.</li>
</ul>
<p>There are a few differences between Binaryen IR and the WebAssembly language:</p>
<ul>
<li>Tree structure<ul>
<li>Binaryen IR <a target="_blank" rel="noopener" href="https://github.com/WebAssembly/binaryen/issues/663">is a tree</a>, i.e., it has hierarchical structure,<br>for convenience of optimization. This differs from the WebAssembly binary<br>format which is a stack machine.</li>
<li>Consequently Binaryen’s text format allows only s-expressions.<br>WebAssembly’s official text format is primarily a linear instruction list<br>(with s-expression extensions). Binaryen can’t read the linear style, but<br>it can read a wasm text file if it contains only s-expressions.</li>
<li>Binaryen uses Stack IR to optimize “stacky” code (that can’t be<br>represented in structured form).</li>
<li>When stacky code must be represented in Binaryen IR, such as with<br>multivalue instructions and blocks, it is represented with tuple types that<br>do not exist in the WebAssembly language. In addition to multivalue<br>instructions, locals and globals can also have tuple types in Binaryen IR<br>but not in WebAssembly. Experiments show that better support for<br>multivalue could enable useful but small code size savings of 1-3%, so it<br>has not been worth changing the core IR structure to support it better.</li>
<li>Block input values (currently only supported in <code>catch</code> blocks in the<br>exception handling feature) are represented as <code>pop</code> subexpressions.</li>
</ul>
</li>
<li>Types and unreachable code<ul>
<li>WebAssembly 将块&#x2F;if&#x2F;loop 类型限制为 none 和具体值类型（i32、i64、f32、f64）。Binaryen IR 有一个不可访问的类型，它允许 block&#x2F;if&#x2F;loop 接受它，允许<a target="_blank" rel="noopener" href="https://github.com/WebAssembly/binaryen/issues/903">不需要知道全局上下文的本地转换</a>。因此，Binaryen 的默认文本输出不一定是有效的 wasm 文本。（要获得有效的 wasm 文本，您可以执行 <code>--generate-stack-ir --print-stack-ir</code> 打印 Stack IR 的操作，这保证对 wasm 解析器有效。）</li>
<li>Binaryen 在读取 WebAssembly 二进制文件时会忽略无法访问的代码。这意味着如果您读取包含无法访问代码的 wasm 文件，该代码将被丢弃，就好像它已被优化一样（通常这就是您想要的，优化的程序无论如何都没有无法访问的代码，但是如果您编写一个未优化的文件并且然后阅读它，它可能看起来不同）。这种行为的原因是 WebAssembly 中无法访问的代码具有在 Binaryen IR 中难以处理的极端情况（它可能非常非结构化，并且如前所述，Binaryen IR 比 WebAssembly 更具结构化）。请注意，Binaryen 确实支持 .wat 文本文件中无法访问的代码，因为正如我们所见，Binaryen 仅支持结构化的 s 表达式。</li>
</ul>
</li>
<li>Blocks<ul>
<li>Binaryen IR 只有一个节点包含可变长度的操作数列表：块blocks。另一方面，WebAssembly 允许循环中的列表、if 臂和函数的顶层。Binaryen 的 IR 对所有非块节点都有一个操作数；这个操作数当然可以是一个块。这个属性的动机是许多通道需要特殊的代码来迭代列表，因此使用带有列表的单个 IR 节点可以简化它们。</li>
<li>As in wasm, blocks and loops may have names. Branch targets in the IR are<br>resolved by name (as opposed to nesting depth). This has 2 consequences:<ul>
<li>Blocks without names may not be branch targets.</li>
<li>Names are required to be unique. (Reading .wat files with duplicate names<br>is supported; the names are modified when the IR is constructed).</li>
</ul>
</li>
<li>As an optimization, a block that is the child of a loop (or if arm, or<br>function toplevel) and which has no branches targeting it will not be<br>emitted when generating wasm. Instead its list of operands will be directly<br>used in the containing node. Such a block is sometimes called an “implicit<br>block”.</li>
</ul>
</li>
<li>Reference Types</li>
<li>The wasm text and binary formats require that a function whose address is<br>taken by <code>ref.func</code> must be either in the table, or declared via an<br><code>(elem declare func $..)</code>. Binaryen will emit that data when necessary, but<br>it does not represent it in IR. That is, IR can be worked on without needing<br>to think about declaring function references.</li>
</ul>
<p>As a result, you might notice that round-trip conversions (wasm &#x3D;&gt; Binaryen IR<br>&#x3D;&gt; wasm) change code a little in some corner cases.</p>
<ul>
<li>When optimizing Binaryen uses an additional IR, Stack IR (see<br><code>src/wasm-stack.h</code>). Stack IR allows a bunch of optimizations that are<br>tailored for the stack machine form of WebAssembly’s binary format (but Stack<br>IR is less efficient for general optimizations than the main Binaryen IR). If<br>you have a wasm file that has been particularly well-optimized, a simple<br>round-trip conversion (just read and write, without optimization) may cause<br>more noticeable differences, as Binaryen fits it into Binaryen IR’s more<br>structured format. If you also optimize during the round-trip conversion then<br>Stack IR opts will be run and the final wasm will be better optimized.</li>
</ul>
<p>Notes when working with Binaryen IR:</p>
<ul>
<li>如上所述，Binaryen IR 具有树结构。因此，每个表达式都应该只有一个父节点 - 您不应该通过让节点在树中多次出现来“重用”节点。这个限制的动机是当我们优化时我们修改节点，所以如果它们在树中出现多次，一个地方的变化可能会错误地出现在另一个地方</li>
<li>For similar reasons, nodes should not appear in more than one functions.</li>
</ul>
<h3 id="Intrinsics"><a href="#Intrinsics" class="headerlink" title="Intrinsics"></a>Intrinsics</h3><p>Binaryen intrinsic functions look like calls to imports, e.g.,</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(import &quot;binaryen-intrinsics&quot; &quot;foo&quot; (func $foo))</span><br></pre></td></tr></table></figure>

<p>Implementing them that way allows them to be read and written by other tools,<br>and it avoids confusing errors on a binary format error that could happen in<br>those tools if we had a custom binary format extension.</p>
<p>An intrinsic method may be optimized away by the optimizer. If it is not, it<br>must be <strong>lowered</strong> before shipping the wasm, as otherwise it will look like a<br>call to an import that does not exist (and VMs will show an error on not having<br>a proper value for that import). That final lowering is <em>not</em> done<br>automatically. A user of intrinsics must run the pass for that explicitly,<br>because the tools do not know when the user intends to finish optimizing, as the<br>user may have a pipeline of multiple optimization steps, or may be doing local<br>experimentation, or fuzzing&#x2F;reducing, etc. Only the user knows when the final<br>optimization happens before the wasm is “final” and ready to be shipped. Note<br>that, in general, some additional optimizations may be possible after the final<br>lowering, and so a useful pattern is to  optimize once normally with intrinsics,<br>then lower them away, then optimize after that, e.g.:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wasm-opt input.wasm -o output.wasm  -O --intrinsic-lowering -O</span><br></pre></td></tr></table></figure>

<p>Each intrinsic defines its semantics, which includes what the optimizer is<br>allowed to do with it and what the final lowering will turn it to. See<br><a target="_blank" rel="noopener" href="https://github.com/WebAssembly/binaryen/blob/main/src/ir/intrinsics.h">intrinsics.h</a><br>for the detailed definitions. A quick summary appears here:</p>
<ul>
<li><code>call.without.effects</code>: Similar to a <code>call_ref</code> in that it receives<br>parameters, and a reference to a function to call, and calls that function<br>with those parameters, except that the optimizer can assume the call has no<br>side effects, and may be able to optimize it out (if it does not have a<br>result that is used, generally).</li>
</ul>
<h2 id="Tools"><a href="#Tools" class="headerlink" title="Tools"></a>Tools</h2><p>该仓库包含了 <code>bin/</code> 目录下工具的代码:</p>
<ul>
<li><strong>wasm-opt</strong>: 加载 WebAssembly 并在其上运行 Binaryen IR pass。</li>
<li><strong>wasm-as</strong>: 将文本格式（当前为 S-Expression 格式）的 WebAssembly 组装成二进制格式（通过 Binaryen IR）。</li>
<li><strong>wasm-dis</strong>: 将二进制格式的 WebAssembly 反汇编成文本格式（通过 Binaryen IR）。</li>
<li><strong>wasm2js</strong>: WebAssembly-to-JS 编译器。Emscripten 使用它来生成 JavaScript 作为 WebAssembly 的替代方案。</li>
<li><strong>wasm-reduce</strong>: WebAssembly 文件的测试用例缩减器。给定一个由于某种原因有趣的 wasm 文件（例如，它使特定的 VM 崩溃），wasm-reduce 可以找到一个具有相同属性的较小的 wasm 文件，这通常更容易调试。有关更多详细信息，请参阅 <a href="(https://github.com/WebAssembly/binaryen/wiki/Fuzzing#reducing)">文档</a> 。</li>
<li><strong>wasm-shell</strong>: 一个可以加载和解释 WebAssembly 代码的 shell。它还可以运行规范测试套件。</li>
<li><strong>wasm-emscripten-finalize</strong>: 获取由 llvm+lld 生成的 wasm 二进制文件，并对其执行特定的 emscripten pass。</li>
<li><strong>wasm-ctor-eval</strong>: 一个可以在编译时执行函数（或部分函数）的工具。</li>
<li><strong>binaryen.js</strong>: 一个独立的 JavaScript 库，公开了用于<a target="_blank" rel="noopener" href="https://github.com/WebAssembly/binaryen/blob/main/test/binaryen.js/hello-world.js">创建和优化 Wasm 模块</a>的 Binaryen 方法。对于构建，请参阅 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/binaryen">npm 上的 binaryen.js</a>（或直接从 <a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/AssemblyScript/binaryen.js/master/index.js">github</a>、<a target="_blank" rel="noopener" href="https://cdn.rawgit.com/AssemblyScript/binaryen.js/master/index.js">rawgit</a> 或 <a target="_blank" rel="noopener" href="https://unpkg.com/binaryen@latest/index.js">unpkg 下载</a>）。最低要求：Node.js v15.8 或 Chrome v75 或 Firefox v78。</li>
</ul>
<p>Usage instructions for each are below.</p>
<h2 id="Binaryen-优化"><a href="#Binaryen-优化" class="headerlink" title="Binaryen 优化"></a>Binaryen 优化</h2><p>Binaryen 包含了<br><a target="_blank" rel="noopener" href="https://github.com/WebAssembly/binaryen/tree/main/src/passes">一些优化 passes</a>，可以让 WebAssembly 变得体量更小而且更快速。 你可以使用 <code>wasm-opt</code> 来运行 Binaryen 优化器， 你也可以使用其他工具来运行优化器，比如<br><code>wasm2js</code> 和 <code>wasm-metadce</code>.</p>
<ul>
<li>默认的优化流水线是在<br><a target="_blank" rel="noopener" href="https://github.com/WebAssembly/binaryen/blob/369b8bdd3d9d49e4d9e0edf62e14881c14d9e352/src/passes/pass.cpp#L396"><code>addDefaultFunctionOptimizationPasses</code></a>.</li>
<li>你可以设置各种<br><a target="_blank" rel="noopener" href="https://github.com/WebAssembly/binaryen/blob/369b8bdd3d9d49e4d9e0edf62e14881c14d9e352/src/pass.h#L85">pass 设置</a><br>以调整优化和收缩级别、是否忽略不太可能的陷阱、内联启发式、快速数学等。请参阅 <code>wasm-opt --help</code> 如何设置它们和其他详细信息。</li>
</ul>
<p>See each optimization pass for details of what it does, but here is a quick<br>overview of some of the relevant ones:</p>
<ul>
<li><strong>CoalesceLocals</strong> - Key “register allocation” pass. 可以进行生命周期分析，然后重用局部变量以减少局部变量数量，并尽可能的减少局部变量的复制.</li>
<li><strong>CodeFolding</strong> - 通过合并避免重复代码（例如，如果两个if分支在其末端有一些共享指令）。</li>
<li><strong>CodePushing</strong> - “Pushes” code forward past branch operations, potentially<br>allowing the code to not be run if the branch is taken.</li>
<li><strong>DeadArgumentElimination</strong> - LTO pass 旨在在始终使用相同的常量调用函数的情况下，删除方法参数。</li>
<li><strong>DeadCodeElimination</strong></li>
<li><strong>Directize</strong> - 当表索引不变时，将间接调用转换为正常调用。</li>
<li><strong>DuplicateFunctionElimination</strong> - LTO pass.</li>
<li><strong>Inlining</strong> - LTO pass.</li>
<li><strong>LocalCSE</strong> - 简单的局部公共子表达式消除。</li>
<li><strong>LoopInvariantCodeMotion</strong></li>
<li><strong>MemoryPacking</strong> - Key “optimize data segments” pass that combines segments,<br>removes unneeded parts, etc.</li>
<li><strong>MergeBlocks</strong> - Merge a <code>block</code> to an outer one where possible, reducing<br>their number.</li>
<li><strong>MergeLocals</strong> - When two locals have the same value in part of their<br>overlap, pick in a way to help CoalesceLocals do better later (split off from<br>CoalesceLocals to keep the latter simple).</li>
<li><strong>MinifyImportsAndExports</strong> - Minifies them to “a”, “b”, etc.</li>
<li><strong>OptimizeAddedConstants</strong> - Optimize a load&#x2F;store with an added constant into<br>a constant offset.</li>
<li><strong>OptimizeInstructions</strong> - Key peephole optimization pass with a constantly<br>increasing list of patterns.</li>
<li><strong>PickLoadSigns</strong> - Adjust whether a load is signed or unsigned in order to<br>avoid sign&#x2F;unsign operations later.</li>
<li><strong>Precompute</strong> - Calculates constant expressions at compile time, using the<br>built-in interpreter (which is guaranteed to be able to handle any constant<br>expression).</li>
<li><strong>ReReloop</strong> - Transforms wasm structured control flow to a CFG and then goes<br>back to structured form using the Relooper algorithm, which may find more<br>optimal shapes.</li>
<li><strong>RedundantSetElimination</strong> - Removes a <code>local.set</code> of a value that is already<br>present in a local. (Overlaps with CoalesceLocals; this achieves the specific<br>operation just mentioned without all the other work CoalesceLocals does, and<br>therefore is useful in other places in the optimization pipeline.)</li>
<li><strong>RemoveUnsedBrs</strong> - Key “minor control flow optimizations” pass, including<br>jump threading and various transforms that can get rid of a <code>br</code> or <code>br_table</code><br>(like turning a <code>block</code> with a <code>br</code> in the middle into an <code>if</code> when possible).</li>
<li><strong>RemoveUnusedModuleElements</strong> - “Global DCE”, an LTO pass that removes<br>imports, functions, globals, etc., when they are not used.</li>
<li><strong>ReorderFunctions</strong> - Put more-called functions first, potentially allowing<br>the LEB emitted to call them to be smaller (in a very large program).</li>
<li><strong>ReorderLocals</strong> - Put more-used locals first, potentially allowing the LEB<br>emitted to use them to be smaller (in a very large function). After the<br>sorting, it also removes locals not used at all.</li>
<li><strong>SimplifyGlobals</strong> - Optimizes globals in various ways, for example,<br>coalescing them, removing mutability from a global never modified, applying a<br>constant value from an immutable global, etc.</li>
<li><strong>SimplifyLocals</strong> - Key “<code>local.get/set/tee</code>” optimization pass, doing things<br>like replacing a set and a get with moving the set’s value to the get (and<br>creating a tee) where possible. Also creates <code>block/if/loop</code> return values<br>instead of using a local to pass the value.</li>
<li><strong>Vacuum</strong> - Key “remove silly unneeded code” pass, doing things like removing<br>an <code>if</code> arm that has no contents, a drop of a constant value with no side<br>effects, a <code>block</code> with a single child, etc.</li>
</ul>
<p>“LTO” in the above means an optimization is Link Time Optimization-like in that<br>it works across multiple functions, but in a sense Binaryen is always “LTO” as<br>it usually is run on the final linked wasm.</p>
<p>Advanced optimization techniques in the Binaryen optimizer include<br><a target="_blank" rel="noopener" href="https://github.com/WebAssembly/binaryen/blob/main/src/passes/SSAify.cpp">SSAification</a>,<br><a target="_blank" rel="noopener" href="https://github.com/WebAssembly/binaryen/blob/main/src/ir/flat.h">Flat IR</a>, and<br><a target="_blank" rel="noopener" href="https://github.com/WebAssembly/binaryen/blob/main/src/ir/stack-utils.h">Stack&#x2F;Poppy IR</a>.</p>
<p>Binaryen also contains various passes that do other things than optimizations,<br>like<br><a target="_blank" rel="noopener" href="https://github.com/WebAssembly/binaryen/blob/main/src/passes/LegalizeJSInterface.cpp">legalization for JavaScript</a>,<br><a target="_blank" rel="noopener" href="https://github.com/WebAssembly/binaryen/blob/main/src/passes/Asyncify.cpp">Asyncify</a>,<br>etc.</p>
<h2 id="Building"><a href="#Building" class="headerlink" title="Building"></a>Building</h2><p>Binaryen uses git submodules (at time of writing just for gtest), so before you build you will have to initialize the submodules:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git submodule init</span><br><span class="line">git submodule update</span><br></pre></td></tr></table></figure>

<p>After that you can build with CMake:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake . &amp;&amp; make</span><br></pre></td></tr></table></figure>

<p>A C++17 compiler is required. Note that you can also use <code>ninja</code> as your generator: <code>cmake -G Ninja . &amp;&amp; ninja</code>.</p>
<p>To avoid the gtest dependency, you can pass <code>-DBUILD_TESTS=OFF</code> to cmake.</p>
<p>Binaryen.js can be built using Emscripten, which can be installed via <a target="_blank" rel="noopener" href="http://kripken.github.io/emscripten-site/docs/getting_started/downloads.html">the SDK</a>).</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">emcmake cmake . &amp;&amp; emmake make binaryen_js</span><br></pre></td></tr></table></figure>

<h3 id="Visual-C"><a href="#Visual-C" class="headerlink" title="Visual C++"></a>Visual C++</h3><ol>
<li><p>Using the Microsoft Visual Studio Installer, install the “Visual C++ tools for CMake” component.</p>
</li>
<li><p>Generate the projects:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir build</span><br><span class="line">cd build</span><br><span class="line">&quot;%VISUAL_STUDIO_ROOT%\Common7\IDE\CommonExtensions\Microsoft\CMake\CMake\bin\cmake.exe&quot; ..</span><br></pre></td></tr></table></figure>

<p>Substitute VISUAL_STUDIO_ROOT with the path to your Visual Studio<br>installation. In case you are using the Visual Studio Build Tools, the path<br>will be “C:\Program Files (x86)\Microsoft Visual Studio\2017\BuildTools”.</p>
</li>
<li><p>From the Developer Command Prompt, build the desired projects:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msbuild binaryen.vcxproj</span><br></pre></td></tr></table></figure>

<p>CMake generates a project named “ALL_BUILD.vcxproj” for conveniently building all the projects.</p>
</li>
</ol>
<h2 id="Running"><a href="#Running" class="headerlink" title="Running"></a>Running</h2><h3 id="wasm-opt"><a href="#wasm-opt" class="headerlink" title="wasm-opt"></a>wasm-opt</h3><p>Run</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/wasm-opt [.wasm or .wat file] [options] [passes, see --help] [--help]</span><br></pre></td></tr></table></figure>

<p>wasm优化器以 WebAssembly 文件作为输入，然后执行转换pass，（在转换过程之前或之后）输出执行结果。比如，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/wasm-opt test/lit/passes/name-types.wast -all -S -o -</span><br></pre></td></tr></table></figure>

<p>这将输出测试套件中的一个测试用例。要对其进行转换，请尝试执行以下语句：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/wasm-opt test/lit/passes/name-types.wast --name-types -all -S -o -</span><br></pre></td></tr></table></figure>

<p><code>name-types</code> pass 会确保每个类型都有一个名称并重命名异常长的类型名称。通过比较两个命令的输出，您可以看到转换导致的变化。</p>
<p>将您自己的转换过程添加到 shell 很容易，只需将 <code>.cpp</code> 文件添加到 <code>src/passes</code> 中，然后重新构建 shell。可以参考 <a target="_blank" rel="noopener" href="https://github.com/WebAssembly/binaryen/blob/main/src/passes/NameTypes.cpp"><code>name-types</code> pass</a> 的代码.</p>
<p>Some more notes:</p>
<ul>
<li>See <code>bin/wasm-opt --help</code> for the full list of options and passes.</li>
<li>Passing <code>--debug</code> will emit some debugging info.</li>
</ul>
<h3 id="wasm2js"><a href="#wasm2js" class="headerlink" title="wasm2js"></a>wasm2js</h3><p>Run</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/wasm2js [input.wasm file]</span><br></pre></td></tr></table></figure>

<p>This will print out JavaScript to the console.</p>
<p>For example, try</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/wasm2js test/hello_world.wat</span><br></pre></td></tr></table></figure>

<p>That output contains</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function add(x, y) &#123;</span><br><span class="line"> x = x | 0;</span><br><span class="line"> y = y | 0;</span><br><span class="line"> return x + y | 0 | 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>as a translation of</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(func $add (; 0 ;) (type $0) (param $x i32) (param $y i32) (result i32)</span><br><span class="line"> (i32.add</span><br><span class="line">  (local.get $x)</span><br><span class="line">  (local.get $y)</span><br><span class="line"> )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>wasm2js’s output is in ES6 module format - basically, it converts a wasm<br>module into an ES6 module (to run on older browsers and Node.js versions<br>you can use Babel etc. to convert it to ES5). Let’s look at a full example<br>of calling that hello world wat; first, create the main JS file:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.mjs</span></span><br><span class="line"><span class="keyword">import</span> &#123; add &#125; <span class="keyword">from</span> <span class="string">&quot;./hello_world.mjs&quot;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;the sum of 1 and 2 is:&#x27;</span>, <span class="title function_">add</span>(<span class="number">1</span>, <span class="number">2</span>));</span><br></pre></td></tr></table></figure>

<p>The run this (note that you need a new enough Node.js with ES6 module<br>support):</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">bin/wasm2js <span class="built_in">test</span>/hello_world.wat -o hello_world.mjs</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">node --experimental-modules main.mjs</span></span><br><span class="line">the sum of 1 and 2 is: 3</span><br></pre></td></tr></table></figure>

<p>Things keep to in mind with wasm2js’s output:</p>
<ul>
<li>You should run wasm2js with optimizations for release builds, using <code>-O</code><br>or another optimization level. That will optimize along the entire pipeline<br>(wasm and JS). It won’t do everything a JS minifer would, though, like<br>minify whitespace, so you should still run a normal JS minifer afterwards.</li>
<li>It is not possible to match WebAssembly semantics 100% precisely with fast<br>JavaScript code. For example, every load and store may trap, and to make<br>JavaScript do the same we’d need to add checks everywhere, which would be<br>large and slow. Instead, wasm2js assumes loads and stores do not trap, that<br>int&#x2F;float conversions do not trap, and so forth. There may also be slight<br>differences in corner cases of conversions, like non-trapping float to int.</li>
</ul>
<h3 id="wasm-ctor-eval"><a href="#wasm-ctor-eval" class="headerlink" title="wasm-ctor-eval"></a>wasm-ctor-eval</h3><p><code>wasm-ctor-eval</code> executes functions, or parts of them, at compile time.<br>After doing so it serializes the runtime state into the wasm, which is like<br>taking a “snapshot”. When the wasm is later loaded and run in a VM, it will<br>continue execution from that point, without re-doing the work that was already<br>executed.</p>
<p>For example, consider this small program:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">(module</span><br><span class="line"> ;; A global variable that begins at 0.</span><br><span class="line"> (global $global (mut i32) (i32.const 0))</span><br><span class="line"></span><br><span class="line"> (import &quot;import&quot; &quot;import&quot; (func $import))</span><br><span class="line"></span><br><span class="line"> (func &quot;main&quot;</span><br><span class="line">  ;; Set the global to 1.</span><br><span class="line">  (global.set $global</span><br><span class="line">   (i32.const 1))</span><br><span class="line"></span><br><span class="line">  ;; Call the imported function. This *cannot* be executed at</span><br><span class="line">  ;; compile time.</span><br><span class="line">  (call $import)</span><br><span class="line"></span><br><span class="line">  ;; We will never get to this point, since we stop at the</span><br><span class="line">  ;; import.</span><br><span class="line">  (global.set $global</span><br><span class="line">   (i32.const 2))</span><br><span class="line"> )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>We can evaluate part of it at compile time like this:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wasm-ctor-eval input.wat --ctors=main -S -o -</span><br></pre></td></tr></table></figure>

<p>This tells it that there is a single function that we want to execute (“ctor”<br>is short for “global constructor”, a name that comes from code that is executed<br>before a program’s entry point) and then to print it as text to <code>stdout</code>. The<br>result is this:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">trying to eval main</span><br><span class="line">  ...partial evalling successful, but stopping since could not eval: call import: import.import</span><br><span class="line">  ...stopping</span><br><span class="line">(module</span><br><span class="line"> (type $none_=&gt;_none (func))</span><br><span class="line"> (import &quot;import&quot; &quot;import&quot; (func $import))</span><br><span class="line"> (global $global (mut i32) (i32.const 1))</span><br><span class="line"> (export &quot;main&quot; (func $0_0))</span><br><span class="line"> (func $0_0</span><br><span class="line">  (call $import)</span><br><span class="line">  (global.set $global</span><br><span class="line">   (i32.const 2)</span><br><span class="line">  )</span><br><span class="line"> )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>The logging shows us managing to eval part of <code>main()</code>, but not all of it, as<br>expected: We can eval the first <code>global.get</code>, but then we stop at the call to<br>the imported function (because we don’t know what that function will be when the<br>wasm is actually run in a VM later). Note how in the output wasm the global’s<br>value has been updated from 0 to 1, and that the first <code>global.get</code> has been<br>removed: the wasm is now in a state that, when we run it in a VM, will seamlessly<br>continue to run from the point at which <code>wasm-ctor-eval</code> stopped.</p>
<p>In this tiny example we just saved a small amount of work. How much work can be<br>saved depends on your program. (It can help to do pure computation up front, and<br>leave calls to imports to as late as possible.)</p>
<p>Note that <code>wasm-ctor-eval</code>‘s name is related to global constructor functions,<br>as mentioned earlier, but there is no limitation on what you can execute here.<br>Any export from the wasm can be executed, if its contents are suitable. For<br>example, in Emscripten <code>wasm-ctor-eval</code> is even run on <code>main()</code> when possible.</p>
<h2 id="Testing"><a href="#Testing" class="headerlink" title="Testing"></a>Testing</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./check.py</span><br></pre></td></tr></table></figure>

<p>(or <code>python check.py</code>) will run <code>wasm-shell</code>, <code>wasm-opt</code>, etc. on the testcases in <code>test/</code>, and verify their outputs.</p>
<p>The <code>check.py</code> script supports some options:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./check.py [--interpreter=/path/to/interpreter] [TEST1] [TEST2]..</span><br></pre></td></tr></table></figure>

<ul>
<li>If an interpreter is provided, we run the output through it, checking for<br>parse errors.</li>
<li>If tests are provided, we run exactly those. If none are provided, we run<br>them all. To see what tests are available, run <code>./check.py --list-suites</code>.</li>
<li>Some tests require <code>emcc</code> or <code>nodejs</code> in the path. They will not run if the<br>tool cannot be found, and you’ll see a warning.</li>
<li>We have tests from upstream in <code>tests/spec</code>, in git submodules. Running<br><code>./check.py</code> should update those.</li>
</ul>
<p>Note that we are trying to gradually port the legacy wasm-opt tests to use <code>lit</code> and <code>filecheck</code> as we modify them.<br>For <code>passes</code> tests that output wast, this can be done automatically with <code>scripts/port_passes_tests_to_lit.py</code> and for non-<code>passes</code> tests that output wast, see<br><a target="_blank" rel="noopener" href="https://github.com/WebAssembly/binaryen/pull/4779">https://github.com/WebAssembly/binaryen/pull/4779</a> for an example of how to do a simple manual port.</p>
<h3 id="Setting-up-dependencies"><a href="#Setting-up-dependencies" class="headerlink" title="Setting up dependencies"></a>Setting up dependencies</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./third_party/setup.py [mozjs|v8|wabt|all]</span><br></pre></td></tr></table></figure>

<p>(or <code>python third_party/setup.py</code>) installs required dependencies like the SpiderMonkey JS shell, the V8 JS shell<br>and WABT in <code>third_party/</code>. Other scripts automatically pick these up when installed.</p>
<p>Run <code>pip3 install -r requirements-dev.txt</code> to get the requirements for the <code>lit</code><br>tests. Note that you need to have the location <code>pip</code> installs to in your <code>$PATH</code><br>(on linux, <code>~/.local/bin</code>).</p>
<h3 id="Fuzzing"><a href="#Fuzzing" class="headerlink" title="Fuzzing"></a>Fuzzing</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./scripts/fuzz_opt.py [--binaryen-bin=build/bin]</span><br></pre></td></tr></table></figure>

<p>(or <code>python scripts/fuzz_opt.py</code>) will run various fuzzing modes on random inputs with random passes until it finds<br>a possible bug. See <a target="_blank" rel="noopener" href="https://github.com/WebAssembly/binaryen/wiki/Fuzzing">the wiki page</a> for all the details.</p>
<h2 id="Design-Principles"><a href="#Design-Principles" class="headerlink" title="Design Principles"></a>Design Principles</h2><ul>
<li><strong>Interned strings for names</strong>: It’s very convenient to have names on nodes,<br>instead of just numeric indices etc. To avoid most of the performance<br>difference between strings and numeric indices, all strings are interned,<br>which means there is a single copy of each string in memory, string<br>comparisons are just a pointer comparison, etc.</li>
<li><strong>Allocate in arenas</strong>: Based on experience with other<br>optimizing&#x2F;transformating toolchains, it’s not worth the overhead to<br>carefully track memory of individual nodes. Instead, we allocate all elements<br>of a module in an arena, and the entire arena can be freed when the module is<br>no longer needed.</li>
</ul>
<h2 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h2><ul>
<li>Why the weird name for the project?</li>
</ul>
<p>“Binaryen” is a combination of <strong>binary</strong> - since WebAssembly is a binary format<br>for the web - and <strong>Emscripten</strong> - with which it can integrate in order to<br>compile C and C++ all the way to WebAssembly, via asm.js. Binaryen began as<br>Emscripten’s WebAssembly processing library (<code>wasm-emscripten</code>).</p>
<p>“Binaryen” is pronounced <a target="_blank" rel="noopener" href="http://www.makinggameofthrones.com/production-diary/2011/2/11/official-pronunciation-guide-for-game-of-thrones.html">in the same manner</a> as “<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/List_of_A_Song_of_Ice_and_Fire_characters#House_Targaryen">Targaryen</a>“: <em>bi-NAIR-ee-in</em>. Or something like that? Anyhow, however Targaryen is correctly pronounced, they should rhyme. Aside from pronunciation, the Targaryen house words, “Fire and Blood”, have also inspired Binaryen’s: “Code and Bugs.”</p>
<ul>
<li>Does it compile under Windows and&#x2F;or Visual Studio?</li>
</ul>
<p>Yes, it does. Here’s a step-by-step <a target="_blank" rel="noopener" href="https://github.com/brakmic/bazaar/blob/master/webassembly/COMPILING_WIN32.md">tutorial</a>  on how to compile it<br>under <strong>Windows 10 x64</strong> with with <strong>CMake</strong> and <strong>Visual Studio 2015</strong>.<br>However, Visual Studio 2017 may now be required. Help would be appreciated on<br>Windows and OS X as most of the core devs are on Linux.</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-07-24T06:56:22.285Z" title="7/24/2022, 2:56:22 PM">2022-07-24</time>发表</span><span class="level-item"><time dateTime="2022-07-24T06:56:22.285Z" title="7/24/2022, 2:56:22 PM">2022-07-24</time>更新</span><span class="level-item"> yalechen </span><span class="level-item">18 分钟读完 (大约2709个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/07/24/2016-01-14-MACD/">MACD策略</a></h1><div class="content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>各位看官好，我是小陈。前两篇文章，我们一起写了个数据表格和走势图，恩，是不是很容易啊，有没有信心满满现在！那么，接下来，我们来个有点难度的。咱们一起写一下MACD股票策略吧。</p>
<p>移动平均线(MA)是股市中最常用的一种技术分析方法，用来在大行情的波动段找到有效的交易信号。移动平均线不仅简单，而且有效，对股市操作具有神奇的指导作用，能有效地打败大部分的主观策略，是炒股、炒期货的必备基本工具。</p>
<p>接下来，我们仔细研究一下MACD策略的简单而又神奇之处吧。</p>
<h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><p>1.MACD的介绍<br>2.均线模型展示<br>3.R语言实现MACD策略</p>
<h2 id="1、MACD的介绍"><a href="#1、MACD的介绍" class="headerlink" title="1、MACD的介绍"></a>1、MACD的介绍</h2><p>在介绍MACD之前，我们来介绍一下MA，也就是移动平均线。<br>移动平均线(MA,Moving average）是以道·琼斯的”平均成本概念”为理论基础，采用统计学中”移动平均”的原理，将一段时期内的股票价格平均值连成曲线，用来显示股价的历史波动情况，进而反映股价指数未来发展趋势的技术分析方法。它是道氏理论的形象化表述。<br>移动平均线的计算方法就是求连续若干天的收盘价的算术平均。天数就是MA的参数。</p>
<p>计算公式： MA &#x3D; (C1+C2+C3+C4+C5+….+Cn)&#x2F;n ,C为收盘价，n为移动平均周期数。例如，5日移动平均价格计算方法为：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">MA5</span> = （前四天收盘价+前三天收盘价+前天收盘价+昨天收盘价+今天收盘价）/<span class="number">5</span> </span><br></pre></td></tr></table></figure>

<p>移动平均线依时间长短可分为三种，即短期移动平均线，中期移动平均线，长期移动平均线。短期移动平均线一般以5日或10日为计算期间，中期移动平均线大多以30日、60日为计算期间；长期移动平均线大多以100天和200天为计算期间。有根据处理数据的方式的不同，移动平均线又分为简单移动平均线(SMA)、加权移动平均线(WMA)，以及指数平滑移动平均线(EMA)。</p>
<p>而今天我们说的，MACD(Moving Average Convergence &#x2F; Divergence)也是基于移动平均线发展而来。</p>
<p>MACD称为指数平滑移动平均线，是从双指数移动平均线发展而来的，由快的指数移动平均线（EMA）减去慢的指数移动平均线，MACD的意义和双移动平均线基本相同，但阅读起来更方便。当MACD从负数转向正数，是买的信号。当MACD从正数转向负数，是卖的信号。当MACD以大角度变化，表示快的移动平均线和慢的移动平均线的差距非常迅速的拉开，代表了一个市场大趋势的转变。</p>
<h2 id="2、均线模型展示"><a href="#2、均线模型展示" class="headerlink" title="2、均线模型展示"></a>2、均线模型展示</h2><p>这里，为了让大家能够跟更好的理解，我特地制作一下走势图。<br><a target="_blank" rel="noopener" href="https://i.qutke.com/apps/56a4fc1c310a3c464064943f"><img src="https://s3.cn-north-1.amazonaws.com.cn/static.qutke.com/report/56a4c67e9c61215c5fd0a6bb-Rplot03.png" alt="yieldchart"></a></p>
<p>这是以IBM2010年1月到2012年1月的股价走势。其中黑线代表的是K线（该公司每天的股价），蓝线代表的是ma5（该公司每5天收盘价的均值连成的曲线），以及绿线ma20（该公司每20天收盘价的均值连成的曲线）。可以看到，ma20被无数个红点以及紫点覆盖掉了。红点是表示此时ma5&gt;ma20，紫点是ma5&lt;ma20.</p>
<p>从图中，我们可以直观的看到，红线总是在上升，而紫线则总是在下降。自然而然地，大家就会想到，我们应该在红线的第一个点买入，在紫线的第一个点卖出，这样，我们就可以挣得更多钱了。</p>
<p>当然也不是说，使用了MACD策略，我们就一定赚钱，坐着收钱了。毕竟股市可不是这样简单的东西。但是MACD策略却可以让我们更加清晰的看到市场的本质，提高了胜率。不过，即便是有输有赢，我们也要找到胜率最高的那一只股票是不。以下这幅图便是我们今天的任务了。使用我们今天学到的MACD策略，并对这么一组股票进行模拟交易，然后按照收益率高低进行排序。第一行是沪深300指数，以作比较。</p>
<iframe style="width:100%;height:600px;border:0;padding:0;margin:0;" src="https://console.qutke.com/diagram/info/56a5ccbb310a3c4640649458?config={ %22color%22:%22%23ffffff%22}"></iframe>

<h2 id="3、R语言实现MACD策略"><a href="#3、R语言实现MACD策略" class="headerlink" title="3、R语言实现MACD策略"></a>3、R语言实现MACD策略</h2><p>1）初始化</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">library(quantmod)</span><br><span class="line">library(plyr)</span><br><span class="line">library(<span class="variable constant_">TTR</span>)</span><br><span class="line">library(scales)</span><br><span class="line">library(ggplot2)</span><br><span class="line">library(qutke)</span><br><span class="line">key &lt;- <span class="string">&#x27;faca4c8ff4dc1502d87944ea9cfd74f19918f0aef37fde6746b61d4d339bfcf3&#x27;</span></span><br><span class="line">init(key)</span><br></pre></td></tr></table></figure>

<p>2）选定参数</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sDate&lt;-as.Date(<span class="string">&quot;2015-1-1&quot;</span>) <span class="comment">#开始日期</span></span><br><span class="line">eDate&lt;-Sys.Date() <span class="comment">#结束日期</span></span><br><span class="line">tradingDay &lt;- getDate(data=<span class="string">&#x27;tradingDay&#x27;</span>,startdate=sDate,enddate=eDate,key=key)</span><br><span class="line">length &lt;- length(tradingDay)</span><br><span class="line">sDate &lt;- tradingDay[<span class="number">1</span>]</span><br><span class="line">eDate &lt;- tradingDay[length]</span><br></pre></td></tr></table></figure>

<p>可以通过getIndudtry方法获取况客的股票代码。不过因为有点多，所以我这里只选其中的20多支股票的股票代码。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># industry &lt;- getIndustry(data=&#x27;industryType&#x27;,date=eDate,key=key)</span></span><br><span class="line"><span class="comment"># qtid &lt;- industry$qtid</span></span><br><span class="line">qtid &lt;- c(<span class="string">&#x27;002230.SZ&#x27;</span>,<span class="string">&#x27;002715.SZ&#x27;</span>,<span class="string">&quot;603789.SH&quot;</span>, <span class="string">&quot;603799.SH&quot;</span>, <span class="string">&quot;603806.SH&quot;</span>, <span class="string">&quot;603808.SH&quot;</span>, <span class="string">&quot;603818.SH&quot;</span>,<span class="string">&quot;603828.SH&quot;</span>, <span class="string">&quot;603869.SH&quot;</span>, <span class="string">&quot;603883.SH&quot;</span>,</span><br><span class="line">          <span class="string">&quot;603885.SH&quot;</span>, <span class="string">&quot;603889.SH&quot;</span>, <span class="string">&quot;603898.SH&quot;</span>, <span class="string">&quot;603899.SH&quot;</span>, <span class="string">&quot;603901.SH&quot;</span>, <span class="string">&quot;603918.SH&quot;</span>, <span class="string">&quot;603939.SH&quot;</span>, <span class="string">&quot;603968.SH&quot;</span>,</span><br><span class="line">          <span class="string">&quot;603969.SH&quot;</span>, <span class="string">&quot;603988.SH&quot;</span> ,<span class="string">&quot;603989.SH&quot;</span>, <span class="string">&quot;603993.SH&quot;</span>, <span class="string">&quot;603997.SH&quot;</span>, <span class="string">&quot;603998.SH&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>3）获取每支股票的数据，包括每个交易日的收盘价、ma5、ma20.</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dailyQuote &lt;- getDailyQuote(data=<span class="string">&#x27;mktFwdDaily&#x27;</span>,qtid=qtid,startdate=sDate,enddate=eDate,key=key)</span><br><span class="line">ldata &lt;- dailyQuote[,grep(<span class="string">&quot;qtid|date|close|ma5|ma20&quot;</span>, names(dailyQuote)) ]</span><br><span class="line"><span class="comment">#为true时候，补全ldata中是na的数值，以最近日期的数据 进行赋值 </span></span><br><span class="line">ldata&lt;-na.locf(ldata, fromLast=<span class="variable constant_">TRUE</span>)</span><br></pre></td></tr></table></figure>

<p>因为这次涉及到的数据处理比较多，听起来也比较虚，所以，我们在写代码的时候，可以多查看一下所得到的变量的数据结构是什么样子的。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&gt; head(dailyQuote)</span><br><span class="line">       qtid       date close    volume      value    fwdAdj fwdAdjOpen fwdAdjHi fwdAdjLo fwdAdjClose       ret    logRet</span><br><span class="line"><span class="number">1</span> <span class="number">000001</span>.<span class="variable constant_">SZ</span> <span class="number">2015</span>-<span class="number">01</span>-<span class="number">05</span> <span class="number">16.02</span> <span class="number">286043643</span> <span class="number">4565387846</span> <span class="number">0.7574074</span>   <span class="number">12.11094</span> <span class="number">12.33059</span> <span class="number">11.81556</span>    <span class="number">12.13367</span>  <span class="number">0.011364</span>  <span class="number">0.011300</span></span><br><span class="line"><span class="number">2</span> <span class="number">000001</span>.<span class="variable constant_">SZ</span> <span class="number">2015</span>-<span class="number">01</span>-<span class="number">06</span> <span class="number">15.78</span> <span class="number">216642140</span> <span class="number">3453446168</span> <span class="number">0.7574074</span>   <span class="number">12.00491</span> <span class="number">12.41391</span> <span class="number">11.77769</span>    <span class="number">11.95189</span> -<span class="number">0.014981</span> -<span class="number">0.015095</span></span><br><span class="line"><span class="number">3</span> <span class="number">000001</span>.<span class="variable constant_">SZ</span> <span class="number">2015</span>-<span class="number">01</span>-<span class="number">07</span> <span class="number">15.48</span> <span class="number">170012067</span> <span class="number">2634796409</span> <span class="number">0.7574074</span>   <span class="number">11.78526</span> <span class="number">11.98976</span> <span class="number">11.58833</span>    <span class="number">11.72467</span> -<span class="number">0.019011</span> -<span class="number">0.019194</span></span><br><span class="line"><span class="number">4</span> <span class="number">000001</span>.<span class="variable constant_">SZ</span> <span class="number">2015</span>-<span class="number">01</span>-08 <span class="number">14.96</span> <span class="number">140771421</span> <span class="number">2128003432</span> <span class="number">0.7574074</span>   <span class="number">11.73981</span> <span class="number">11.79283</span> <span class="number">11.28537</span>    <span class="number">11.33081</span> -<span class="number">0.033592</span> -<span class="number">0.034169</span></span><br><span class="line"><span class="number">5</span> <span class="number">000001</span>.<span class="variable constant_">SZ</span> <span class="number">2015</span>-<span class="number">01</span>-09 <span class="number">15.08</span> <span class="number">250850023</span> <span class="number">3835378100</span> <span class="number">0.7574074</span>   <span class="number">11.28537</span> <span class="number">12.02006</span> <span class="number">11.14146</span>    <span class="number">11.42170</span>  <span class="number">0.008021</span>  <span class="number">0.007989</span></span><br><span class="line"><span class="number">6</span> <span class="number">000001</span>.<span class="variable constant_">SZ</span> <span class="number">2015</span>-<span class="number">01</span>-<span class="number">12</span> <span class="number">14.77</span> <span class="number">155329086</span> <span class="number">2293104602</span> <span class="number">0.7574074</span>   <span class="number">11.26265</span> <span class="number">11.39898</span> <span class="number">10.98241</span>    <span class="number">11.18691</span> -<span class="number">0.020557</span> -<span class="number">0.020771</span></span><br><span class="line">     vwap      vol30   ma5  ma10  ma20 ma60</span><br><span class="line"><span class="number">1</span> <span class="number">15.9605</span> <span class="number">8427448605</span> <span class="number">11.72</span> <span class="number">11.45</span> <span class="number">11.17</span> <span class="number">9.23</span></span><br><span class="line"><span class="number">2</span> <span class="number">15.9408</span> <span class="number">8529417547</span> <span class="number">11.82</span> <span class="number">11.51</span> <span class="number">11.22</span> <span class="number">9.30</span></span><br><span class="line"><span class="number">3</span> <span class="number">15.4977</span> <span class="number">8476692763</span> <span class="number">11.91</span> <span class="number">11.52</span> <span class="number">11.23</span> <span class="number">9.37</span></span><br><span class="line"><span class="number">4</span> <span class="number">15.1167</span> <span class="number">8460683917</span> <span class="number">11.83</span> <span class="number">11.54</span> <span class="number">11.27</span> <span class="number">9.43</span></span><br><span class="line"><span class="number">5</span> <span class="number">15.2895</span> <span class="number">8493042075</span> <span class="number">11.71</span> <span class="number">11.62</span> <span class="number">11.31</span> <span class="number">9.49</span></span><br><span class="line"><span class="number">6</span> <span class="number">14.7629</span> <span class="number">8437985489</span> <span class="number">11.52</span> <span class="number">11.62</span> <span class="number">11.34</span> <span class="number">9.55</span></span><br><span class="line"></span><br><span class="line">&gt; head(ldata)</span><br><span class="line">       qtid       date  close    ma5  ma20</span><br><span class="line"><span class="number">1</span> <span class="number">002230</span>.<span class="variable constant_">SZ</span> <span class="number">2015</span>-<span class="number">01</span>-<span class="number">05</span>  <span class="number">27.40</span>  <span class="number">17.11</span> <span class="number">18.17</span></span><br><span class="line"><span class="number">2</span> <span class="number">002230</span>.<span class="variable constant_">SZ</span> <span class="number">2015</span>-<span class="number">01</span>-<span class="number">06</span>  <span class="number">27.72</span>  <span class="number">16.99</span> <span class="number">18.12</span></span><br><span class="line"><span class="number">3</span> <span class="number">002230</span>.<span class="variable constant_">SZ</span> <span class="number">2015</span>-<span class="number">01</span>-<span class="number">07</span>  <span class="number">27.20</span>  <span class="number">16.95</span> <span class="number">18.08</span></span><br><span class="line"><span class="number">4</span> <span class="number">002230</span>.<span class="variable constant_">SZ</span> <span class="number">2015</span>-<span class="number">01</span>-08  <span class="number">27.20</span>  <span class="number">17.07</span> <span class="number">18.04</span></span><br><span class="line"><span class="number">5</span> <span class="number">002230</span>.<span class="variable constant_">SZ</span> <span class="number">2015</span>-<span class="number">01</span>-09  <span class="number">27.10</span>  <span class="number">17.13</span> <span class="number">17.97</span></span><br><span class="line"><span class="number">6</span> <span class="number">002230</span>.<span class="variable constant_">SZ</span> <span class="number">2015</span>-<span class="number">01</span>-<span class="number">12</span>  <span class="number">27.91</span>  <span class="number">17.19</span> <span class="number">17.93</span></span><br></pre></td></tr></table></figure>

<p>4）以UP、Down标定。</p>
<p>对每只股票，以其每个交易日的ma20与ma5进行比较，当ma5&gt;ma20时候，取UP，当ma5&lt;ma20时候，取Down。然后，对数据以qtid为准进行分离并依照日期排序。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 散点数据</span></span><br><span class="line">genPoint&lt;-function(arg=c(),ldata)&#123;</span><br><span class="line">  <span class="keyword">if</span>(length(arg)&gt;<span class="number">2</span>)&#123;</span><br><span class="line">    stop(<span class="string">&#x27;The length of args is two.&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(length(arg)&lt;<span class="number">2</span>)&#123;</span><br><span class="line">    arg &lt;- c(arg,<span class="number">2</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">#[,c(1,arg[1])]</span></span><br><span class="line">  pdata &lt;- ldata[which(ldata[,arg[<span class="number">2</span>]]&gt;ldata[,arg[<span class="number">1</span>]]),]</span><br><span class="line">  pdata &lt;- cbind(pdata,<span class="string">&#x27;op&#x27;</span>=c(<span class="string">&#x27;Down&#x27;</span>)) <span class="comment">#添加op列</span></span><br><span class="line">  xdata &lt;- ldata[which(ldata[,arg[<span class="number">2</span>]]&lt;=ldata[,arg[<span class="number">1</span>]]),]</span><br><span class="line">  xdata &lt;- cbind(xdata,<span class="string">&#x27;op&#x27;</span>=<span class="string">&#x27;UP&#x27;</span>)</span><br><span class="line">  <span class="keyword">return</span>(rbind(pdata,xdata))</span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">#以qtid分离数据，并返回一个list</span></span><br><span class="line">separateQtid&lt;-function(pdata,qtid)&#123;</span><br><span class="line">  <span class="keyword">if</span>(length(qtid)&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">    stop(<span class="string">&#x27;The length of qtid is at least one.&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  xdata &lt;- list()</span><br><span class="line">  <span class="keyword">for</span>(id <span class="keyword">in</span> qtid)&#123;</span><br><span class="line">    xdata[[id]] &lt;- pdata[which(pdata<span class="variable">$qtid</span>==id),]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span>(xdata)</span><br><span class="line">&#125;</span><br><span class="line">pdata&lt;-genPoint(c(<span class="number">5</span>,<span class="number">4</span>),ldata)</span><br><span class="line">pdata &lt;- separateQtid(pdata,qtid)</span><br><span class="line"><span class="comment">#以date数据进行排序</span></span><br><span class="line"><span class="keyword">for</span>(id <span class="keyword">in</span> qtid)&#123;</span><br><span class="line">  pdata[[id]] &lt;- pdata[[id]][order(pdata[[id]]<span class="variable">$date</span>,decreasing=F),]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>这个时候pdata是一个list类型的结构，所以我只列出其中一个元素的前几行数据以展示。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; head(pdata[[<span class="number">1</span>]])</span><br><span class="line">       qtid       date close   ma5  ma20   op</span><br><span class="line"><span class="number">1</span> <span class="number">002230</span>.<span class="variable constant_">SZ</span> <span class="number">2014</span>-<span class="number">01</span>-<span class="number">02</span> <span class="number">48.07</span> <span class="number">17.36</span> <span class="number">17.28</span> Down</span><br><span class="line"><span class="number">2</span> <span class="number">002230</span>.<span class="variable constant_">SZ</span> <span class="number">2014</span>-<span class="number">01</span>-<span class="number">03</span> <span class="number">47.05</span> <span class="number">17.41</span> <span class="number">17.29</span> Down</span><br><span class="line"><span class="number">3</span> <span class="number">002230</span>.<span class="variable constant_">SZ</span> <span class="number">2014</span>-<span class="number">01</span>-<span class="number">06</span> <span class="number">45.12</span> <span class="number">17.27</span> <span class="number">17.29</span>   <span class="variable constant_">UP</span></span><br><span class="line"><span class="number">4</span> <span class="number">002230</span>.<span class="variable constant_">SZ</span> <span class="number">2014</span>-<span class="number">01</span>-<span class="number">07</span> <span class="number">45.08</span> <span class="number">17.12</span> <span class="number">17.27</span>   <span class="variable constant_">UP</span></span><br><span class="line"><span class="number">5</span> <span class="number">002230</span>.<span class="variable constant_">SZ</span> <span class="number">2014</span>-<span class="number">01</span>-08 <span class="number">45.44</span> <span class="number">16.95</span> <span class="number">17.24</span>   <span class="variable constant_">UP</span></span><br><span class="line"><span class="number">6</span> <span class="number">002230</span>.<span class="variable constant_">SZ</span> <span class="number">2014</span>-<span class="number">01</span>-09 <span class="number">45.42</span> <span class="number">16.75</span> <span class="number">17.18</span>   <span class="variable constant_">UP</span></span><br></pre></td></tr></table></figure>

<p>5）选择交易点。</p>
<p>也就是上面的走势图所说的，在红线的第一点买入，在紫线的第一点卖出。<br>模型设计思路：</p>
<ol>
<li>以5日均线和20日均线的交叉，进行交易信号的判断。</li>
<li>当5日均线上穿20日均线则买入(红色)，下穿20日均线卖出(蓝色)。</li>
</ol>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Signal&lt;-function(ldata=c(),pdata,qtid)&#123;</span><br><span class="line">  <span class="keyword">if</span>(length(qtid)&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">    stop(<span class="string">&#x27;The length of qtid is at least one.&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  op1 &lt;- list()</span><br><span class="line">  <span class="keyword">for</span>(id <span class="keyword">in</span> qtid)&#123;</span><br><span class="line">    pdata[[id]] &lt;- pdata[[id]][order(pdata[[id]]<span class="variable">$date</span>,decreasing=F),]</span><br><span class="line">    op &lt;- pdata[[id]][<span class="number">1</span>,]</span><br><span class="line">    tmp &lt;- op<span class="variable">$op</span></span><br><span class="line">    i &lt;- <span class="number">2</span></span><br><span class="line">    nrow &lt;- nrow(pdata[[id]])</span><br><span class="line">    <span class="keyword">while</span>(i&lt;=nrow)&#123;</span><br><span class="line">      <span class="keyword">if</span>(tmp!=pdata[[id]][i,]<span class="variable">$op</span>)&#123;</span><br><span class="line">        op &lt;- rbind(op,pdata[[id]][i,])</span><br><span class="line">      &#125;</span><br><span class="line">      tmp &lt;- pdata[[id]][i,]<span class="variable">$op</span></span><br><span class="line">      i=i+<span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    op1[[id]] &lt;- op</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span>(op1)</span><br><span class="line">&#125;</span><br><span class="line">tdata&lt;-Signal(ldata,pdata,qtid)</span><br></pre></td></tr></table></figure>

<p>同pdata一样，这也是只展示了tdata的部分。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; head(tdata[[<span class="number">1</span>]])</span><br><span class="line">        qtid       date close   ma5  ma20   op</span><br><span class="line"><span class="number">1</span>  <span class="number">002230</span>.<span class="variable constant_">SZ</span> <span class="number">2014</span>-<span class="number">01</span>-<span class="number">02</span> <span class="number">48.07</span> <span class="number">17.36</span> <span class="number">17.28</span> Down</span><br><span class="line"><span class="number">3</span>  <span class="number">002230</span>.<span class="variable constant_">SZ</span> <span class="number">2014</span>-<span class="number">01</span>-<span class="number">06</span> <span class="number">45.12</span> <span class="number">17.27</span> <span class="number">17.29</span>   <span class="variable constant_">UP</span></span><br><span class="line"><span class="number">10</span> <span class="number">002230</span>.<span class="variable constant_">SZ</span> <span class="number">2014</span>-<span class="number">01</span>-<span class="number">15</span> <span class="number">48.80</span> <span class="number">17.14</span> <span class="number">17.10</span> Down</span><br><span class="line"><span class="number">36</span> <span class="number">002230</span>.<span class="variable constant_">SZ</span> <span class="number">2014</span>-<span class="number">02</span>-<span class="number">27</span> <span class="number">49.85</span> <span class="number">19.18</span> <span class="number">19.48</span>   <span class="variable constant_">UP</span></span><br><span class="line"><span class="number">64</span> <span class="number">002230</span>.<span class="variable constant_">SZ</span> <span class="number">2014</span>-<span class="number">04</span>-09 <span class="number">46.82</span> <span class="number">16.94</span> <span class="number">16.86</span> Down</span><br><span class="line"><span class="number">72</span> <span class="number">002230</span>.<span class="variable constant_">SZ</span> <span class="number">2014</span>-<span class="number">04</span>-<span class="number">21</span> <span class="number">25.71</span> <span class="number">16.88</span> <span class="number">16.91</span>   <span class="variable constant_">UP</span></span><br></pre></td></tr></table></figure>

<p>6）模拟交易</p>
<p>预先设定参数是：本金为100000元，每次都全部买入卖出，即持仓比例为1，手续费为0.</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#利用交易信号数据，进行模拟交易</span></span><br><span class="line"><span class="comment">#参数：交易信号tdata ,本金capital,持仓比例position,手续费比例fee</span></span><br><span class="line">trade&lt;-function(tdata,capital=<span class="number">100000</span>,position=<span class="number">1</span>,fee=<span class="number">0</span>)&#123;</span><br><span class="line">  value &lt;- as.numeric(tdata<span class="variable">$close</span>) </span><br><span class="line">  asset &lt;- capital</span><br><span class="line">  <span class="keyword">if</span>(tdata[<span class="number">1</span>,]<span class="variable">$op</span>==<span class="string">&#x27;Down&#x27;</span>)&#123;</span><br><span class="line">    amount &lt;- (asset*position)<span class="string">%/%value[1]</span></span><br><span class="line"><span class="string">    cash &lt;- (asset*position)%%value[1]</span></span><br><span class="line"><span class="string">    #奇数为0，偶数为asset减去上一次的。</span></span><br><span class="line"><span class="string">    diff &lt;- 0.00</span></span><br><span class="line"><span class="string">  &#125;else if(tdata[1,]$op==&#x27;UP&#x27;)&#123;</span></span><br><span class="line"><span class="string">    amount &lt;- 0</span></span><br><span class="line"><span class="string">    cash &lt;- asset</span></span><br><span class="line"><span class="string">    diff &lt;- 0.00</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  i&lt;-2</span></span><br><span class="line"><span class="string">  nrow &lt;- nrow(tdata)</span></span><br><span class="line"><span class="string">  while(i&lt;=nrow)&#123;</span></span><br><span class="line"><span class="string">    #Down 买入</span></span><br><span class="line"><span class="string">    if(tdata[i,]$op==&#x27;Down&#x27;)&#123;</span></span><br><span class="line"><span class="string">      asset &lt;- c(asset,tail(asset,1))</span></span><br><span class="line"><span class="string">      amount &lt;- c(amount,(tail(asset,1)*position)%/</span>%value[i])</span><br><span class="line">      cash &lt;- c(cash,(tail(asset,<span class="number">1</span>)*position)<span class="string">%%value[i]+(tail(asset,1)*(1-position)))</span></span><br><span class="line"><span class="string">      diff &lt;- c(diff,0.00)</span></span><br><span class="line"><span class="string">    &#125;else if(tdata[i,]$op==&#x27;UP&#x27;)&#123;</span></span><br><span class="line"><span class="string">      #UP 卖出</span></span><br><span class="line"><span class="string">      cash &lt;- c(cash,(tail(amount,1)*value[i])+tail(cash,1))</span></span><br><span class="line"><span class="string">      amount &lt;- c(amount,0)</span></span><br><span class="line"><span class="string">      asset &lt;- c(asset,tail(amount,1)*value[i]+tail(cash,1))</span></span><br><span class="line"><span class="string">      diff &lt;- c(diff,tail(asset,1)-tail(asset,2)[1])</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    i=i+1</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  result &lt;- list()</span></span><br><span class="line"><span class="string">  result[[&#x27;ticks&#x27;]] &lt;- cbind(tdata,cash,amount,asset,diff)</span></span><br><span class="line"><span class="string">  indexRise &lt;- c()</span></span><br><span class="line"><span class="string">  indexFall &lt;- c()</span></span><br><span class="line"><span class="string">  i &lt;- 2</span></span><br><span class="line"><span class="string">  while(i&lt;=nrow)&#123;</span></span><br><span class="line"><span class="string">    if(result[[&#x27;ticks&#x27;]][i,]$diff &gt; 0)&#123;</span></span><br><span class="line"><span class="string">      indexRise &lt;- c(indexRise,i-1,i)</span></span><br><span class="line"><span class="string">    &#125;else if(result[[&#x27;ticks&#x27;]][i,]$diff &lt; 0)&#123;</span></span><br><span class="line"><span class="string">      indexFall &lt;- c(indexFall,i-1,i)</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    i &lt;- i+1</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  result[[&#x27;rise&#x27;]] &lt;- result$ticks[indexRise,]</span></span><br><span class="line"><span class="string">  result[[&#x27;fall&#x27;]] &lt;- result$ticks[indexFall,]</span></span><br><span class="line"><span class="string">  return(result)</span></span><br><span class="line"><span class="string">&#125; </span></span><br><span class="line"><span class="string">#设定交易参数，以$10W为本金，满仓买入或卖出，手续为0，传入交易信号。</span></span><br><span class="line"><span class="string"># 查看每笔交易，将会变成一个list，保存每一个qtid的交易记录result</span></span><br><span class="line"><span class="string">#每一个qtid的交易记录</span></span><br><span class="line"><span class="string">tradeList &lt;- list()</span></span><br><span class="line"><span class="string">for(id in qtid)&#123;</span></span><br><span class="line"><span class="string">  tradeList[[id]] &lt;- trade(tdata[[id]],100000)</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<p>7）计算收益率，并记录在一个列表里面，生成dataframe，信息包含日期，代码，名称，收益率，涨跌幅，近1周涨跌，近1月涨跌，年初至今涨跌。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">income &lt;- c()</span><br><span class="line">quoteChangeDaily &lt;- c()</span><br><span class="line">quoteChangeWeek &lt;- c()</span><br><span class="line">quoteChangeMonth &lt;- c() </span><br><span class="line">quoteChangeFYear &lt;- c()</span><br><span class="line"><span class="keyword">for</span>(id <span class="keyword">in</span> qtid)&#123;</span><br><span class="line">  <span class="comment">#C(),收益率。收益率 = （当天的股价-买入价）/ 买入价 *100%</span></span><br><span class="line">  income &lt;- c(income,(tail(tradeList[[id]]$ticks<span class="variable">$asset</span>,<span class="number">1</span>)-tradeList[[id]]$ticks<span class="variable">$asset</span>[<span class="number">1</span>])/tradeList[[id]]$ticks<span class="variable">$asset</span>[<span class="number">1</span>]*<span class="number">100</span>)</span><br><span class="line">  mktYest &lt;- getDailyQuote(data=<span class="string">&#x27;mktFwdDaily&#x27;</span>,qtid = id,startdate=pdata[[id]]<span class="variable">$date</span>[nrow(pdata[[id]])-<span class="number">1</span>],enddate=pdata[[id]]<span class="variable">$date</span>[nrow(pdata[[id]])-<span class="number">1</span>],key=key)</span><br><span class="line">  mktWeek &lt;- getDailyQuote(data=<span class="string">&#x27;mktFwdDaily&#x27;</span>,qtid = id,startdate=pdata[[id]]<span class="variable">$date</span>[nrow(pdata[[id]])-<span class="number">5</span>],enddate=pdata[[id]]<span class="variable">$date</span>[nrow(pdata[[id]])-<span class="number">5</span>],key=key)</span><br><span class="line">  mktMonth &lt;- getDailyQuote(data=<span class="string">&#x27;mktFwdDaily&#x27;</span>,qtid = id,startdate=pdata[[id]]<span class="variable">$date</span>[nrow(pdata[[id]])-<span class="number">20</span>],enddate=pdata[[id]]<span class="variable">$date</span>[nrow(pdata[[id]])-<span class="number">20</span>],key=key)</span><br><span class="line">  mktFYear &lt;- getDailyQuote(data=<span class="string">&#x27;mktFwdDaily&#x27;</span>,qtid = id,startdate=pdata[[id]]<span class="variable">$date</span>[<span class="number">1</span>],enddate=pdata[[id]]<span class="variable">$date</span>[<span class="number">1</span>],key=key)</span><br><span class="line">  <span class="comment">#涨跌幅 .涨跌幅的计算公式是：(当前最新成交价（或收盘价）-开盘参考价)÷开盘参考价×100%  [which(mktYest$qtid==id),]</span></span><br><span class="line">  quoteChangeDaily &lt;- c(quoteChangeDaily,(as.numeric(tail(pdata[[id]], <span class="number">1</span>)<span class="variable">$close</span>)-mktYest<span class="variable">$close</span>)/mktYest<span class="variable">$close</span>*<span class="number">100</span>)</span><br><span class="line">  <span class="comment">#近1周涨跌</span></span><br><span class="line">  quoteChangeWeek &lt;- c(quoteChangeWeek,(as.numeric(tail(pdata[[id]], <span class="number">1</span>)<span class="variable">$close</span>)-mktWeek<span class="variable">$close</span>)/mktWeek<span class="variable">$close</span>*<span class="number">100</span>)</span><br><span class="line">  <span class="comment">#近1月涨跌</span></span><br><span class="line">  quoteChangeMonth &lt;- c(quoteChangeMonth,(as.numeric(tail(pdata[[id]], <span class="number">1</span>)<span class="variable">$close</span>)-mktMonth<span class="variable">$close</span>)/mktMonth<span class="variable">$close</span>*<span class="number">100</span>)</span><br><span class="line">  <span class="comment">#年初至今涨跌</span></span><br><span class="line">  quoteChangeFYear &lt;- c(quoteChangeFYear,(as.numeric(tail(pdata[[id]], <span class="number">1</span>)<span class="variable">$close</span>)-mktFYear<span class="variable">$close</span>)/mktFYear<span class="variable">$close</span>*<span class="number">100</span>)</span><br><span class="line">&#125;</span><br><span class="line">ChiAbbr &lt;- getMD(data=<span class="string">&#x27;keyMap&#x27;</span>,qtid=qtid,key=key)<span class="variable">$ChiAbbr</span></span><br><span class="line">maDF &lt;- data.frame(<span class="string">&#x27;1&#x27;</span>=tail(dailyQuote,<span class="number">1</span>)<span class="variable">$date</span>,<span class="string">&#x27;2&#x27;</span>=qtid,<span class="string">&#x27;3&#x27;</span>=ChiAbbr,</span><br><span class="line">                   <span class="string">&#x27;4&#x27;</span>=income,<span class="string">&#x27;5&#x27;</span>=quoteChangeDaily,<span class="string">&#x27;6&#x27;</span>=quoteChangeWeek,<span class="string">&#x27;7&#x27;</span>=quoteChangeMonth,</span><br><span class="line">                   <span class="string">&#x27;8&#x27;</span>=quoteChangeFYear)</span><br><span class="line"><span class="comment">#排序</span></span><br><span class="line">maDF &lt;- maDF[order(maDF<span class="variable">$X4</span>,decreasing=T),]</span><br></pre></td></tr></table></figure>

<p>8）求取沪深300指数</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">hs300&lt;-getDailyQuote(data=<span class="string">&#x27;mktDataIndex&#x27;</span>,qtid=c(<span class="string">&#x27;000300.SH&#x27;</span>),startdate=sDate,enddate=eDate,key=key) </span><br><span class="line"></span><br><span class="line">id &lt;- c(<span class="string">&#x27;000300.SH&#x27;</span>)</span><br><span class="line"></span><br><span class="line">hs300mktWeek &lt;- hs300[nrow(hs300)-<span class="number">5</span>,]</span><br><span class="line"></span><br><span class="line">hs300mktMonth &lt;- hs300[nrow(hs300)-<span class="number">20</span>,]</span><br><span class="line"></span><br><span class="line">hs300mktFYear &lt;- hs300[<span class="number">1</span>,]</span><br><span class="line"></span><br><span class="line">quoteChangeDaily &lt;- (tail(hs300,<span class="number">1</span>)<span class="variable">$close</span>-tail(hs300,<span class="number">1</span>)<span class="variable">$prevClose</span>)/tail(hs300,<span class="number">1</span>)<span class="variable">$prevClose</span>*<span class="number">100</span></span><br><span class="line"></span><br><span class="line">quoteChangeWeek &lt;- (tail(hs300,<span class="number">1</span>)<span class="variable">$close</span>-hs300mktWeek<span class="variable">$close</span>)/hs300mktWeek<span class="variable">$close</span>*<span class="number">100</span></span><br><span class="line"></span><br><span class="line">quoteChangeMonth &lt;- (tail(hs300,<span class="number">1</span>)<span class="variable">$close</span>-hs300mktMonth<span class="variable">$close</span>)/hs300mktMonth<span class="variable">$close</span>*<span class="number">100</span></span><br><span class="line"></span><br><span class="line">quoteChangeFYear &lt;- (tail(hs300,<span class="number">1</span>)<span class="variable">$close</span>-hs300mktFYear<span class="variable">$close</span>)/hs300mktFYear<span class="variable">$close</span>*<span class="number">100</span></span><br><span class="line"></span><br><span class="line">hs300Income &lt;- c()</span><br><span class="line"></span><br><span class="line">hs300Income &lt;- (tail(hs300,<span class="number">1</span>)<span class="variable">$close</span>-hs300mktFYear<span class="variable">$close</span>)/hs300mktFYear<span class="variable">$close</span>*<span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#生成dataframe</span></span><br><span class="line">hs300Dt &lt;- data.frame(<span class="string">&#x27;1&#x27;</span>=tail(dailyQuote,<span class="number">1</span>)<span class="variable">$date</span>,<span class="string">&#x27;2&#x27;</span>=<span class="string">&#x27;000300.SH&#x27;</span>,<span class="string">&#x27;3&#x27;</span>=<span class="string">&#x27;沪深300&#x27;</span>,<span class="string">&#x27;4&#x27;</span>=hs300Income,<span class="string">&#x27;5&#x27;</span>=quoteChangeDaily,<span class="string">&#x27;6&#x27;</span>=quoteChangeWeek,<span class="string">&#x27;7&#x27;</span>=quoteChangeMonth,<span class="string">&#x27;8&#x27;</span>=quoteChangeFYear)</span><br></pre></td></tr></table></figure>

<p>沪深300指数的数据是这样的：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; hs300Dt </span><br><span class="line">          <span class="variable constant_">X1</span>        <span class="variable constant_">X2</span>      <span class="variable constant_">X3</span>        <span class="variable constant_">X4</span>       <span class="variable constant_">X5</span>         <span class="variable constant_">X6</span>        <span class="variable constant_">X7</span>        <span class="variable constant_">X8</span></span><br><span class="line"><span class="number">1</span> <span class="number">2016</span>-<span class="number">01</span>-<span class="number">22</span> <span class="number">000300</span>.<span class="variable constant_">SH</span> 沪深<span class="number">300</span> -<span class="number">14.50151</span> <span class="number">1.042311</span> -<span class="number">0.1688989</span> -<span class="number">18.69586</span> -<span class="number">14.50151</span></span><br></pre></td></tr></table></figure>

<p>9）合并数据，并发送到况客投研平台，进行后期的修改。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">maDF &lt;- rbind(hs300Dt,maDF)</span><br><span class="line">names(maDF)&lt;-c(<span class="string">&#x27;日期&#x27;</span>,<span class="string">&#x27;代码&#x27;</span>,<span class="string">&#x27;名称&#x27;</span>,<span class="string">&#x27;收益率(%)&#x27;</span>,<span class="string">&#x27;涨跌幅(%)&#x27;</span>,<span class="string">&#x27;周涨跌幅(%)&#x27;</span>,<span class="string">&#x27;月涨跌幅(%)&#x27;</span>,<span class="string">&#x27;年初至今涨跌幅（%）&#x27;</span>)</span><br><span class="line">postData(maDF,name=<span class="string">&#x27;maDataF&#x27;</span>,key=key)</span><br></pre></td></tr></table></figure>


<p>这样，便算是完成了。大家如果有什么不明白的话，可以随时艾特我哦。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-07-24T06:55:45.905Z" title="7/24/2022, 2:55:45 PM">2022-07-24</time>发表</span><span class="level-item"><time dateTime="2022-07-24T06:55:45.905Z" title="7/24/2022, 2:55:45 PM">2022-07-24</time>更新</span><span class="level-item"> yalechen </span><span class="level-item">11 分钟读完 (大约1689个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/07/24/2016-01-20-OpenCV-with-CodeBlocks/">OpenCV with CodeBlocks</a></h1><div class="content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>近年，机器学习当火。而OpenCV便是机器学习在图像识别领域的热门框架。恰好近来闲来无事，便开始捣鼓一番OpenCV。</p>
<h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ol>
<li>OpenCV介绍</li>
<li>minGW版OpenCV配置方式</li>
<li>CodeBlocks IDE示例代码实现</li>
</ol>
<h2 id="1-OpenCV介绍"><a href="#1-OpenCV介绍" class="headerlink" title="1.OpenCV介绍"></a>1.OpenCV介绍</h2><p>OpenCV的全称是：Open Source Computer Vision Library。OpenCV是一个基于BSD许可（开源）发行的跨平台计算机视觉库，可以运行在Linux、Windows和Mac OS操作系统上。它轻量级而且高效——由一系列 C 函数和少量 C++ 类构成，同时提供了Python、Ruby、MATLAB等语言的接口，实现了图像处理和计算机视觉方面的很多通用算法。</p>
<p>为什么有OpenCV？</p>
<p>计算机视觉市场巨大而且持续增长，且这方面没有标准API，如今的计算机视觉软件大概有以下三种：</p>
<ol>
<li>研究代码（慢，不稳定，独立并与其他库不兼容）</li>
<li>耗费很高的商业化工具（比如Halcon, MATLAB+Simulink）</li>
<li>依赖硬件的一些特别的解决方案（比如视频监控，制造控制系统，医疗设备）这是如今的现状。而标准的API将简化计算机视觉程序和解决方案的开发。OpenCV致力于成为这样的标准API。</li>
</ol>
<p>OpenCV致力于真实世界的实时应用，通过优化的C代码的编写对其<br>执行速度带来了可观的提升，并且可以通过购买Intel的IPP高性能多媒体函数库(Integrated Performance Primitives)得到更快的处理速度。</p>
<p>主要应用方向有：人机互动，人脸识别，运动跟踪，图像分割等等。</p>
<h2 id="2-minGW版OpenCV配置方式"><a href="#2-minGW版OpenCV配置方式" class="headerlink" title="2.minGW版OpenCV配置方式"></a>2.minGW版OpenCV配置方式</h2><p>首先，我们来看看需要准备的什么吧。</p>
<p>Win7系统</p>
<p><a target="_blank" rel="noopener" href="http://sourceforge.net/projects/mingw/files/Installer/">mingw-get-setup.exe</a></p>
<p><a target="_blank" rel="noopener" href="http://opencv.org/downloads.html">opencv-2.4.9.exe</a></p>
<p><a target="_blank" rel="noopener" href="http://www.cmake.org/download/">cmake-3.2.0-rc1-win32-x86.exe</a></p>
<p>然后，双击opencv-2.4.9.exe，这是opencv的一个自解压程序，指定好安装目录，他将自动把.exe里的文件解压到指定目录。现在，咱们来看看OpenCV的目录结构吧。</p>
<blockquote>
<p>opencv</p>
<blockquote>
<p>build、sources</p>
</blockquote>
</blockquote>
<blockquote>
<p>build</p>
<blockquote>
<p>doc、include、java、python、x64、x86、LICENSE、OpenCVConfig.cmake、OpenCVConfig-version.cmake</p>
</blockquote>
</blockquote>
<p>可知，在opencv目录下有两个文件夹，分别为build、以及source。其中source是OpenCV的源码。而build是各个语言版本编译过后的库文件，包含c、c++、java、python等语言。x86文件夹和x86文件夹分别对应的是32-bit、64-bit系统下的库。在x64、x86中，有如下目录结构：</p>
<blockquote>
<p>vc10、vc11、vc12</p>
</blockquote>
<p>分别对应的是Virtual Studio2010、2011、2012编译后的库。因为不同的编译器(即便相同的编译器，但不同版本，编译后的文件也是不同的)。同编译器编译出来的OpenCV，只能在相应的编译环境下运行。在早前的如OpenCV 2.3.1中还有vc9（对应vs2008）和mingw版本，而在2.4版本之后便只有vc系列了。</p>
<p>而现在，因为我们使用的编译器是MinGW，而该版本的OpenCV没有对应的编译后文件，所以，我们不得不来自己对源码进行编译。</p>
<p>那么，接下来，我们便开始编译工作了。</p>
<p>1)安装MinGW。</p>
<p>很简单。直接双击，指定安装目录，确认安装即可。</p>
<p>2)出现以下界面，至少点击以下两图所示的条目，并安装。</p>
<p><img src="/img/MinGW0.png" alt="MinGW0"></p>
<p><img src="/img/MinGW1.png" alt="MinGW1"></p>
<p>3)安装cmake</p>
<p>4)运行cmake，在where is the source code中填入OpenCV源代码文件的路径，比如：“…&#x2F;opencv_2410&#x2F;sources”；在where to build the binaries中填入编译文件需要存放的路径，比如：“…&#x2F;MinGW&#x2F;Debug”(存放路径文件自己定义新建一个即可)。(三点表示省略)</p>
<p><img src="/img/cmake.jpg" alt="cmake"></p>
<p>5)点击“Configure”;在Specify the generator for this project中选择MinGW Makefiles(选择刚刚安装的MinGW或者本机已有的)，选中Specify native compilers，点击“Next”。</p>
<p><img src="/img/cmake1.jpg" alt="cmake1"></p>
<p>6)选择编译器路径，这里Compilers: C 选择目录为“…&#x2F;MinGW&#x2F;bin&#x2F;gcc.exe”; C++ 选择目录为 “…&#x2F;MinGw&#x2F;bin&#x2F;g++.exe”，点击“Finish”</p>
<p><img src="/img/cmake2.jpg" alt="cmake2"></p>
<p>7)然后再次点“Configure”</p>
<p><img src="/img/cmake3.jpg" alt="cmake3"></p>
<p>8)等走完进度条，选择需要的Generate选项，此处可以不操作直接点“Generate”，走完进度条便生成了“MinGW Makefiles”</p>
<p><img src="/img/cmake4.jpg" alt="cmake4"></p>
<p>9)之后用mingw对其进行编译，cmd打开命令提示符窗口，进到刚才的保存目录，这里是“…&#x2F;opencv2.4.10&#x2F;MinGW&#x2F;Debug”，输入“mingw32-make”，回车；等待运行完毕后，输入 mingw32-make install,回车；（此过程大约需1-2个小时）</p>
<p>10)运行完毕后便生成了mingw版的OpenCV库，进入“…&#x2F;opencv2.4.10&#x2F;MinGW&#x2F;Debug&#x2F;install”文件夹，便可以看到所需的头文件和库文件</p>
<p><img src="/img/cmake5.jpg" alt="cmake5"></p>
<h2 id="3-CodeBlocks-IDE示例代码实现"><a href="#3-CodeBlocks-IDE示例代码实现" class="headerlink" title="3.CodeBlocks IDE示例代码实现"></a>3.CodeBlocks IDE示例代码实现</h2><p>我所选用的IDE是</p>
<p><a target="_blank" rel="noopener" href="http://www.codeblocks.org/">codeblocks-13.12mingw-setup.exe</a></p>
<p>codeblocks默认使用的编译器是MinGW。</p>
<p>1)双击安装codeblocks</p>
<p>2)启动codeblocks，新建一个“Console application”项目，任意取一个名字。</p>
<p>3)测试代码如下</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &quot;cv.h&quot;  </span></span><br><span class="line"><span class="comment">#include &quot;highgui.h&quot;  </span></span><br><span class="line">int main()  </span><br><span class="line">&#123;  </span><br><span class="line">    IplImage* img = cvLoadImage(<span class="string">&quot;test.jpg&quot;</span>);  </span><br><span class="line">    cvNamedWindow( <span class="string">&quot;test&quot;</span>, <span class="number">0</span> );  </span><br><span class="line">    cvShowImage(<span class="string">&quot;test&quot;</span>, img);  </span><br><span class="line">    cvWaitKey(<span class="number">0</span>);  </span><br><span class="line">    cvReleaseImage( &amp;img );  </span><br><span class="line">    cvDestroyWindow( <span class="string">&quot;test&quot;</span> );  </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>

<p>4)设置opencv相关头文件以及库文件路径</p>
<p>这一步是关键。因为还是有点麻烦的。</p>
<p>(1)右击项目名称，选build options：</p>
<p><img src="/img/codeblocks0.jpg" alt="codeblocks0"></p>
<p>(2)弹出窗口，首先添加头文件路径，依次点击：Search directories-&gt;Complier-&gt;Add，选择头文件所在目录</p>
<p><img src="/img/codeblocks1.png" alt="codeblocks1"></p>
<p>(3)选择库文件路径，依次点击Linker-&gt;Add，选择vc10下的lib库路径</p>
<p><img src="/img/codeblocks2.png" alt="codeblocks2"></p>
<p>(4)最后点击 Linker settings，添加相应库文件，这里如果不知道自己会用到那些库文件的话，可以将vc10&#x2F;lib下的所有库文件全部添加进去</p>
<p><img src="/img/codeblocks3.png" alt="codeblocks3"></p>
<p>5)动态库调用设置</p>
<p>两种方法任选其一即可：</p>
<p>1.可以设置系统变量，将“…\opencv\build\x86\vc10\bin;”添加到系统变量中</p>
<p>2.将…\opencv\build\x86\vc10\bin下的所有dll文件复制到codeblocks对应工程下的bin\Debug文件夹下即可（如果会分辨opencv库文件的话，也可以只将用到的动态库复制即可）。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-07-24T06:55:26.913Z" title="7/24/2022, 2:55:26 PM">2022-07-24</time>发表</span><span class="level-item"><time dateTime="2016-01-11T16:00:00.000Z" title="1/12/2016, 12:00:00 AM">2016-01-12</time>更新</span><span class="level-item"> yalechen </span><span class="level-item">几秒读完 (大约36个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/07/24/2016-01-12-Welcome-to-yalesonchan-blog/">Welcome to yalechen&#039;s blog</a></h1><div class="content"><p>This is the blog I first posted.<br>I will make the blog more open and share something interesting sometime.<br>I hope I can record my life by this way.<br>And<br>Happy New Year.God bless you.</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-07-24T05:39:54.677Z" title="7/24/2022, 1:39:54 PM">2022-07-24</time>发表</span><span class="level-item"><time dateTime="2022-07-24T05:39:54.677Z" title="7/24/2022, 1:39:54 PM">2022-07-24</time>更新</span><span class="level-item"> yalechen </span><span class="level-item">18 分钟读完 (大约2728个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/07/24/2016-01-15-Genetic-Algorithms-in-R/">遗传算法的R语言实现</a></h1><div class="content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>遗传算法的操作使用适者生存的原则，在潜在的种群中逐次产生一个近似最优解的方案，在每一代中，根据个体在问题域中的适应度值和从自然遗传学中借鉴来的再造方法进行个体选择，产生一个新的近似解。这个过程会导致种群中个体的进化，得到的新个体比原来个体更能适应环境，就像自然界中的改造一样。</p>
<h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ol>
<li><p>遗传算法原理</p>
</li>
<li><p>R语言实现</p>
</li>
</ol>
<h2 id="1-遗传算法原理"><a href="#1-遗传算法原理" class="headerlink" title="1.遗传算法原理"></a>1.遗传算法原理</h2><p>在遗传算法里，优化问题的解是被称为个体，它表示为一个变量序列，叫做染色体或者基因串。<br>编码：染色体一般被表达为简单的字符串或数字串，也有其他表示法，这一过程称为编码。<br>基本的过程是：</p>
<p>1)首先要创建种群，算法随机生成一定数量的个体，有时候也可以人工干预这个过程进行，<br>以提高初始种群的质量。在每一代中，每一个个体都被评价，并通过计算适应度函数得到一个适应度数值。种群中的个体被按照适应度排序，适应度高的在前面。（适应度函数）</p>
<p>2)产生下一代个体的种群，通过选择过程和繁殖过程完成。</p>
<p>选择过程，是根据新个体的适应度进行的，但同时并不意味着完全的以适应度高低作为导向，因为单纯选择适应度高的个体将可能导致算法快速收敛到局部最优解而非全局最优解，我们称之为早熟。作为折中，遗传算法依据原则：适应度越高，被选择的机会越高，而适应度低的，被选择的机会就低。初始的数据可以通过这样的选择过程组成一个相对优化的群体。</p>
<p>繁殖过程，表示被选择的个体进入交配过程，包括交配(crossover)和突变(mutation，交配对应算法中的交叉操作。一般的遗传算法都有一个交配概率，范围一般是0.6~1，这个交配概率反映两个被选中的个体进行交配的概率。例如，交配概率为0.8，则80%的“夫妻”个体会生育后代。每两个个体通过交配产生两个新个体，代替原来的“老”个体，而不交配的个体则保持不变。交配过程，父母的染色体相互交換，从而产生两个新的染色体，第一个个体前半段是父亲的染色体，后半段是母亲的，第二个个体则正好相反。不过这里指的半段並不是真正的一半，这个位置叫做交配点，也是随机产生的，可以是染色体的任意位置。</p>
<p>突变过程，表示通过突变产生新的下一代个体。一般遗传算法都有一个固定的突变常数，又称为变异概率，通常是0.1或者更小，这代表变异发生的概率。根据这个概率，新个体的染色体随机的突变，通常就是改变染色体的一个字节（0变到1，或者1变到0）。</p>
<p>遗传算法实现将不断的重复这个过程：每个个体被评价，计算出适应度，两个个体交配，然后突变，产生下一代，直到终止条件满足为止。一般终止条件有以下几种：</p>
<p>进化次数限制</p>
<ul>
<li>计算耗费的资源限制，如计算时间、计算占用的CPU，内存等</li>
<li>个体已经满足最优值的条件，即最优值已经找到</li>
<li>当适应度已经达到饱和，继续进化不会产生适应度更好的个体</li>
<li>人为干预</li>
</ul>
<p>过程：</p>
<ol>
<li><p>创建初始种群</p>
</li>
<li><p>循环：产生下一代</p>
</li>
<li><p>评价种群中的个体适应度</p>
</li>
<li><p>定义选择的适应度函数</p>
</li>
<li><p>改变该种群（交配和变异）</p>
</li>
<li><p>返回第二步</p>
</li>
<li><p>满足终止条件结束</p>
</li>
</ol>
<h2 id="2-R语言实现"><a href="#2-R语言实现" class="headerlink" title="2.R语言实现"></a>2.R语言实现</h2><p>一般在进行遗传算法的时候，需要考虑的参数有：</p>
<ul>
<li>种群规模(Population)，即种群中染色体个体的数目。</li>
<li>染色体的基因个数(Size)，即变量的数目。</li>
<li>交配概率(Crossover)，用于控制交叉计算的使用频率。交叉操作可以加快收敛，使解达到最有希望的最优解区域，因此一般取较大的交叉概率，但交叉概率太高也可能导致过早收敛。</li>
<li>变异概率(Mutation)，用于控制变异计算的使用频率，决定了遗传算法的局部搜索能力。</li>
<li>中止条件(Termination)，结束的标志。</li>
</ul>
<p>以下是常见的R遗传算法包：</p>
<ul>
<li>mcga包，多变量的遗传算法，用于求解多维函数的最小值。</li>
<li>genalg包，多变量的遗传算法，用于求解多维函数的最小值。</li>
<li>rgenoud包，复杂的遗传算法，将遗传算法和衍生的拟牛顿算法结合起来，可以求解复杂函数的最优化化问题。</li>
<li>gafit包，利用遗传算法求解一维函数的最小值。不支持R 3.1.1的版本。</li>
<li>GALGO包，利用遗传算法求解多维函数的最优化解。不支持R 3.1.1的版本。</li>
</ul>
<p>那么我们今天就只针对mcga包，还有genalg包进行讲解一下吧。</p>
<p>1)mcga</p>
<p>实值优化问题。使用的变量值表示基因序列，而不是字节码，因此不需要编解码的处理。<br>mcga实现了遗传算法的交配和突变的操作，并且可以进行大范围和高精度的搜索空间的计算，算法的主要缺点是使用了256位的一元字母表。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">install.packages(<span class="string">&quot;mcga&quot;</span>)</span><br><span class="line">library(mcga)</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看mcga的定义</span></span><br><span class="line">mcga</span><br></pre></td></tr></table></figure>

<p>这是mcga的方法定义。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">function (popsize, chsize, crossprob = <span class="number">1</span>, mutateprob = <span class="number">0.01</span>, </span><br><span class="line">         elitism = <span class="number">1</span>, minval, maxval, maxiter = <span class="number">10</span>, evalFunc) </span><br></pre></td></tr></table></figure>

<p>参数说明：</p>
<ul>
<li>popsize，个体数量，即染色体数目</li>
<li>chsize，基因数量，限参数的数量</li>
<li>crossprob，交配概率，默认为1.0</li>
<li>mutateprob，突变概率，默认为0.01</li>
<li>maxiter，繁殖次数，即循环次数，默认为10</li>
<li>evalFunc，适应度函数，用于给个体进行评价</li>
<li>elitism，精英数量，直接复制到下一代的染色体数目，默认为1</li>
<li>minval，随机生成初始种群的下边界值</li>
<li>maxval，随机生成初始种群的上边界值</li>
</ul>
<p>例子：fx&#x3D;(x1-5)^2 + (x2-55)^2 +(x3-555)^2 +(x4-5555)^2 +(x5-55555)^2</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义适应度函数 </span></span><br><span class="line">f &lt;- function(x)&#123;</span><br><span class="line">  <span class="comment">#总括号</span></span><br><span class="line">  <span class="keyword">return</span> ((x[<span class="number">1</span>]-<span class="number">5</span>)^<span class="number">2</span>+(x[<span class="number">2</span>]-<span class="number">55</span>)^<span class="number">2</span>+(x[<span class="number">3</span>]-<span class="number">555</span>)^<span class="number">2</span>+(x[<span class="number">4</span>]-<span class="number">5555</span>)^<span class="number">2</span>+(x[<span class="number">5</span>]-<span class="number">55555</span>)^<span class="number">2</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行遗传算法</span></span><br><span class="line">m &lt;- mcga(   popsize=<span class="number">200</span>, </span><br><span class="line">             chsize=<span class="number">5</span>, </span><br><span class="line">             minval=<span class="number">0.0</span>, </span><br><span class="line">             maxval=<span class="number">999999</span>, </span><br><span class="line">             maxiter=<span class="number">2500</span>, </span><br><span class="line">             crossprob=<span class="number">1.0</span>, </span><br><span class="line">             mutateprob=<span class="number">0.01</span>, </span><br><span class="line">             evalFunc=f)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 最优化的个体结果</span></span><br><span class="line">print(m<span class="variable">$population</span>[<span class="number">1</span>,])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行时间</span></span><br><span class="line">m<span class="variable">$costs</span>[<span class="number">1</span>]    </span><br></pre></td></tr></table></figure>

<p>同样，当题目改为fx&#x3D;(x1-5)^2 + (x2-55)^2 +(x3-555)^2 +(x4-5555)^2 +(x5-55555)^2时候：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#这是适应度函数</span></span><br><span class="line">f&lt;-function(x)&#123;</span><br><span class="line">  <span class="keyword">return</span> ((x[<span class="number">1</span>]-<span class="number">7</span>)^<span class="number">2</span> + (x[<span class="number">2</span>]-<span class="number">77</span>)^<span class="number">2</span> +(x[<span class="number">3</span>]-<span class="number">777</span>)^<span class="number">2</span> +(x[<span class="number">4</span>]-<span class="number">7777</span>)^<span class="number">2</span> +(x[<span class="number">5</span>]-<span class="number">77777</span>)^<span class="number">2</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">m&lt;-mcga(popsize=<span class="number">200</span>, </span><br><span class="line">  chsize=<span class="number">5</span>, </span><br><span class="line">  minval=<span class="number">0.0</span>, </span><br><span class="line">  maxval=<span class="number">999999999.9</span>, </span><br><span class="line">  maxiter=<span class="number">2500</span>, </span><br><span class="line">  crossprob=<span class="number">1.0</span>, </span><br><span class="line">  mutateprob=<span class="number">0.01</span>, </span><br><span class="line">  evalFunc=f)</span><br><span class="line">cat(<span class="string">&quot;Best chromosome:\n&quot;</span>)</span><br><span class="line">print(m<span class="variable">$population</span>[<span class="number">1</span>,])</span><br><span class="line">cat(<span class="string">&quot;Cost: &quot;</span>,m<span class="variable">$costs</span>[<span class="number">1</span>],<span class="string">&quot;\n&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>2)genalg包</p>
<p>实现了遗传算法，还提供了遗传算法的数据可视化，给用户更直观的角度理解算法。<br>默认图显示的最小和平均评价值，表示遗传算法的计算进度。<br>直方图显出了基因选择的频率，即基因在当前个体中被选择的次数。<br>参数图表示评价函数和变量值，非常方便地看到评价函数和变量值的相关关系。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">install.packages(<span class="string">&quot;genalg&quot;</span>)</span><br><span class="line">library(genalg)</span><br></pre></td></tr></table></figure>

<p>这是genalg函数定义：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">rbga(stringMin=c(), stringMax=c(),</span><br><span class="line">     suggestions=<span class="variable constant_">NULL</span>,</span><br><span class="line">     popSize=<span class="number">200</span>, iters=<span class="number">100</span>,</span><br><span class="line">     mutationChance=<span class="variable constant_">NA</span>,</span><br><span class="line">     elitism=<span class="variable constant_">NA</span>,</span><br><span class="line">     monitorFunc=<span class="variable constant_">NULL</span>, evalFunc=<span class="variable constant_">NULL</span>,</span><br><span class="line">     showSettings=<span class="variable constant_">FALSE</span>, verbose=<span class="variable constant_">FALSE</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>stringMin，设置每个基因的最小值</li>
<li>stringMax，设置每个基因的最大值</li>
<li>suggestions，建议染色体的可选列表</li>
<li>popSize，个体数量，即染色体数目，默认为200</li>
<li>iters，迭代次数，默认为100</li>
<li>mutationChance，突变机会，默认为1&#x2F;(size+1)，它影响收敛速度和搜索空间的探测，低机率导致更快收敛，高机率增加了搜索空间的跨度。</li>
<li>elitism，精英数量，默认为20%，直接复制到下一代的染色体数目</li>
<li>monitorFunc，监控函数，每产生一代后运行</li>
<li>evalFunc，适应度函数，用于给个体进行评价</li>
<li>showSettings，打印设置，默认为false</li>
<li>verbose，打印算法运行日志，默认为false</li>
</ul>
<p>例如：设fx&#x3D;abs(x1-sqrt(exp(1)))+abs(x2-log(pi))，计算fx的最小值，其中x1,x2为2个不同的变量。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义适应度函数</span></span><br><span class="line">f&lt;-function(x)&#123;</span><br><span class="line">  <span class="keyword">return</span>(abs(x[<span class="number">1</span>]-sqrt(exp(<span class="number">1</span>)))+abs(x[<span class="number">2</span>]-log(pi)))</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义监控函数</span></span><br><span class="line">monitor &lt;- function(obj)&#123;</span><br><span class="line">  xlim = c(obj<span class="variable">$stringMin</span>[<span class="number">1</span>], obj<span class="variable">$stringMax</span>[<span class="number">1</span>]);</span><br><span class="line">  ylim = c(obj<span class="variable">$stringMin</span>[<span class="number">2</span>], obj<span class="variable">$stringMax</span>[<span class="number">2</span>]);</span><br><span class="line">  plot(obj<span class="variable">$population</span>, xlim=xlim, ylim=ylim, </span><br><span class="line">       xlab=<span class="string">&quot;pi&quot;</span>, ylab=<span class="string">&quot;sqrt(50)&quot;</span>);</span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行遗传算法 在命令行中运行</span></span><br><span class="line">m2 = rbga(c(<span class="number">1</span>,<span class="number">1</span>),</span><br><span class="line">           c(<span class="number">3</span>,<span class="number">3</span>),</span><br><span class="line">           popSize=<span class="number">100</span>,</span><br><span class="line">           iters=<span class="number">1000</span>,</span><br><span class="line">           evalFunc=f,</span><br><span class="line">           mutationChance=<span class="number">0.01</span>,</span><br><span class="line">           verbose=<span class="variable constant_">TRUE</span>,</span><br><span class="line">           monitorFunc=monitor</span><br><span class="line">           )</span><br><span class="line"></span><br><span class="line"><span class="comment">#计算结果</span></span><br><span class="line">m2<span class="variable">$population</span>[<span class="number">1</span>,]</span><br></pre></td></tr></table></figure>

<p>默认图输出，用于描述遗传过程的进展，X轴为迭代次数，Y轴评价值，评价值越接近于0越好。<br>在1000迭代1000次后，基本找到了精确的结果。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plot(m2)</span><br></pre></td></tr></table></figure>

<p>直方图输出，用于描述对染色体的基因选择频率，即一个基因在染色体中的当前人口被选择的次数。<br>当x1在1.65区域时，被选择超过80次；当x2在1.146区域时，被选择超过了80次。通过直方图，我们可以理解为更优秀的基因被留给了后代。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plot(m2,type=<span class="string">&#x27;hist&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>参数图输出，用于描述评价函数和变量的值的相关关系。对于x1，评价值越小，变量值越准确，但相关关系不明显。对于x2，看不出相关关系。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plot(m2,type=<span class="string">&#x27;vars&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>以下是genalg包官方给出的例子：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># optimize two values to match pi and sqrt(50)</span></span><br><span class="line">evaluate &lt;- function(string=c()) &#123;</span><br><span class="line">  returnVal = <span class="variable constant_">NA</span>;</span><br><span class="line">  <span class="keyword">if</span> (length(string) == <span class="number">2</span>) &#123;</span><br><span class="line">    returnVal = abs(string[<span class="number">1</span>]-pi) + abs(string[<span class="number">2</span>]-sqrt(<span class="number">50</span>));</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    stop(<span class="string">&quot;Expecting a chromosome of length 2!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  returnVal</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">monitor &lt;- function(obj) &#123;</span><br><span class="line">  <span class="comment"># plot the population</span></span><br><span class="line">  xlim = c(obj<span class="variable">$stringMin</span>[<span class="number">1</span>], obj<span class="variable">$stringMax</span>[<span class="number">1</span>]);</span><br><span class="line">  ylim = c(obj<span class="variable">$stringMin</span>[<span class="number">2</span>], obj<span class="variable">$stringMax</span>[<span class="number">2</span>]);</span><br><span class="line">  plot(obj<span class="variable">$population</span>, xlim=xlim, ylim=ylim, </span><br><span class="line">       xlab=<span class="string">&quot;pi&quot;</span>, ylab=<span class="string">&quot;sqrt(50)&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">rbga.results = rbga(c(<span class="number">1</span>, <span class="number">1</span>), c(<span class="number">5</span>, <span class="number">10</span>), monitorFunc=monitor, </span><br><span class="line">                    evalFunc=evaluate, verbose=<span class="variable constant_">TRUE</span>, mutationChance=<span class="number">0.01</span>)</span><br><span class="line"></span><br><span class="line">plot(rbga.results)</span><br><span class="line">plot(rbga.results, type=<span class="string">&quot;hist&quot;</span>)</span><br><span class="line">plot(rbga.results, type=<span class="string">&quot;vars&quot;</span>)</span><br></pre></td></tr></table></figure>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-07-24T05:39:54.677Z" title="7/24/2022, 1:39:54 PM">2022-07-24</time>发表</span><span class="level-item"><time dateTime="2022-07-24T05:39:54.677Z" title="7/24/2022, 1:39:54 PM">2022-07-24</time>更新</span><span class="level-item"> yalechen </span><span class="level-item">21 分钟读完 (大约3119个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/07/24/2016-01-17-Java-Garbage-Collection-Mechanism/">Java Garbage Collection Mechanism</a></h1><div class="content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>所谓“java”，其实不只是一门语言，而是一种设计的美丽，更是一种关于世界观、关于架构之美的映射。</p>
<p>java的底层架构，一个我所未知的世界，一个我想了解的世界。所以，我开始结识到java虚拟机(JVM)，以及java之中的垃圾收集机制。</p>
<h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><p>1.JVM</p>
<p>2.Java Garbage Collection Mechanism</p>
<p>3.Java GC</p>
<h2 id="1-JVM"><a href="#1-JVM" class="headerlink" title="1.JVM"></a>1.JVM</h2><p>既然我们时常说到”JVM(java虚拟机)”，那么所谓的java虚拟机到底是什么吗？我认为他应该是这样的：</p>
<p>java虚拟机，Java Virtual Machine，跟我们平常使用的Virtual PC或者VMware一样，是在操作系统上面运行的，一类模仿操作系统环境，虚构出来的计算机。Java虚拟机有自己完善的硬体架构，如处理器、堆栈、寄存器等，还具有相应的指令系统。不过，VMware等是属于系统虚拟机，而JVM是属于程序虚拟机。</p>
<p>既然我们都说java虚拟机十分重要，那么他为什么这么重要呢？</p>
<p>我们都曾弄过java的环境配置，都知道，要从Oracle官网下载jdk进行安装，知道jdk里面含有Jre，知道我们要设置计算机的环境路径。但是，对于新手来说，可能不知道，我们做这些工作，其实都是在做一件事情——配置java的虚拟机。我们所编写的java程序，经过编译之后，会生成可以在Java虚拟机上运行的字节码文件。因为每一个可以运行java程序的计算机，都拥有java虚拟机，拥有一样的运行环境。所以，在一种平台下编译生成的字节码文件，便可以在不同的平台下运行。</p>
<p>综上可知，JVM的优势是：屏蔽具体平台的信息，实现跨平台开发。</p>
<p>一般的高级语言如果要在不同的平台上运行，至少需要编译成不同的目标代码。而引入Java语言虚拟机后，Java语言在不同平台上运行时不需要重新编译。Java语言使用模式Java虚拟机屏蔽了与具体平台相关的信息，使得Java语言编译程序只需生成在Java虚拟机上运行的目标代码（字节码），就可以在多种平台上不加修改地运行。Java虚拟机在执行字节码时，把字节码解释成具体平台上的机器指令执行。</p>
<p>显然，没有JVM，java将不会有今天这般的辉煌。那么，JVM具体上是如何工作的呢？</p>
<p>JVM的工作：</p>
<p>1、先通过调用jdk之中的java.exe，来让操作系统装载jvm。</p>
<p>2、配置jvm的环境：</p>
<p>1）创建JVM装载环境和配置</p>
<p>2）装载JVM.dll</p>
<p>3）初始化JVM.dll并挂界到JNIENV（JNI调用接口）实例</p>
<p>4）调用JNIENV实例装载并处理class类</p>
<p>JVM在整个jdk中处于最底层的，负责操作系统的交互，用来屏蔽操作系统环境，提供一个完整的java运行环境。</p>
<p>首先是将JVM装入环境，JVM提供的方式是操作系统的动态链接文件。既然是装载JVM的文件，那么操作系统会在你的path下面找到你的程序的java.exe，再从里面通过各种调用寻找jvm.dll以及jvm.cfg，将其装载到操作系统，这样就可以在java中调用JVM的函数了。这些工作做完之后就开始运行java程序了。</p>
<p>Java程序有两种方式一种是jar包，一种是class.</p>
<p>运行jar,Java -jar XXX.jar运行的时候</p>
<p>1、Java.exe调用GetMainClassName函数，该函数先获得JNIEnv实例，然后调用Java类           Java.util.jar.JarFileJNIEnv中方法getManifest()并从返回的Manifest对象中取getAttributes(“Main-Class”)的值即jar包中文件：META-INF&#x2F;MANIFEST.MF指定的Main-Class的主类名作为运行的主类。</p>
<p>2、之后main函数会调用Java.c中LoadClass方法装载该主类（使用JNIEnv实例的FindClass）。main函数直接调用Java.c中LoadClass方法装载该类。</p>
<p>如果是执行class方法。main函数直接调用Java.c中LoadClass方法装载该类。</p>
<h2 id="2-Java-Garbage-Collection-Mechanism"><a href="#2-Java-Garbage-Collection-Mechanism" class="headerlink" title="2.Java Garbage Collection Mechanism"></a>2.Java Garbage Collection Mechanism</h2><p>既然，我们已经了解到了何为“JVM”，那么我们也要接着了解一下，JVM是如何进行平时的内存分配的？</p>
<p>过去的语言（如C语言）要求程序员显示的分配内存、释放内存。程序在需要时分配内存，不需要时释放内存。但是这种做法常常会引起“内存泄漏”，即是说，由于某种原因是分配的内存始终没有得到释放。如果该任务不断地重复，程序最终会耗尽内存并异常终止，至少无法正常的运行下去。相比之下，java不要求程序员显式的分配内存和释放内存，避免了很多的潜在问题。java在创建对象时自动分配内存，并当该对象的引用不存在是释放这块内存。</p>
<p>而这也就是，java垃圾回收机制，java相对于以前的语言的优势。</p>
<p>java的垃圾收集机制，gc（garbage collection），是指JVM用于释放哪些不在会用的对象所占用的内存。，虽说，java语言并没有要求JVM有gc，也没有规定gc要如何进行工作，但是，常用的JVM都有GC，而且，大多数gc都使用类似的算法管理内存，和执行收集操作。</p>
<p>但是一般的，在java语言之中，判断一块内存空间是否符合垃圾回收器标准的标准只有两个：</p>
<ul>
<li>给对象赋予了控制null，以后再没有调试过。</li>
<li>给对象赋予了新值，即重新分配了内存空间。</li>
</ul>
<p>注：一块内存空间符合了垃圾回收器的收集标准，并不意味着这块内存控件就一定会被垃圾回收器收集。</p>
<p>虽说，java是自动进行内存的分配与释放的。但是，我们也可以使用System.gc()方法做到强制执行。但是，并不保证每次调用System.gc()方法就一定能够启动垃圾回收，他只不过会向jvm发出这样的一个申请，但是当地会不会真正执行垃圾回收，一切都是未知数。</p>
<p>所以，我们可以在执行system.gc()前，先执行finalize()方法，对对象进行强制释放内存。虽说，在没有明确释放内存志愿的情况下，java也会隐形的调用finalize()方法,终止对象，以此来释放资源。 </p>
<h2 id="3-Java-GC"><a href="#3-Java-GC" class="headerlink" title="3.Java GC"></a>3.Java GC</h2><h3 id="1-首先来看一下JVM内存结构，它是由堆、栈等部分组成，结构图如下所示。"><a href="#1-首先来看一下JVM内存结构，它是由堆、栈等部分组成，结构图如下所示。" class="headerlink" title="1.首先来看一下JVM内存结构，它是由堆、栈等部分组成，结构图如下所示。"></a>1.首先来看一下JVM内存结构，它是由堆、栈等部分组成，结构图如下所示。</h3><p><img src="http://dl2.iteye.com/upload/attachment/0107/3332/dcc4a0d7-2709-3d5e-8bfe-11f9bee29899.jpeg" alt="JVM内存结构"></p>
<p>1.1 堆</p>
<p> 所有通过new创建的对象的内存都在堆中分配。显然，如果不对堆中的这些对象内存进行分类的话，是多而杂的。在不进行对象存活时间区分的情况下，每次垃圾回收都是对整个堆空间进行回收，花费时间相对会长，同时，因为每次回收都需要遍历所有存活对象，但实际上，对于生命周期长的对象而言，这种遍历是没有效果的，因为可能进行了很多次遍历，但是他们依旧存在。因此，分代垃圾回收采用分治的思想，进行代的划分，把不同生命周期的对象放在不同代上，不同代上采用最适合它的垃圾回收方式进行回收。</p>
<p> <img src="http://dl2.iteye.com/upload/attachment/0107/3336/1d0e5a0a-6967-3770-a6c3-80518ba5ffc9.jpeg" alt="回收方式"></p>
<ul>
<li>年轻代:</li>
</ul>
<p>所有新生成的对象首先都是放在年轻代的。年轻代的目标就是尽可能快速的收集掉那些生命周期短的对象。年轻代分三个区。一个Eden区，两个Survivor区(一般而言)。大部分对象在Eden区中生成。当Eden区满时，还存活的对象将被复制到Survivor区（两个中的一个），当这个Survivor区满时，此区的存活对象将被复制到另外一个Survivor区，当这个Survivor去也满了的时候，从第一个Survivor区复制过来的并且此时还存活的对象，将被复制“年老区(Tenured)”。需要注意，Survivor的两个区是对称的，没先后关系，所以同一个区中可能同时存在从Eden复制过来 对象，和从前一个Survivor复制过来的对象，而复制到年老区的只有从第一个Survivor去过来的对象。而且，Survivor区总有一个是空的。同时，根据程序需要，Survivor区是可以配置为多个的（多于两个），这样可以增加对象在年轻代中的存在时间，减少被放到年老代的可能。</p>
<ul>
<li>年老代:</li>
</ul>
<p>在年轻代中经历了N次垃圾回收后仍然存活的对象，就会被放到年老代中。因此，可以认为年老代中存放的都是一些生命周期较长的对象。</p>
<ul>
<li>持久代:</li>
</ul>
<p>用于存放静态文件，如今Java类、方法等。持久代对垃圾回收没有显著影响，但是有些应用可能动态生成或者调用一些class，例如Hibernate等，在这种时候需要设置一个比较大的持久代空间来存放这些运行过程中新增的类。持久代大小通过-XX:MaxPermSize&#x3D;<N>进行设置。</p>
<p>1.2 栈</p>
<p>每个线程执行每个方法的时候都会在栈中申请一个栈帧，每个栈帧包括局部变量区和操作数栈，用于存放此次方法调用过程中的临时变量、参数和中间结果。</p>
<h3 id="2-VM垃圾回收机制"><a href="#2-VM垃圾回收机制" class="headerlink" title="2.VM垃圾回收机制"></a>2.VM垃圾回收机制</h3><p>针对上述的分类，GC有两种类型：Scavenge GC和Full GC。</p>
<p>2.1 Scavenge GC</p>
<p>一般情况下，当新对象生成，并且在Eden申请空间失败时，就会触发Scavenge GC，对Eden区域进行GC，清除非存活对象，并且把尚且存活的对象移动到Survivor区。然后整理Survivor的两个区。这种方式的GC是对年轻代的Eden区进行，不会影响到年老代。因为大部分对象都是从Eden区开始的，同时Eden区不会分配的很大，所以Eden区的GC会频繁进行。因而，一般在这里需要使用速度快、效率高的算法，使Eden去能尽快空闲出来。</p>
<p>2.2 Full GC</p>
<p>对整个堆进行整理，包括Young、Tenured和Perm。因为需要对整个块进行回收，所以比Scavenge GC要慢，因此应该尽可能减少Full GC的次数。在对JVM调优的过程中，很大一部分工作就是对于FullGC的调节。有如下原因可能导致Full GC：</p>
<ul>
<li>年老代（Tenured）被写满</li>
<li>持久代（Perm）被写满</li>
<li>System.gc()被显示调用</li>
<li>上一次GC之后Heap的各域分配策略动态变化</li>
</ul>
<p>下次跟大家，分享一下，垃圾回收机制的几个算法问题吧。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-07-24T05:39:54.677Z" title="7/24/2022, 1:39:54 PM">2022-07-24</time>发表</span><span class="level-item"><time dateTime="2022-07-24T05:39:54.677Z" title="7/24/2022, 1:39:54 PM">2022-07-24</time>更新</span><span class="level-item"> yalechen </span><span class="level-item">9 分钟读完 (大约1292个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/07/24/2016-01-19-Rescue-Simulation-League-Team-Description-S.O.S-(Iran)/">RoboCup Rescue 2015 – Rescue Simulation League Team Description S.O.S (Iran)</a></h1><div class="content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>这是我过去一年一直在准备并参与的一个比赛<strong>RoboCup Recuse Similation League</strong>。虽然现在比赛已经结束，但还是抽出时间整理了下以前的东西。为了下届学弟学妹们，也翻译了些许文章。而这一片是描述我们在世界级别比赛上的最大的对手，世界冠军<strong>S.O.S</strong>。这是<a target="_blank" rel="noopener" href="http://roborescue.sourceforge.net/2015/TDP/S.O.S.%20-%20Agent%20&%20Multi-Agent%20Challenge.pdf">原文链接</a>。以下便开始翻译内容。</p>
<h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ol>
<li>摘要</li>
<li>介绍</li>
<li>Agent</li>
</ol>
<h2 id="摘要："><a href="#摘要：" class="headerlink" title="摘要："></a>摘要：</h2><p>SOS团队是众所周知的，在救援仿真联赛中表现出色。我们已经在这个比赛中取得了很多的奖项。去年，我们在巴西举行的机器人世界杯获得第一名。我们团队已经发展了多年，主要是老成员，这些年在不同的比赛中我们的基本代码的得分非常稳定，本文旨在提高老战略和解决新出现的逻辑错误和增加新的功能。</p>
<h2 id="1-介绍"><a href="#1-介绍" class="headerlink" title="1.介绍"></a>1.介绍</h2><p>该S.O.S.基础AT的能力和技能，在往年的TDP（2010- 2014年）进行了说明，因此本文所要描绘的是我们的计划，就2015年机器人世界杯新战略的细节改进进行介绍。</p>
<p>去年SOS成员开发全速和低速通信，但到2015年机器人世界杯大赛SOS的主要重点是没有沟通的地图，这种方式专门为消防官兵和警察部队AT创造。在自然灾害中所有类型的事件会发生。正因为如此，在最困难的情况下，我们将执行这么多的活动，来操纵我们的代码。</p>
<h2 id="2-agent"><a href="#2-agent" class="headerlink" title="2 agent"></a>2 agent</h2><h3 id="2-1-警察"><a href="#2-1-警察" class="headerlink" title="2.1 警察"></a>2.1 警察</h3><p>我们去年的TDP没有讨论被添加到Policeforce代码的新功能。因此，在今年的TDP，我们注重描写警察的算法和方法。</p>
<h3 id="2-1-1-清理系统"><a href="#2-1-1-清理系统" class="headerlink" title="2.1.1 清理系统"></a>2.1.1 清理系统</h3><p>改变在2013年模拟服务器中大量的AT卡在地图上的陡峭的边缘问题。定义此问题时必须指出的是，当AT是停留在一个凹区域，其他代理将包围它并引起排斥力卡ＡＴ。其结果是，大量的时间将在释放该ＡＴ的过程中被浪费。</p>
<p>清理时与街道不具有相同的方向原因。道路有在关节角的方向之间的陡峭的角度，这将导致在凹形区域中的间隙的棱角产生影响。简单和基本的解决办法是清除整条道路，但我们已经避免了，因为这会浪费大量的周期。<br>　<br>该SOS警方已经设计和开发新的系统和算法，将减小卡在边缘AT的概率。清除时，我们的算法考虑到所有的未来路径，然后选择最佳路径（基于接下来的步骤），同时考虑所有选项（而不是选择和清除的道路的主要方向），这将导致降低卡在陡峭的边缘可能性。图（1）图（2），我们可以比较SOS新的结算方法，由浙江大学队结算。</p>
<p><img src="/img/SOS.png" alt="SOS"></p>
<h3 id="2-1-2-消防队到达火区"><a href="#2-1-2-消防队到达火区" class="headerlink" title="2.1.2 消防队到达火区"></a>2.1.2 消防队到达火区</h3><p>一个在警察部队的其他变动是增加了中断状态，用于帮助消防队处理火灾。如果一个警察看到或感知火灾发生后，AT开始估计火灾的大小。如果猜测，火灾是相当小的尺寸，警方会放弃自己的任务，首先释放消防大队AT和火之间的路径，所以大火将更快熄灭。</p>
<h3 id="2-1-3-检查火灾的概率状态"><a href="#2-1-3-检查火灾的概率状态" class="headerlink" title="2.1.3 检查火灾的概率状态"></a>2.1.3 检查火灾的概率状态</h3><p>加入警队的另一个特点是检查火灾概率状态。在这种状态下，如果警方检测一些建筑物的高温，AT开始估计火灾可能发生。如果发生火灾的地区是ＡＴ附近，ＡＴ将清除道路，所以可以阻止火灾发生。</p>
<h3 id="2-1-4-无通讯世界模型"><a href="#2-1-4-无通讯世界模型" class="headerlink" title="2.1.4　无通讯世界模型"></a>2.1.4　无通讯世界模型</h3><p>我们的警察部队也更新与消防队的通讯，这是在没有通信战略的世界模型下。在没有沟通的策略下，如果ＡＴ检测火的集群，遵循火找到它的边界。但是，什么是比找到火并通知火的新信息消防大队代理更重要。警方代理发现消防大队的负责灭火，并更新了消防的信息。由于没有沟通，根据他们的旧世界模式不明，为消防队的最有可能的地方，警方搜查了代理商的确切位置。然后警察代理更新世界模型的每个消防队的信息，如果火剂的最后一次更新的时间超过15个周期。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-07-24T05:39:54.677Z" title="7/24/2022, 1:39:54 PM">2022-07-24</time>发表</span><span class="level-item"><time dateTime="2022-07-24T05:39:54.677Z" title="7/24/2022, 1:39:54 PM">2022-07-24</time>更新</span><span class="level-item"> yalechen </span><span class="level-item">10 分钟读完 (大约1425个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/07/24/2016-03-31-Ambition/">Ambition</a></h1><div class="content"><p>野心，你有想要颠覆这个星球的野心吗？</p>
<p>有点中二，有点热血，一句话可以点燃撩在心头的蠢动。原本有点玩笑意味的话，却是一些人一生的信条。这就是我在钢总和刀哥身上看到的。</p>
<p>前几天，有幸能够听到原WPS技术副总裁、现中科云华CEO杨钢钢总，以及原阿里金融CTO、小米金融总经理、现福米信息CEO王安全刀哥的分享，能够跟他们坐一起畅聊。这是一次难得的机会，倾听互联网业界前辈的见解，得窥行业秘辛。</p>
<p>钢总是个酷劲十足而又不失风趣的技术达人兼霸道总裁。有句话叫做，无形装逼最为致命。用在钢总身上最为贴切，境界确实不一样。钢总技术出身，在WPS呆了十年，公司里面一有难题就会找他，实力过硬。按他的说法就是，大大小小技术领域都玩过了。后来在金山跟雷军聊创业理念后，他决定出来创业，也就有了今天的中科云华。不过我比较感兴趣的是，他在金山时跟雷军、傅盛叫板时候的不羁与洒脱。这要是我的话，可能话都说不利索。</p>
<p>刀哥是个很沉稳的人，说话慢条斯理、逻辑清晰，不愧技术出身又成功转型为生意人。关于金融，刀哥有着自己的一套见解，认为未来的金融应该是一个标准化的市场，标准化交易。关于学习能力，刀哥认识是，一种能够在短时间内迅速掌理清新领域主要框架的能力。刀哥还给我们讲了他的年少轻狂，大学未毕业就带着基友跑到上海出来创业。当然这也不是主要的。那晚最让我记忆犹新的一句话是，刀哥拒绝雷军的挽留时讲的，“我要当的是老大，你给不了我”。</p>
<p>我曾经想过一个问题，<strong>怎样的人会在无形中让别人信服</strong>？</p>
<p>现在我想给出一个答案，<strong>野心</strong>。这是我从身边有所成的人身上可以看到的。追求技术巅峰的野心，想要扬名立万的野心，想要建立起一个商业帝国的野心，想要改变生活的野心，乃至于要颠覆这个星球的野心。目标驱动主义，不达目标不罢休，不到棺材不落泪，甚至是置之死地而后生。突破现有的自己，想要紧紧握住通往梦想的门票。这就是野心。而这也是很难在一个大学生身上看到的，难能可贵的。</p>
<p>作为大学生，我很难能够从身边同学的眼中看到渴望，看到野心，更多的反而是一种萎靡，通宵打LOL的疲倦，无所事事的宅，无所适从的迷茫。时光，在他们身上变成了荒土。每一个能够进入大学的学生，都曾经是不一般的人，都怀着梦想踏进校门的。但是大学没有给到他们想要的，没有教给他们独立的能力，前瞻的眼光，明确的目标，深刻的野心，反而丢弃了用十几年义务教育才养成的学习能力。</p>
<p>肖老师说过，做科研只能是那些懂得精神满足的人才能做成功，比如一生都在say no的佩雷尔曼。因为只有在精神满足的情况下，你才能够全神贯注的进入到科研的领域中去。而对于野心，我认为正好相反，只有那些<strong>饥渴</strong>的人才能够拥有，因为精神上的饥渴，让他们极其渴望拥有，并且无从选择的去拥有，这就是野心。而这也是常人罕见的体验，常人只会甘于满足，认为，自讨苦吃的，不值得。没有人甘于平庸，但是，以大多数人努力的程度，注定平庸。</p>
<p>已经大三下，对于这几年的大学生涯，虽有遗憾，但却是实实在在的充实，我感谢自己的努力。但是，平常的忙里忙外，却鲜少有所成就，甚至有时候都是在瞎忙，回首也不知道自己在忙些什么。或许，说白了，自己确实是没有野心，没有极其渴望得到某样东西的欲望，随遇则安，得过且过。这不行，得治。</p>
<p>往者不可谏，来者犹可追。过去难以改变，也不需要改变，那就去改变未来吧。我不知道自己有一天会不会有颠覆世界的野心，也不知道自己能不能够改变这个世界。我只希望在我的每一个人生阶段，都能够有一个不一般的目标，一个小野心，跳出身边的圈子，找到更大的世界。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-07-24T05:39:54.677Z" title="7/24/2022, 1:39:54 PM">2022-07-24</time>发表</span><span class="level-item"><time dateTime="2022-07-24T05:39:54.677Z" title="7/24/2022, 1:39:54 PM">2022-07-24</time>更新</span><span class="level-item"> yalechen </span><span class="level-item">11 分钟读完 (大约1688个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/07/24/2016-04-02-No-Compromise/">No Compromise</a></h1><div class="content"><p>昨天又是翘了一节课，而这次翘课又与往常稍微不一样，因为这是翘了中南的课，却到了湖大的课堂听讲。有时候觉得蛮有趣的，因为这是交了一份大学学费，上了两所大学。</p>
<p>昨天的课叫做，这个校友有点6，官方名字是“熊晓鸽奖学金、奖教金、我最敬爱的老师”颁奖仪式。</p>
<p>我跟几个同学早早来到了会场，坐到了前排。我是认真听完了全程，并随着掌声不自禁的喝彩，仿佛自身便是一名湖大人，能够感受到湖大的激情以及熊晓鸽熊先生的感召力之强。</p>
<p>全程中，有几个人我是格外印象深刻。一个是那位头发花白但面容依旧俊朗的主持人老师。开始是因为他充满磁性的嗓音以及沉稳的主持风格，后来是对于他在台下认真仔细准备主持词时候的敬佩。他身着中山装，身上还有着老一辈人的沉稳执着。</p>
<p>第二个是湖大的新任校长段校长。这个关注他的点就是，纯粹的，他能够听得到湖大学生的心声，保证不会断网断电，能够提前对来场嘉宾做好功课，以及能够抓住一切能够与学生交流的机会上台解答学生的问题。是个好校长。</p>
<p>最后一个当然就是主角熊晓鸽了。在昨天之前我也是不了解熊晓鸽是为何人物。于是专门去收集了下他的履历。然后，就只剩下跪舔了。</p>
<p>熊先生现任IDG（美国国际数据集团）全球常务副总裁兼亚洲区总裁，是IDG资本创始合伙人，被誉为中国引入高科技产业风险基金的第一人，曾投资过百度、腾讯、携程、当当、搜狐、哔哩哔哩等等四百多家公司，一个人掌握着10亿投资资金。然而熊先生却也是平困出身，年少是当过电工，后考上湖大，开始求学生涯，在湖大读书期间最喜欢的是晚上跑到岳麓山上思考。在新华社实习时候，梦想新华社外派战地记者。获得恩师推荐，来到波士顿大学，只用了八个月夺得新闻传播学院硕士学位。接着进入塔夫茨大学弗莱彻法律与外交学院攻读国际经济与商理博士学位。</p>
<p>台上的熊先生，没有所谓的威严，比较亲和，比较风趣，而且比较坑队友。因为正值移动互联网岳麓峰会，于是他邀请了湖湘会的朋友过来，包括58公司董事长姚劲波、拓维信息集团总裁李宇新等等。然后，然后就是一堆段子手的主场了，期间不乏掌声雷动。熊先生真是热爱着他的母校，就那一会，湖大就又有了至少一千多万的捐款，而且把这个熊晓鸽奖学金的含金量蹭蹭的给往上提高了许多，各位大佬都给予了应允。</p>
<p>这次课切切实实的给我证明了名校的价值所在——名校资源。这个资源不仅仅是说，你在学校课程上的教学资源，而是你整个职业生涯里面的社会资源。每一个校园都是一个圈子，维系这个圈子的是情怀、校友情怀，圈子里面的人相互关照，圈子外的人很难介入，比如耶鲁大学的骷髅会。所以，在学校里面是，有着满满的机会的。另外，名校与职工技校的区别在于，他不是技能培训机构，他培养的是思维，更是一种与世界平齐的视界，因为你面对的都是来自各个领域顶端的人物。可惜，国内高校并没有把这方面做的很好。</p>
<p>更加可惜的是，作为学生，还处于职业生涯的规划状态，缘由怯懦，总是对这些机会视若无睹。每当遇到这样的讲座，学校都只能是强制地让几个班的同学去充当水军了，因为学生对于这些所谓的大佬成功人士，是没有概念的，认为是与自己遥不可及的，觉得自己还是个学生，还是个孩子，还不需要考虑这些事情，他们是谁管我鸟事。校园的象牙塔里面，他们是安逸的，还没有意识到没个几年就要毕业，即将要面对这些柴米油盐酱醋茶。毕业不可怕，迷茫不可怕，选择也不可怕，可怕的是，在不知不觉之间，变得别无选择，在迷迷糊糊的时候，做出了最坏的选择而不自知，最后只能将就。</p>
<p>这几年，我也是常常做项目，也跟着别人到处跑，自己越来越清楚的感受到，技术不是生活的全部。人与计算机打交道，说到底还是简单直接的，因为计算机是不会欺骗，他对你是永远正直的。而人与人之间的门道，却是不可捉摸的，没有原理可言，没有所谓的定律可以依据。在计算机的01之间，或许程序员便是上帝，但是在这个社会框架里面，站在顶端主导世界变革的却永远不会是一个只知道01的人。所以，一直认为无形中便能够让人信服的人十分令人敬佩。</p>
<p>看着台上刚从美国波士顿飞回来的学姐，讲着她对晓鸽学长知遇之情的感激，我开着玩笑对旁边的同学说，“过不了十年，站在上面讲的人的就是你了”。他说好。</p>
<p>这是一篇反思文，凑合着看吧。<br>​</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-07-24T05:39:54.677Z" title="7/24/2022, 1:39:54 PM">2022-07-24</time>发表</span><span class="level-item"><time dateTime="2022-07-24T05:39:54.677Z" title="7/24/2022, 1:39:54 PM">2022-07-24</time>更新</span><span class="level-item"> yalechen </span><span class="level-item">9 分钟读完 (大约1373个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/07/24/2016-04-04-Android-BroadcastReceiver/">Broadcast Receiver on Android</a></h1><div class="content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Broadcast Receiver是Android组件中最基本也是最为常见用的四大组件之一。</p>
<p>Broadcast Receiver，<a target="_blank" rel="noopener" href="http://blog.csdn.net/liuhe688/article/details/6955668">广播接收者</a>，顾名思义，是用来接收来自系统和应用中的广播。这种组件本质上是一种全局的监听器，用于监听系统全局的广播消息。</p>
<h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ol>
<li>Broadcast Receiver的生命周期</li>
<li>Broadcast的类型</li>
<li>Broadcast Receiver的注册方式</li>
<li>Broadcast Receiver的使用步骤</li>
</ol>
<h2 id="一、Broadcast-Receiver的生命周期"><a href="#一、Broadcast-Receiver的生命周期" class="headerlink" title="一、Broadcast Receiver的生命周期"></a>一、Broadcast Receiver的生命周期</h2><p>BroadcastReceiver 有一个回调方法：void onReceive(Context curContext, Intent broadcastMsg)。当一个广播消息到达接收者时，Android 调用它的 onReceive() 方法并传递给它包含消息的 Intent 对象。BroadcastReceiver 被认为仅当它执行这个方法时是活跃的。当 onReceive() 返回后，它是不活跃的。</p>
<p>Android系统的很多消息(如系统启动,新短信,来电话等)都通过BroadcastReceiver来分发。BroadcastReceiver的生命周期是短暂的，而且是消息一到达则创建执行完毕就立刻销毁的。</p>
<p>拥有一个活跃状态的广播接收器的进程被保护起来而不会被杀死，但仅拥有失活状态组件的进程则会在其它进程需要它所占有的内存的时候随时被杀掉。 所以，如果响应一个广播信息需要很长的一段时 间，我们一般会将其纳入一个衍生的线程中去完成，而不是在主线程内完成它，从而保证用户交互过程的流畅。</p>
<p>这带来一个问题，当一个广播消息的响应时费时的，因此应该在独立的线程中做这些事，远离用户界面或者其它组件运行的主线程。如果 onReceive() 衍生线程然后返回，整个进程，包括新的线程，被判定为不活跃的（除非进程中的其它应用程序组件是活跃的），否则将使它处于被杀的危机。解决这个问题的方法是 onReceive() 启动一个 Service，让 Service 做这个工作，因此系统知道进程中有活跃的工作在做。</p>
<p>通常某个应用或系统本身在某些事件（电池电量不足、来电来短信）来临时会广播一个 Intent 出去，通过注册一个 BroadcastReceiver 来监听到这些 Intent，并获取其中广播的数据。</p>
<h2 id="二、Broadcast的类型"><a href="#二、Broadcast的类型" class="headerlink" title="二、Broadcast的类型"></a>二、Broadcast的类型</h2><p>Broadcast的类型有两种：普通广播和有序广播。</p>
<p>Normal broadcasts（普通广播）：Normal broadcasts是完全异步的可以同一时间被所有的接收者接收到。通常每个接收者都无需等待即可以接收到广播，接收者相互之间不会有影响。消息的传递效率比较高。但缺点是接收者不能讲接收的消息的处理信息传递给下一个接收者也不能停止消息的传播。</p>
<p>Ordered broadcasts（有序广播）：Ordered broadcasts的接收者按照一定的优先级进行消息的接收。如：A,B,C的优先级依次降低，那么消息先传递给A，在传递给B，最后传递给C。优先级别声明在中，取值为[-1000,1000]数值越大优先级别越高。优先级也可通过filter.setPriority(10)方式设置。 另外Ordered broadcasts的接收者可以通过abortBroadcast()的方式取消广播的传播，也可以通过setResultData和setResultExtras方法将处理的结果存入到Broadcast中，传递给下一个接收者。然后，下一个接收者通过getResultData()和getResultExtras(true)接收高优先级的接收者存入的数据。</p>
<h2 id="三、Broadcast-Receiver的注册方式"><a href="#三、Broadcast-Receiver的注册方式" class="headerlink" title="三、Broadcast Receiver的注册方式"></a>三、Broadcast Receiver的注册方式</h2><p>注册有两种方式：</p>
<p>1、静态注册：这种方法是在配置AndroidManifest.xml配置文件中的application里面定义receiver并设置要接收的action。通过这种方式注册的广播为常驻型广播，也就是说如果应用程序关闭了，有相应事件触发，程序还是会被系统自动调用运行。如：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 在配置文件中注册BroadcastReceiver能够匹配的Intent --&gt;</span><br><span class="line">&lt;receiver <span class="symbol">android:</span>name=<span class="string">&quot;com.example.test.MyBroadcastReceiver&quot;</span>&gt;</span><br><span class="line">    &lt;intent-filter&gt;</span><br><span class="line">        &lt;<span class="regexp">/action&gt;</span></span><br><span class="line"><span class="regexp">        &lt;category android:name=&quot;android.intent.category.DEFAULT&quot;&gt;&lt;/category</span>&gt;</span><br><span class="line">    &lt;<span class="regexp">/intent-filter&gt;</span></span><br><span class="line"><span class="regexp">&lt;/receiver</span>&gt;</span><br></pre></td></tr></table></figure>

<p>2、动态注册：这种方法是通过代码在.Java文件中进行注册。通过这种方式注册的广播为非常驻型广播，即它会跟随Activity的生命周期，所以在Activity结束前我们需要调用unregisterReceiver(receiver)方法移除它，否则会报异常。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/<span class="regexp">/通过代码的方式动态注册MyBroadcastReceiver</span></span><br><span class="line"><span class="regexp">MyBroadcastReceiver receiver=new MyBroadcastReceiver();</span></span><br><span class="line"><span class="regexp">IntentFilter filter=new IntentFilter();</span></span><br><span class="line"><span class="regexp">filter.addAction(&quot;android.intent.action.MyBroadcastReceiver&quot;);</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/注册receiver</span></span><br><span class="line"><span class="regexp">registerReceiver(receiver, filter);</span></span><br></pre></td></tr></table></figure>

<p>要接收某些action，需要在AndroidManifest.xml里面添加相应的permission。</p>
<h2 id="四、Broadcast-Receiver的使用步骤"><a href="#四、Broadcast-Receiver的使用步骤" class="headerlink" title="四、Broadcast Receiver的使用步骤"></a>四、Broadcast Receiver的使用步骤</h2><p>1、创建BroadcastReceiver的子类</p>
<p>由于BroadcastReceiver本质上是一种监听器，所以创建BroadcastReceiver的方法也非常简单，只需要创建一个BroadcastReceiver的子类然后重写onReceive (Context context, Intentintent)方法即可。</p>
<p>2、注册BroadcastReceiver</p>
<p>一旦实现了BroadcastReceiver，接下就应该指定该BroadcastReceiver能匹配的Intent即注册BroadcastReceiver。</p>
<p>另外，这是发送广播的代码：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">​Intent intent = new Intent(String action);</span><br><span class="line">intent.setAction(String action);</span><br><span class="line">sendBroadcast(Intent); </span><br></pre></td></tr></table></figure></div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous is-invisible is-hidden-mobile"><a href="/page/0/">上一页</a></div><div class="pagination-next"><a href="/page/2/">下一页</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link is-current" href="/">1</a></li><li><a class="pagination-link" href="/page/2/">2</a></li><li><a class="pagination-link" href="/page/3/">3</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.png" alt="cyw3"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">cyw3</p><p class="is-size-6 is-block">ProgramAnalysis/Compiler/VirtualMachine</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Shenzhen, China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">30</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">1</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/cyw3" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/cyw3"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://tca.tencent.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Tencent Code Analysis</span></span><span class="level-right"><span class="level-item tag">tca.tencent.com</span></span></a></li></ul></div></div></div><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-07-30T03:20:12.000Z">2022-07-30</time></p><p class="title"><a href="/2022/07/30/2022-7-30-Binaryen-Readme/">2022-7-30-Binaryen-Readme</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-07-24T06:56:22.285Z">2022-07-24</time></p><p class="title"><a href="/2022/07/24/2016-01-14-MACD/">MACD策略</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-07-24T06:55:45.905Z">2022-07-24</time></p><p class="title"><a href="/2022/07/24/2016-01-20-OpenCV-with-CodeBlocks/">OpenCV with CodeBlocks</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-07-24T06:55:26.913Z">2022-07-24</time></p><p class="title"><a href="/2022/07/24/2016-01-12-Welcome-to-yalesonchan-blog/">Welcome to yalechen&#039;s blog</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-07-24T05:39:54.677Z">2022-07-24</time></p><p class="title"><a href="/2022/07/24/2016-01-15-Genetic-Algorithms-in-R/">遗传算法的R语言实现</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2022/07/"><span class="level-start"><span class="level-item">七月 2022</span></span><span class="level-end"><span class="level-item tag">30</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/wasm/"><span class="tag">wasm</span><span class="tag">1</span></a></div></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">订阅更新</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="订阅"></div></div></form></div></div></div><div class="card widget"><div class="card-content"><div class="notification is-danger">You need to set <code>client_id</code> and <code>slot_id</code> to show this AD unit. Please set it in <code>_config.yml</code>.</div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="订阅"></div></div></form></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">Cyw3</a><p class="is-size-7"><span>&copy; 2022 cyw3</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/cyw3/cyw3.github.io"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>